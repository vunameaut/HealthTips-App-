<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/PRELOAD_USAGE_GUIDE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/PRELOAD_USAGE_GUIDE.md" />
              <option name="updatedContent" value="## Hướng dẫn sử dụng ExoPlayer Preload System&#10;&#10;###  Tổng quan&#10;Hệ thống preload ExoPlayer đã được tích hợp vào `ShortVideoAdapter` để giải quyết vấn đề video load chậm. Hệ thống này sẽ:&#10;&#10;- ✅ **Preload 2 video trước và sau** vị trí hiện tại&#10;- ✅ **Sử dụng preloaded player** thay vì tạo mới mỗi lần&#10;- ✅ **Tự động cleanup** memory khi không cần&#10;- ✅ **Xử lý an toàn** conflict với RecyclerView scroll&#10;- ✅ **Fallback** về cách cũ nếu preload lỗi&#10;&#10;###  Cách sử dụng trong Fragment/Activity&#10;&#10;#### 1. Khởi tạo Adapter&#10;```java&#10;// Trong Fragment hoặc Activity&#10;public class ShortVideoFragment extends Fragment {&#10;    private ShortVideoAdapter adapter;&#10;    private RecyclerView recyclerView;&#10;    &#10;    @Override&#10;    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {&#10;        super.onViewCreated(view, savedInstanceState);&#10;        &#10;        // Khởi tạo adapter với context&#10;        adapter = new ShortVideoAdapter(getContext(), videoList);&#10;        &#10;        // QUAN TRỌNG: Set RecyclerView reference để tránh lỗi scroll&#10;        adapter.setRecyclerView(recyclerView);&#10;        &#10;        recyclerView.setAdapter(adapter);&#10;        &#10;        // Setup scroll listener để trigger preload&#10;        setupVideoScrollListener();&#10;    }&#10;}&#10;```&#10;&#10;#### 2. Setup Scroll Listener (QUAN TRỌNG)&#10;```java&#10;private void setupVideoScrollListener() {&#10;    recyclerView.addOnScrollListener(new RecyclerView.OnScrollListener() {&#10;        @Override&#10;        public void onScrolled(@NonNull RecyclerView recyclerView, int dx, int dy) {&#10;            super.onScrolled(recyclerView, dx, dy);&#10;            &#10;            // Lấy vị trí hiện tại&#10;            LinearLayoutManager layoutManager = (LinearLayoutManager) recyclerView.getLayoutManager();&#10;            if (layoutManager != null) {&#10;                int currentPosition = layoutManager.findFirstVisibleItemPosition();&#10;                &#10;                // Trigger preload cho vị trí mới&#10;                if (adapter != null &amp;&amp; currentPosition &gt;= 0) {&#10;                    adapter.onScrollToPosition(currentPosition);&#10;                    &#10;                    // Debug log (có thể bỏ trong production)&#10;                    Log.d(&quot;VideoPreload&quot;, adapter.getPreloadDebugInfo());&#10;                }&#10;            }&#10;        }&#10;    });&#10;}&#10;```&#10;&#10;#### 3. Cleanup Resources (QUAN TRỌNG)&#10;```java&#10;@Override&#10;public void onDestroyView() {&#10;    super.onDestroyView();&#10;    &#10;    // Release tất cả resources khi Fragment bị hủy&#10;    if (adapter != null) {&#10;        adapter.releaseAllResources();&#10;    }&#10;}&#10;&#10;@Override&#10;public void onPause() {&#10;    super.onPause();&#10;    &#10;    // Pause video khi Fragment không visible&#10;    if (adapter != null) {&#10;        adapter.pauseAllVideos();&#10;    }&#10;}&#10;&#10;@Override&#10;public void onResume() {&#10;    super.onResume();&#10;    &#10;    // Resume video khi Fragment visible lại&#10;    if (adapter != null) {&#10;        adapter.resumeCurrentVideo();&#10;    }&#10;}&#10;```&#10;&#10;###  Lợi ích so với trước&#10;&#10;#### Trước (vấn đề cũ):&#10;```&#10;Video 1: Tạo ExoPlayer mới → Load → Play ✓ (nhanh vì đầu tiên)&#10;Video 2: Tạo ExoPlayer mới → Load → Play ✗ (chậm, phải scroll qua lại)&#10;Video 3: Tạo ExoPlayer mới → Load → Play ✗ (chậm, phải scroll qua lại)&#10;```&#10;&#10;#### Sau (với preload):&#10;```&#10;Video 1: Sử dụng preload → Play ✓ (ngay lập tức)&#10;Video 2: Sử dụng preload → Play ✓ (ngay lập tức) &#10;Video 3: Sử dụng preload → Play ✓ (ngay lập tức)&#10;&#10;Background: Preload Video 4, 5, 6... sẵn sàng&#10;```&#10;&#10;###  Tùy chỉnh (nếu cần)&#10;&#10;Trong `ExoPlayerPreloadManager.java`, bạn có thể điều chỉnh:&#10;&#10;```java&#10;private static final int PRELOAD_AHEAD = 2; // Số video preload trước/sau&#10;private static final int PRELOAD_DELAY_MS = 100; // Delay để tránh conflict&#10;```&#10;&#10;**Gợi ý:**&#10;- `PRELOAD_AHEAD = 1`: Tiết kiệm memory, ít mượt hơn&#10;- `PRELOAD_AHEAD = 3`: Tốn memory hơn, mượt mà hơn&#10;- `PRELOAD_DELAY_MS = 50`: Phản hồi nhanh hơn, có thể conflict&#10;- `PRELOAD_DELAY_MS = 200`: An toàn hơn, chậm hơn một chút&#10;&#10;###  Debug và Monitoring&#10;&#10;#### 1. Kiểm tra trạng thái preload:&#10;```java&#10;// Trong Fragment hoặc Activity&#10;private void logPreloadStatus() {&#10;    if (adapter != null) {&#10;        String debugInfo = adapter.getPreloadDebugInfo();&#10;        Log.d(&quot;VideoPreload&quot;, debugInfo);&#10;        // Output: &quot;Preload Manager - Current: 2, Preloaded: 4&quot;&#10;    }&#10;}&#10;```&#10;&#10;#### 2. Các log quan trọng để theo dõi:&#10;```&#10;Tag: ExoPlayerPreloadManager&#10;- &quot;Setting up current video at position: X&quot;&#10;- &quot;Using preloaded player for position: X&quot; &#10;- &quot;Preloading video at position: X&quot;&#10;- &quot;Cleaning up preload player at position: X&quot;&#10;&#10;Tag: VideoViewHolder  &#10;- &quot;Using preload manager for position: X&quot;&#10;- &quot;Got preloaded player for position: X&quot;&#10;- &quot;Creating new player (no preload available)&quot;&#10;&#10;Tag: ShortVideoAdapter&#10;- &quot;Scrolled to position: X, triggering preload&quot;&#10;```&#10;&#10;### ⚠️ Lưu ý quan trọng&#10;&#10;1. **Luôn gọi `adapter.setRecyclerView(recyclerView)`** sau khi khởi tạo adapter&#10;2. **Luôn gọi `adapter.releaseAllResources()`** trong `onDestroyView()`&#10;3. **Setup scroll listener** để trigger preload tự động&#10;4. **Không tạo nhiều adapter instance** cho cùng một RecyclerView&#10;5. **Test trên thiết bị thật** vì emulator có thể không phản ánh đúng performance&#10;&#10;###  Kết quả mong đợi&#10;&#10;Sau khi áp dụng hệ thống preload:&#10;- ✅ Video đầu tiên load ngay như trước&#10;- ✅ Video thứ 2, 3, 4... load **ngay lập tức** &#10;- ✅ Không cần scroll qua video rồi scroll lại&#10;- ✅ Trải nghiệm mượt mà như TikTok/Instagram Reels&#10;- ✅ Không bị lỗi &quot;Cannot call this method while RecyclerView is computing a layout&quot;&#10;- ✅ Memory được quản lý hiệu quả" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/ShortVideo.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/ShortVideo.kt" />
              <option name="updatedContent" value="package com.vhn.doan.data&#10;&#10;/**&#10; * Data class đại diện cho một video ngắn trong ứng dụng&#10; * &#10; * @param id ID duy nhất của video&#10; * @param title Tiêu đề của video&#10; * @param caption Chú thích/mô tả của video&#10; * @param uploadDate Ngày tải lên (timestamp)&#10; * @param categoryId ID danh mục của video&#10; * @param tags Map các tag với trạng thái boolean&#10; * @param viewCount Số lượt xem&#10; * @param likeCount Số lượt thích&#10; * @param userId ID người dùng tạo video&#10; * @param cldPublicId Public ID trên Cloudinary&#10; * @param cldVersion Version của video trên Cloudinary&#10; * @param status Trạng thái của video (ACTIVE, INACTIVE, PENDING, etc.)&#10; */&#10;data class ShortVideo(&#10;    val id: String = &quot;&quot;,&#10;    val title: String = &quot;&quot;,&#10;    val caption: String = &quot;&quot;,&#10;    val uploadDate: Long = 0L,&#10;    val categoryId: String = &quot;&quot;,&#10;    val tags: Map&lt;String, Boolean&gt; = emptyMap(),&#10;    val viewCount: Long = 0L,&#10;    val likeCount: Long = 0L,&#10;    val userId: String = &quot;&quot;,&#10;    val cldPublicId: String = &quot;&quot;,&#10;    val cldVersion: Long = 0L,&#10;    val status: String = &quot;ACTIVE&quot;&#10;) {&#10;    /**&#10;     * Constructor không tham số cho Firebase&#10;     */&#10;    constructor() : this(&#10;        id = &quot;&quot;,&#10;        title = &quot;&quot;,&#10;        caption = &quot;&quot;,&#10;        uploadDate = 0L,&#10;        categoryId = &quot;&quot;,&#10;        tags = emptyMap(),&#10;        viewCount = 0L,&#10;        likeCount = 0L,&#10;        userId = &quot;&quot;,&#10;        cldPublicId = &quot;&quot;,&#10;        cldVersion = 0L,&#10;        status = &quot;ACTIVE&quot;&#10;    )&#10;&#10;    /**&#10;     * Kiểm tra xem video có hợp lệ không&#10;     */&#10;    fun isValid(): Boolean {&#10;        return id.isNotEmpty() &amp;&amp; &#10;               title.isNotEmpty() &amp;&amp; &#10;               userId.isNotEmpty() &amp;&amp; &#10;               cldPublicId.isNotEmpty() &amp;&amp;&#10;               cldVersion &gt; 0&#10;    }&#10;&#10;    /**&#10;     * Các trạng thái có thể có của video&#10;     */&#10;    companion object {&#10;        const val STATUS_ACTIVE = &quot;ACTIVE&quot;&#10;        const val STATUS_INACTIVE = &quot;INACTIVE&quot;&#10;        const val STATUS_PENDING = &quot;PENDING&quot;&#10;        const val STATUS_DELETED = &quot;DELETED&quot;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/model/ShortVideoModel.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/model/ShortVideoModel.java" />
              <option name="originalContent" value="package com.vhn.doan.data.model;&#10;&#10;import java.util.Map;&#10;&#10;/**&#10; * Model class để ánh xạ dữ liệu video ngắn từ Firebase node /videos/{videoId}&#10; * Sử dụng cho chức năng hiển thị video ngắn trong ShortVideoFragment&#10; */&#10;public class ShortVideoModel {&#10;&#10;    private String id; // Thêm field ID&#10;    private String title;&#10;    private String caption;&#10;    private Long uploadDate;&#10;    private String videoUrl;&#10;    private String thumbnailUrl;&#10;    private String categoryId;&#10;    private Map&lt;String, Boolean&gt; tags;&#10;    private Long viewCount;&#10;    private Long likeCount;&#10;    private String userId;&#10;&#10;    /**&#10;     * Constructor rỗng bắt buộc cho Firebase Realtime Database&#10;     */&#10;    public ShortVideoModel() {&#10;        // Constructor rỗng để Firebase có thể khởi tạo object&#10;    }&#10;&#10;    /**&#10;     * Constructor đầy đủ tham số&#10;     */&#10;    public ShortVideoModel(String id, String title, String caption, Long uploadDate, String videoUrl,&#10;                          String thumbnailUrl, String categoryId, Map&lt;String, Boolean&gt; tags,&#10;                          Long viewCount, Long likeCount, String userId) {&#10;        this.id = id;&#10;        this.title = title;&#10;        this.caption = caption;&#10;        this.uploadDate = uploadDate;&#10;        this.videoUrl = videoUrl;&#10;        this.thumbnailUrl = thumbnailUrl;&#10;        this.categoryId = categoryId;&#10;        this.tags = tags;&#10;        this.viewCount = viewCount;&#10;        this.likeCount = likeCount;&#10;        this.userId = userId;&#10;    }&#10;&#10;    // Getter methods&#10;    public String getId() {&#10;        return id;&#10;    }&#10;&#10;    public String getTitle() {&#10;        return title;&#10;    }&#10;&#10;    public String getCaption() {&#10;        return caption;&#10;    }&#10;&#10;    public Long getUploadDate() {&#10;        return uploadDate;&#10;    }&#10;&#10;    public String getVideoUrl() {&#10;        return videoUrl;&#10;    }&#10;&#10;    public String getThumbnailUrl() {&#10;        return thumbnailUrl;&#10;    }&#10;&#10;    public String getCategoryId() {&#10;        return categoryId;&#10;    }&#10;&#10;    public Map&lt;String, Boolean&gt; getTags() {&#10;        return tags;&#10;    }&#10;&#10;    public Long getViewCount() {&#10;        return viewCount;&#10;    }&#10;&#10;    public Long getLikeCount() {&#10;        return likeCount;&#10;    }&#10;&#10;    public String getUserId() {&#10;        return userId;&#10;    }&#10;&#10;    // Setter methods&#10;    public void setId(String id) {&#10;        this.id = id;&#10;    }&#10;&#10;    public void setTitle(String title) {&#10;        this.title = title;&#10;    }&#10;&#10;    public void setCaption(String caption) {&#10;        this.caption = caption;&#10;    }&#10;&#10;    public void setUploadDate(Long uploadDate) {&#10;        this.uploadDate = uploadDate;&#10;    }&#10;&#10;    public void setVideoUrl(String videoUrl) {&#10;        this.videoUrl = videoUrl;&#10;    }&#10;&#10;    public void setThumbnailUrl(String thumbnailUrl) {&#10;        this.thumbnailUrl = thumbnailUrl;&#10;    }&#10;&#10;    public void setCategoryId(String categoryId) {&#10;        this.categoryId = categoryId;&#10;    }&#10;&#10;    public void setTags(Map&lt;String, Boolean&gt; tags) {&#10;        this.tags = tags;&#10;    }&#10;&#10;    public void setViewCount(Long viewCount) {&#10;        this.viewCount = viewCount;&#10;    }&#10;&#10;    public void setLikeCount(Long likeCount) {&#10;        this.likeCount = likeCount;&#10;    }&#10;&#10;    public void setUserId(String userId) {&#10;        this.userId = userId;&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra xem video có tag cụ thể hay không&#10;     * @param tag Tag cần kiểm tra&#10;     * @return true nếu video có tag này và tag được đánh dấu true&#10;     */&#10;    public boolean hasTag(String tag) {&#10;        return tags != null &amp;&amp; Boolean.TRUE.equals(tags.get(tag));&#10;    }&#10;&#10;    /**&#10;     * Thêm tag cho video&#10;     * @param tag Tag cần thêm&#10;     */&#10;    public void addTag(String tag) {&#10;        if (tags != null) {&#10;            tags.put(tag, true);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Xóa tag khỏi video&#10;     * @param tag Tag cần xóa&#10;     */&#10;    public void removeTag(String tag) {&#10;        if (tags != null) {&#10;            tags.remove(tag);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public String toString() {&#10;        return &quot;ShortVideoModel{&quot; +&#10;                &quot;id='&quot; + id + '\'' +&#10;                &quot;, title='&quot; + title + '\'' +&#10;                &quot;, caption='&quot; + caption + '\'' +&#10;                &quot;, uploadDate=&quot; + uploadDate +&#10;                &quot;, videoUrl='&quot; + videoUrl + '\'' +&#10;                &quot;, thumbnailUrl='&quot; + thumbnailUrl + '\'' +&#10;                &quot;, categoryId='&quot; + categoryId + '\'' +&#10;                &quot;, tags=&quot; + tags +&#10;                &quot;, viewCount=&quot; + viewCount +&#10;                &quot;, likeCount=&quot; + likeCount +&#10;                &quot;, userId='&quot; + userId + '\'' +&#10;                '}';&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.vhn.doan.data.model;&#10;&#10;import java.util.Map;&#10;&#10;/**&#10; * Model class để ánh xạ dữ liệu video ngắn từ Firebase node /videos/{videoId}&#10; * Sử dụng cho chức năng hiển thị video ngắn trong ShortVideoFragment&#10; */&#10;public class ShortVideoModel {&#10;&#10;    private String id; // Thêm field ID&#10;    private String title;&#10;    private String caption;&#10;    private Long uploadDate;&#10;    private String videoUrl;&#10;    private String thumbnailUrl;&#10;    private String categoryId;&#10;    private Map&lt;String, Boolean&gt; tags;&#10;    private Long viewCount;&#10;    private Long likeCount;&#10;    private String userId;&#10;&#10;    // Thêm các field mới cho metadata từ Firebase&#10;    private Boolean isActive;&#10;    private Integer duration; // Thời lượng video tính bằng giây&#10;&#10;    /**&#10;     * Constructor rỗng bắt buộc cho Firebase Realtime Database&#10;     */&#10;    public ShortVideoModel() {&#10;        // Constructor rỗng để Firebase có thể khởi tạo object&#10;    }&#10;&#10;    /**&#10;     * Constructor đầy đủ tham số&#10;     */&#10;    public ShortVideoModel(String id, String title, String caption, Long uploadDate, String videoUrl,&#10;                          String thumbnailUrl, String categoryId, Map&lt;String, Boolean&gt; tags,&#10;                          Long viewCount, Long likeCount, String userId) {&#10;        this.id = id;&#10;        this.title = title;&#10;        this.caption = caption;&#10;        this.uploadDate = uploadDate;&#10;        this.videoUrl = videoUrl;&#10;        this.thumbnailUrl = thumbnailUrl;&#10;        this.categoryId = categoryId;&#10;        this.tags = tags;&#10;        this.viewCount = viewCount;&#10;        this.likeCount = likeCount;&#10;        this.userId = userId;&#10;    }&#10;&#10;    /**&#10;     * Constructor đầy đủ tham số với các field mới&#10;     */&#10;    public ShortVideoModel(String id, String title, String caption, Long uploadDate, String videoUrl,&#10;                          String thumbnailUrl, String categoryId, Map&lt;String, Boolean&gt; tags,&#10;                          Long viewCount, Long likeCount, String userId, Boolean isActive, Integer duration) {&#10;        this.id = id;&#10;        this.title = title;&#10;        this.caption = caption;&#10;        this.uploadDate = uploadDate;&#10;        this.videoUrl = videoUrl;&#10;        this.thumbnailUrl = thumbnailUrl;&#10;        this.categoryId = categoryId;&#10;        this.tags = tags;&#10;        this.viewCount = viewCount;&#10;        this.likeCount = likeCount;&#10;        this.userId = userId;&#10;        this.isActive = isActive;&#10;        this.duration = duration;&#10;    }&#10;&#10;    // Getter methods&#10;    public String getId() {&#10;        return id;&#10;    }&#10;&#10;    public String getTitle() {&#10;        return title;&#10;    }&#10;&#10;    public String getCaption() {&#10;        return caption;&#10;    }&#10;&#10;    public Long getUploadDate() {&#10;        return uploadDate;&#10;    }&#10;&#10;    public String getVideoUrl() {&#10;        return videoUrl;&#10;    }&#10;&#10;    public String getThumbnailUrl() {&#10;        return thumbnailUrl;&#10;    }&#10;&#10;    public String getCategoryId() {&#10;        return categoryId;&#10;    }&#10;&#10;    public Map&lt;String, Boolean&gt; getTags() {&#10;        return tags;&#10;    }&#10;&#10;    public Long getViewCount() {&#10;        return viewCount;&#10;    }&#10;&#10;    public Long getLikeCount() {&#10;        return likeCount;&#10;    }&#10;&#10;    public String getUserId() {&#10;        return userId;&#10;    }&#10;&#10;    // Thêm getter cho các field mới&#10;    public Boolean getIsActive() {&#10;        return isActive;&#10;    }&#10;&#10;    public boolean isActive() {&#10;        return isActive != null ? isActive : false;&#10;    }&#10;&#10;    public Integer getDuration() {&#10;        return duration;&#10;    }&#10;&#10;    /**&#10;     * Lấy thời lượng video dưới dạng string (mm:ss)&#10;     * @return Thời lượng video format mm:ss&#10;     */&#10;    public String getFormattedDuration() {&#10;        if (duration == null || duration &lt;= 0) {&#10;            return &quot;00:00&quot;;&#10;        }&#10;&#10;        int minutes = duration / 60;&#10;        int seconds = duration % 60;&#10;        return String.format(&quot;%02d:%02d&quot;, minutes, seconds);&#10;    }&#10;&#10;    // Setter methods&#10;    public void setId(String id) {&#10;        this.id = id;&#10;    }&#10;&#10;    public void setTitle(String title) {&#10;        this.title = title;&#10;    }&#10;&#10;    public void setCaption(String caption) {&#10;        this.caption = caption;&#10;    }&#10;&#10;    public void setUploadDate(Long uploadDate) {&#10;        this.uploadDate = uploadDate;&#10;    }&#10;&#10;    public void setVideoUrl(String videoUrl) {&#10;        this.videoUrl = videoUrl;&#10;    }&#10;&#10;    public void setThumbnailUrl(String thumbnailUrl) {&#10;        this.thumbnailUrl = thumbnailUrl;&#10;    }&#10;&#10;    public void setCategoryId(String categoryId) {&#10;        this.categoryId = categoryId;&#10;    }&#10;&#10;    public void setTags(Map&lt;String, Boolean&gt; tags) {&#10;        this.tags = tags;&#10;    }&#10;&#10;    public void setViewCount(Long viewCount) {&#10;        this.viewCount = viewCount;&#10;    }&#10;&#10;    public void setLikeCount(Long likeCount) {&#10;        this.likeCount = likeCount;&#10;    }&#10;&#10;    public void setUserId(String userId) {&#10;        this.userId = userId;&#10;    }&#10;&#10;    // Thêm setter cho các field mới&#10;    public void setIsActive(Boolean isActive) {&#10;        this.isActive = isActive;&#10;    }&#10;&#10;    public void setDuration(Integer duration) {&#10;        this.duration = duration;&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra xem video có tag cụ thể hay không&#10;     * @param tag Tag cần kiểm tra&#10;     * @return true nếu video có tag này và tag được đánh dấu true&#10;     */&#10;    public boolean hasTag(String tag) {&#10;        return tags != null &amp;&amp; Boolean.TRUE.equals(tags.get(tag));&#10;    }&#10;&#10;    /**&#10;     * Thêm tag cho video&#10;     * @param tag Tag cần thêm&#10;     */&#10;    public void addTag(String tag) {&#10;        if (tags != null) {&#10;            tags.put(tag, true);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Xóa tag khỏi video&#10;     * @param tag Tag cần xóa&#10;     */&#10;    public void removeTag(String tag) {&#10;        if (tags != null) {&#10;            tags.remove(tag);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public String toString() {&#10;        return &quot;ShortVideoModel{&quot; +&#10;                &quot;id='&quot; + id + '\'' +&#10;                &quot;, title='&quot; + title + '\'' +&#10;                &quot;, caption='&quot; + caption + '\'' +&#10;                &quot;, uploadDate=&quot; + uploadDate +&#10;                &quot;, videoUrl='&quot; + videoUrl + '\'' +&#10;                &quot;, thumbnailUrl='&quot; + thumbnailUrl + '\'' +&#10;                &quot;, categoryId='&quot; + categoryId + '\'' +&#10;                &quot;, tags=&quot; + tags +&#10;                &quot;, viewCount=&quot; + viewCount +&#10;                &quot;, likeCount=&quot; + likeCount +&#10;                &quot;, userId='&quot; + userId + '\'' +&#10;                &quot;, isActive=&quot; + isActive +&#10;                &quot;, duration=&quot; + duration +&#10;                '}';&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/model/UserPreferenceModel.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/model/UserPreferenceModel.java" />
              <option name="updatedContent" value="package com.vhn.doan.data.model;&#10;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;/**&#10; * Model class để ánh xạ dữ liệu sở thích người dùng từ Firebase node /users/{userId}/preferences&#10; * Lưu trữ độ ưa thích của người dùng đối với các chủ đề dưới dạng Map&lt;String, Float&gt;&#10; * Giá trị Float từ 0.0 đến 1.0, trong đó 1.0 là ưa thích nhất&#10; */&#10;public class UserPreferenceModel {&#10;    &#10;    private Map&lt;String, Float&gt; preferences;&#10;&#10;    /**&#10;     * Constructor rỗng bắt buộc cho Firebase Realtime Database&#10;     */&#10;    public UserPreferenceModel() {&#10;        this.preferences = new HashMap&lt;&gt;();&#10;    }&#10;&#10;    /**&#10;     * Constructor với Map preferences&#10;     * @param preferences Map chứa sở thích người dùng (key: topic, value: preference score 0.0-1.0)&#10;     */&#10;    public UserPreferenceModel(Map&lt;String, Float&gt; preferences) {&#10;        this.preferences = preferences != null ? preferences : new HashMap&lt;&gt;();&#10;    }&#10;&#10;    // Getter và Setter&#10;    public Map&lt;String, Float&gt; getPreferences() {&#10;        return preferences;&#10;    }&#10;&#10;    public void setPreferences(Map&lt;String, Float&gt; preferences) {&#10;        this.preferences = preferences != null ? preferences : new HashMap&lt;&gt;();&#10;    }&#10;&#10;    /**&#10;     * Lấy điểm sở thích cho một chủ đề cụ thể&#10;     * @param topic Chủ đề cần lấy điểm&#10;     * @return Điểm sở thích (0.0-1.0) hoặc 0.0 nếu không tồn tại&#10;     */&#10;    public float getPreferenceScore(String topic) {&#10;        if (preferences == null || topic == null) {&#10;            return 0.0f;&#10;        }&#10;        Float score = preferences.get(topic);&#10;        return score != null ? score : 0.0f;&#10;    }&#10;&#10;    /**&#10;     * Cập nhật điểm sở thích cho một chủ đề&#10;     * @param topic Chủ đề cần cập nhật&#10;     * @param score Điểm sở thích mới (0.0-1.0)&#10;     */&#10;    public void setPreferenceScore(String topic, float score) {&#10;        if (preferences == null) {&#10;            preferences = new HashMap&lt;&gt;();&#10;        }&#10;        if (topic != null) {&#10;            // Đảm bảo điểm số trong khoảng 0.0-1.0&#10;            score = Math.max(0.0f, Math.min(1.0f, score));&#10;            preferences.put(topic, score);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Tăng điểm sở thích cho một chủ đề&#10;     * @param topic Chủ đề cần tăng điểm&#10;     * @param increment Mức tăng (có thể âm để giảm điểm)&#10;     */&#10;    public void incrementPreference(String topic, float increment) {&#10;        float currentScore = getPreferenceScore(topic);&#10;        setPreferenceScore(topic, currentScore + increment);&#10;    }&#10;&#10;    /**&#10;     * Xóa sở thích cho một chủ đề&#10;     * @param topic Chủ đề cần xóa&#10;     */&#10;    public void removePreference(String topic) {&#10;        if (preferences != null &amp;&amp; topic != null) {&#10;            preferences.remove(topic);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra xem có sở thích cho chủ đề nào không&#10;     * @param topic Chủ đề cần kiểm tra&#10;     * @return true nếu có sở thích cho chủ đề này&#10;     */&#10;    public boolean hasPreference(String topic) {&#10;        return preferences != null &amp;&amp; topic != null &amp;&amp; preferences.containsKey(topic);&#10;    }&#10;&#10;    /**&#10;     * Lấy số lượng chủ đề có sở thích&#10;     * @return Số lượng chủ đề&#10;     */&#10;    public int getPreferenceCount() {&#10;        return preferences != null ? preferences.size() : 0;&#10;    }&#10;&#10;    /**&#10;     * Xóa tất cả sở thích&#10;     */&#10;    public void clearPreferences() {&#10;        if (preferences != null) {&#10;            preferences.clear();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public String toString() {&#10;        return &quot;UserPreferenceModel{&quot; +&#10;                &quot;preferences=&quot; + preferences +&#10;                '}';&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/model/UserTopicModel.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/model/UserTopicModel.java" />
              <option name="updatedContent" value="package com.vhn.doan.data.model;&#10;&#10;import java.text.Normalizer;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;/**&#10; * Model class để ánh xạ dữ liệu chủ đề người dùng từ Firebase node /user_topics/{userId}&#10; * Lưu trữ số lần tương tác của người dùng với các chủ đề dưới dạng Map&lt;String, Long&gt;&#10; * Key có thể chứa khoảng trắng hoặc tiếng Việt, cần chuẩn hóa khi sử dụng làm tag&#10; */&#10;public class UserTopicModel {&#10;    &#10;    private Map&lt;String, Long&gt; topics;&#10;&#10;    /**&#10;     * Constructor rỗng bắt buộc cho Firebase Realtime Database&#10;     */&#10;    public UserTopicModel() {&#10;        this.topics = new HashMap&lt;&gt;();&#10;    }&#10;&#10;    /**&#10;     * Constructor với Map topics&#10;     * @param topics Map chứa chủ đề và số lần tương tác (key: topic name, value: interaction count)&#10;     */&#10;    public UserTopicModel(Map&lt;String, Long&gt; topics) {&#10;        this.topics = topics != null ? topics : new HashMap&lt;&gt;();&#10;    }&#10;&#10;    // Getter và Setter&#10;    public Map&lt;String, Long&gt; getTopics() {&#10;        return topics;&#10;    }&#10;&#10;    public void setTopics(Map&lt;String, Long&gt; topics) {&#10;        this.topics = topics != null ? topics : new HashMap&lt;&gt;();&#10;    }&#10;&#10;    /**&#10;     * Lấy số lần tương tác với một chủ đề cụ thể&#10;     * @param topic Tên chủ đề&#10;     * @return Số lần tương tác hoặc 0 nếu không tồn tại&#10;     */&#10;    public long getTopicCount(String topic) {&#10;        if (topics == null || topic == null) {&#10;            return 0L;&#10;        }&#10;        Long count = topics.get(topic);&#10;        return count != null ? count : 0L;&#10;    }&#10;&#10;    /**&#10;     * Cập nhật số lần tương tác cho một chủ đề&#10;     * @param topic Tên chủ đề&#10;     * @param count Số lần tương tác mới&#10;     */&#10;    public void setTopicCount(String topic, long count) {&#10;        if (topics == null) {&#10;            topics = new HashMap&lt;&gt;();&#10;        }&#10;        if (topic != null &amp;&amp; count &gt;= 0) {&#10;            topics.put(topic, count);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Tăng số lần tương tác cho một chủ đề&#10;     * @param topic Tên chủ đề&#10;     * @param increment Số lần tăng (mặc định là 1)&#10;     */&#10;    public void incrementTopicCount(String topic, long increment) {&#10;        long currentCount = getTopicCount(topic);&#10;        setTopicCount(topic, currentCount + increment);&#10;    }&#10;&#10;    /**&#10;     * Tăng số lần tương tác cho một chủ đề (tăng 1)&#10;     * @param topic Tên chủ đề&#10;     */&#10;    public void incrementTopicCount(String topic) {&#10;        incrementTopicCount(topic, 1L);&#10;    }&#10;&#10;    /**&#10;     * Xóa một chủ đề&#10;     * @param topic Tên chủ đề cần xóa&#10;     */&#10;    public void removeTopic(String topic) {&#10;        if (topics != null &amp;&amp; topic != null) {&#10;            topics.remove(topic);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra xem có chủ đề nào không&#10;     * @param topic Tên chủ đề cần kiểm tra&#10;     * @return true nếu có chủ đề này&#10;     */&#10;    public boolean hasTopic(String topic) {&#10;        return topics != null &amp;&amp; topic != null &amp;&amp; topics.containsKey(topic);&#10;    }&#10;&#10;    /**&#10;     * Lấy số lượng chủ đề&#10;     * @return Số lượng chủ đề&#10;     */&#10;    public int getTopicCount() {&#10;        return topics != null ? topics.size() : 0;&#10;    }&#10;&#10;    /**&#10;     * Xóa tất cả chủ đề&#10;     */&#10;    public void clearTopics() {&#10;        if (topics != null) {&#10;            topics.clear();&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Chuẩn hóa tên chủ đề thành tag sử dụng được&#10;     * Chuyển đổi các ký tự tiếng Việt có dấu thành không dấu&#10;     * Loại bỏ khoảng trắng và ký tự đặc biệt&#10;     * Chuyển thành chữ thường&#10;     * &#10;     * Ví dụ: &quot;Tim Mạch&quot; → &quot;timmach&quot;, &quot;Sức Khỏe&quot; → &quot;suckhoe&quot;&#10;     * &#10;     * @param topicName Tên chủ đề gốc&#10;     * @return Tag đã được chuẩn hóa&#10;     */&#10;    public static String normalizeTopicToTag(String topicName) {&#10;        if (topicName == null || topicName.trim().isEmpty()) {&#10;            return &quot;&quot;;&#10;        }&#10;&#10;        // Chuyển về chữ thường&#10;        String normalized = topicName.toLowerCase().trim();&#10;&#10;        // Loại bỏ dấu tiếng Việt&#10;        normalized = Normalizer.normalize(normalized, Normalizer.Form.NFD);&#10;        normalized = normalized.replaceAll(&quot;\\p{InCombiningDiacriticalMarks}+&quot;, &quot;&quot;);&#10;&#10;        // Thay thế các ký tự đặc biệt của tiếng Việt&#10;        normalized = normalized.replace(&quot;đ&quot;, &quot;d&quot;).replace(&quot;Đ&quot;, &quot;d&quot;);&#10;&#10;        // Loại bỏ khoảng trắng và ký tự đặc biệt, chỉ giữ lại chữ cái và số&#10;        normalized = normalized.replaceAll(&quot;[^a-zA-Z0-9]&quot;, &quot;&quot;);&#10;&#10;        return normalized;&#10;    }&#10;&#10;    /**&#10;     * Lấy tag đã chuẩn hóa từ một chủ đề có trong model&#10;     * @param topic Tên chủ đề&#10;     * @return Tag đã chuẩn hóa nếu chủ đề tồn tại, null nếu không tồn tại&#10;     */&#10;    public String getTopicTag(String topic) {&#10;        if (hasTopic(topic)) {&#10;            return normalizeTopicToTag(topic);&#10;        }&#10;        return null;&#10;    }&#10;&#10;    /**&#10;     * Lấy Map với key là tag đã chuẩn hóa và value là số lần tương tác&#10;     * @return Map&lt;tag_chuẩn_hóa, số_lần_tương_tác&gt;&#10;     */&#10;    public Map&lt;String, Long&gt; getTopicsAsTagMap() {&#10;        Map&lt;String, Long&gt; tagMap = new HashMap&lt;&gt;();&#10;        if (topics != null) {&#10;            for (Map.Entry&lt;String, Long&gt; entry : topics.entrySet()) {&#10;                String tag = normalizeTopicToTag(entry.getKey());&#10;                if (!tag.isEmpty()) {&#10;                    tagMap.put(tag, entry.getValue());&#10;                }&#10;            }&#10;        }&#10;        return tagMap;&#10;    }&#10;&#10;    @Override&#10;    public String toString() {&#10;        return &quot;UserTopicModel{&quot; +&#10;                &quot;topics=&quot; + topics +&#10;                '}';&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/repository/HealthTipVideoRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/repository/HealthTipVideoRepository.java" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/repository/VideoRepositoryImpl.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/data/repository/VideoRepositoryImpl.java" />
              <option name="originalContent" value="package com.vhn.doan.data.repository;&#10;&#10;import com.google.firebase.database.DataSnapshot;&#10;import com.google.firebase.database.DatabaseError;&#10;import com.google.firebase.database.DatabaseReference;&#10;import com.google.firebase.database.FirebaseDatabase;&#10;import com.google.firebase.database.Query;&#10;import com.google.firebase.database.ValueEventListener;&#10;import com.vhn.doan.data.Video;&#10;&#10;import java.util.ArrayList;&#10;import java.util.Collections;&#10;import java.util.Comparator;&#10;import java.util.HashMap;&#10;import java.util.List;&#10;import java.util.Map;&#10;&#10;public class VideoRepositoryImpl implements VideoRepository {&#10;&#10;    private DatabaseReference databaseReference;&#10;&#10;    public VideoRepositoryImpl() {&#10;        this.databaseReference = FirebaseDatabase.getInstance().getReference();&#10;    }&#10;&#10;    @Override&#10;    public void getRecommendedVideos(String userId, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        // Lấy preferences và topics của user để đề xuất video&#10;        getUserPreferences(userId, new RepositoryCallback&lt;Map&lt;String, Double&gt;&gt;() {&#10;            @Override&#10;            public void onSuccess(Map&lt;String, Double&gt; preferences) {&#10;                getUserTopics(userId, new RepositoryCallback&lt;Map&lt;String, Long&gt;&gt;() {&#10;                    @Override&#10;                    public void onSuccess(Map&lt;String, Long&gt; topics) {&#10;                        // Kết hợp preferences và topics để tạo danh sách tags ưu tiên&#10;                        Map&lt;String, Double&gt; combinedTags = combinePreferencesAndTopics(preferences, topics);&#10;&#10;                        // Lấy tất cả video và lọc theo tags ưu tiên&#10;                        getAllVideos(new RepositoryCallback&lt;List&lt;Video&gt;&gt;() {&#10;                            @Override&#10;                            public void onSuccess(List&lt;Video&gt; allVideos) {&#10;                                List&lt;Video&gt; recommendedVideos = filterAndSortByRecommendation(allVideos, combinedTags);&#10;                                callback.onSuccess(recommendedVideos);&#10;                            }&#10;&#10;                            @Override&#10;                            public void onFailure(String error) {&#10;                                // Nếu lỗi, fallback về trending videos&#10;                                getTrendingVideos(&quot;vietnam&quot;, callback);&#10;                            }&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onFailure(String error) {&#10;                        // Nếu không có topics, chỉ dùng preferences&#10;                        getAllVideos(new RepositoryCallback&lt;List&lt;Video&gt;&gt;() {&#10;                            @Override&#10;                            public void onSuccess(List&lt;Video&gt; allVideos) {&#10;                                List&lt;Video&gt; recommendedVideos = filterAndSortByRecommendation(allVideos, preferences);&#10;                                callback.onSuccess(recommendedVideos);&#10;                            }&#10;&#10;                            @Override&#10;                            public void onFailure(String error) {&#10;                                getTrendingVideos(&quot;vietnam&quot;, callback);&#10;                            }&#10;                        });&#10;                    }&#10;                });&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(String error) {&#10;                // Nếu người dùng mới, hiển thị trending videos&#10;                getTrendingVideos(&quot;vietnam&quot;, callback);&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    public void getTrendingVideos(String region, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        databaseReference.child(&quot;trendingVideos&quot;).child(region)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    List&lt;String&gt; trendingVideoIds = new ArrayList&lt;&gt;();&#10;                    for (DataSnapshot child : snapshot.getChildren()) {&#10;                        trendingVideoIds.add(child.getKey());&#10;                    }&#10;&#10;                    if (trendingVideoIds.isEmpty()) {&#10;                        // Fallback: lấy video có viewCount cao nhất&#10;                        getTopViewedVideos(callback);&#10;                    } else {&#10;                        getVideosByIds(trendingVideoIds, callback);&#10;                    }&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    getTopViewedVideos(callback);&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void getVideosByCategory(String categoryId, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        databaseReference.child(&quot;videos&quot;)&#10;            .orderByChild(&quot;categoryId&quot;)&#10;            .equalTo(categoryId)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    List&lt;Video&gt; videos = new ArrayList&lt;&gt;();&#10;                    for (DataSnapshot child : snapshot.getChildren()) {&#10;                        Video video = child.getValue(Video.class);&#10;                        if (video != null) {&#10;                            videos.add(video);&#10;                        }&#10;                    }&#10;&#10;                    // Sắp xếp theo ngày upload mới nhất&#10;                    Collections.sort(videos, (v1, v2) -&gt; Long.compare(v2.getUploadDate(), v1.getUploadDate()));&#10;                    callback.onSuccess(videos);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onFailure(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void getVideosByTags(List&lt;String&gt; tags, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        getAllVideos(new RepositoryCallback&lt;List&lt;Video&gt;&gt;() {&#10;            @Override&#10;            public void onSuccess(List&lt;Video&gt; allVideos) {&#10;                List&lt;Video&gt; filteredVideos = new ArrayList&lt;&gt;();&#10;&#10;                for (Video video : allVideos) {&#10;                    if (video.getTags() != null) {&#10;                        boolean hasMatchingTag = false;&#10;                        for (String tag : tags) {&#10;                            if (video.getTags().containsKey(tag) &amp;&amp; video.getTags().get(tag)) {&#10;                                hasMatchingTag = true;&#10;                                break;&#10;                            }&#10;                        }&#10;                        if (hasMatchingTag) {&#10;                            filteredVideos.add(video);&#10;                        }&#10;                    }&#10;                }&#10;&#10;                // Sắp xếp theo likeCount và viewCount&#10;                Collections.sort(filteredVideos, (v1, v2) -&gt; {&#10;                    int likeDiff = v2.getLikeCount() - v1.getLikeCount();&#10;                    if (likeDiff == 0) {&#10;                        return v2.getViewCount() - v1.getViewCount();&#10;                    }&#10;                    return likeDiff;&#10;                });&#10;&#10;                callback.onSuccess(filteredVideos);&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(String error) {&#10;                callback.onFailure(error);&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    public void getVideoById(String videoId, RepositoryCallback&lt;Video&gt; callback) {&#10;        databaseReference.child(&quot;videos&quot;).child(videoId)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    Video video = snapshot.getValue(Video.class);&#10;                    if (video != null) {&#10;                        callback.onSuccess(video);&#10;                    } else {&#10;                        callback.onFailure(&quot;Video not found&quot;);&#10;                    }&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onFailure(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void incrementViewCount(String videoId, RepositoryCallback&lt;Void&gt; callback) {&#10;        DatabaseReference videoRef = databaseReference.child(&quot;videos&quot;).child(videoId).child(&quot;viewCount&quot;);&#10;        videoRef.addListenerForSingleValueEvent(new ValueEventListener() {&#10;            @Override&#10;            public void onDataChange(DataSnapshot snapshot) {&#10;                int currentCount = snapshot.getValue(Integer.class) != null ? snapshot.getValue(Integer.class) : 0;&#10;                videoRef.setValue(currentCount + 1)&#10;                    .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;                    .addOnFailureListener(e -&gt; callback.onFailure(e.getMessage()));&#10;            }&#10;&#10;            @Override&#10;            public void onCancelled(DatabaseError error) {&#10;                callback.onFailure(error.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    public void toggleLikeVideo(String videoId, String userId, boolean isLiked, RepositoryCallback&lt;Void&gt; callback) {&#10;        DatabaseReference userLikesRef = databaseReference.child(&quot;user_likes&quot;).child(userId).child(videoId);&#10;        DatabaseReference videoLikeCountRef = databaseReference.child(&quot;videos&quot;).child(videoId).child(&quot;likeCount&quot;);&#10;&#10;        if (isLiked) {&#10;            // Thêm like&#10;            userLikesRef.setValue(true);&#10;            videoLikeCountRef.addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    int currentCount = snapshot.getValue(Integer.class) != null ? snapshot.getValue(Integer.class) : 0;&#10;                    videoLikeCountRef.setValue(currentCount + 1)&#10;                        .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;                        .addOnFailureListener(e -&gt; callback.onFailure(e.getMessage()));&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onFailure(error.getMessage());&#10;                }&#10;            });&#10;        } else {&#10;            // Bỏ like&#10;            userLikesRef.removeValue();&#10;            videoLikeCountRef.addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    int currentCount = snapshot.getValue(Integer.class) != null ? snapshot.getValue(Integer.class) : 0;&#10;                    videoLikeCountRef.setValue(Math.max(0, currentCount - 1))&#10;                        .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;                        .addOnFailureListener(e -&gt; callback.onFailure(e.getMessage()));&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onFailure(error.getMessage());&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void isVideoLiked(String videoId, String userId, RepositoryCallback&lt;Boolean&gt; callback) {&#10;        databaseReference.child(&quot;user_likes&quot;).child(userId).child(videoId)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    boolean isLiked = snapshot.exists() &amp;&amp; snapshot.getValue(Boolean.class) != null&#10;                        &amp;&amp; snapshot.getValue(Boolean.class);&#10;                    callback.onSuccess(isLiked);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onFailure(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void saveVideoView(String videoId, String userId, RepositoryCallback&lt;Void&gt; callback) {&#10;        long timestamp = System.currentTimeMillis();&#10;        databaseReference.child(&quot;user_views&quot;).child(userId).child(videoId).setValue(timestamp)&#10;            .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;            .addOnFailureListener(e -&gt; callback.onFailure(e.getMessage()));&#10;    }&#10;&#10;    @Override&#10;    public void getUserPreferences(String userId, RepositoryCallback&lt;Map&lt;String, Double&gt;&gt; callback) {&#10;        databaseReference.child(&quot;users&quot;).child(userId).child(&quot;preferences&quot;)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    Map&lt;String, Double&gt; preferences = new HashMap&lt;&gt;();&#10;                    if (snapshot.exists()) {&#10;                        for (DataSnapshot child : snapshot.getChildren()) {&#10;                            String tag = child.getKey();&#10;                            Double score = child.getValue(Double.class);&#10;                            if (tag != null &amp;&amp; score != null) {&#10;                                preferences.put(tag, score);&#10;                            }&#10;                        }&#10;                    }&#10;                    callback.onSuccess(preferences);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onFailure(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void getUserTopics(String userId, RepositoryCallback&lt;Map&lt;String, Long&gt;&gt; callback) {&#10;        databaseReference.child(&quot;user_topics&quot;).child(userId)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    Map&lt;String, Long&gt; topics = new HashMap&lt;&gt;();&#10;                    if (snapshot.exists()) {&#10;                        for (DataSnapshot child : snapshot.getChildren()) {&#10;                            String topic = child.getKey();&#10;                            Long timestamp = child.getValue(Long.class);&#10;                            if (topic != null &amp;&amp; timestamp != null) {&#10;                                topics.put(topic, timestamp);&#10;                            }&#10;                        }&#10;                    }&#10;                    callback.onSuccess(topics);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onFailure(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void updateUserPreferences(String userId, String tag, double score, RepositoryCallback&lt;Void&gt; callback) {&#10;        databaseReference.child(&quot;users&quot;).child(userId).child(&quot;preferences&quot;).child(tag).setValue(score)&#10;            .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;            .addOnFailureListener(e -&gt; callback.onFailure(e.getMessage()));&#10;    }&#10;&#10;    // Helper methods&#10;    private void getAllVideos(RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        databaseReference.child(&quot;videos&quot;)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    List&lt;Video&gt; videos = new ArrayList&lt;&gt;();&#10;                    for (DataSnapshot child : snapshot.getChildren()) {&#10;                        Video video = child.getValue(Video.class);&#10;                        if (video != null) {&#10;                            videos.add(video);&#10;                        }&#10;                    }&#10;                    callback.onSuccess(videos);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onFailure(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    private void getTopViewedVideos(RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        databaseReference.child(&quot;videos&quot;)&#10;            .orderByChild(&quot;viewCount&quot;)&#10;            .limitToLast(20)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    List&lt;Video&gt; videos = new ArrayList&lt;&gt;();&#10;                    for (DataSnapshot child : snapshot.getChildren()) {&#10;                        Video video = child.getValue(Video.class);&#10;                        if (video != null) {&#10;                            videos.add(video);&#10;                        }&#10;                    }&#10;&#10;                    // Đảo ngược để có viewCount cao nhất trước&#10;                    Collections.reverse(videos);&#10;                    callback.onSuccess(videos);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onFailure(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    private void getVideosByIds(List&lt;String&gt; videoIds, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        List&lt;Video&gt; videos = new ArrayList&lt;&gt;();&#10;        final int[] completedCount = {0};&#10;&#10;        if (videoIds.isEmpty()) {&#10;            callback.onSuccess(videos);&#10;            return;&#10;        }&#10;&#10;        for (String videoId : videoIds) {&#10;            getVideoById(videoId, new RepositoryCallback&lt;Video&gt;() {&#10;                @Override&#10;                public void onSuccess(Video video) {&#10;                    synchronized (videos) {&#10;                        videos.add(video);&#10;                        completedCount[0]++;&#10;                        if (completedCount[0] == videoIds.size()) {&#10;                            callback.onSuccess(videos);&#10;                        }&#10;                    }&#10;                }&#10;&#10;                @Override&#10;                public void onFailure(String error) {&#10;                    synchronized (videos) {&#10;                        completedCount[0]++;&#10;                        if (completedCount[0] == videoIds.size()) {&#10;                            callback.onSuccess(videos);&#10;                        }&#10;                    }&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    private Map&lt;String, Double&gt; combinePreferencesAndTopics(Map&lt;String, Double&gt; preferences, Map&lt;String, Long&gt; topics) {&#10;        Map&lt;String, Double&gt; combined = new HashMap&lt;&gt;(preferences);&#10;&#10;        // Chuyển đổi topics thành tags và thêm vào combined&#10;        for (Map.Entry&lt;String, Long&gt; entry : topics.entrySet()) {&#10;            String topic = entry.getKey();&#10;            String tag = mapTopicToTag(topic);&#10;&#10;            // Tính điểm dựa trên thời gian gần đây (topics mới có điểm cao hơn)&#10;            long currentTime = System.currentTimeMillis();&#10;            long timeDiff = currentTime - entry.getValue();&#10;            double timeScore = Math.max(0.1, 1.0 - (timeDiff / (7 * 24 * 60 * 60 * 1000.0))); // Giảm theo thời gian, tối thiểu 0.1&#10;&#10;            combined.put(tag, combined.getOrDefault(tag, 0.0) + timeScore);&#10;        }&#10;&#10;        return combined;&#10;    }&#10;&#10;    private String mapTopicToTag(String topic) {&#10;        // Ánh xạ các topic từ AI thành tags video tương ứng&#10;        String lowerTopic = topic.toLowerCase();&#10;&#10;        if (lowerTopic.contains(&quot;giảm cân&quot;) || lowerTopic.contains(&quot;giamcan&quot;)) {&#10;            return &quot;giamcan&quot;;&#10;        } else if (lowerTopic.contains(&quot;tập luyện&quot;) || lowerTopic.contains(&quot;tapluyen&quot;) || lowerTopic.contains(&quot;thể dục&quot;)) {&#10;            return &quot;tapluyen&quot;;&#10;        } else if (lowerTopic.contains(&quot;tim mạch&quot;) || lowerTopic.contains(&quot;timmach&quot;) || lowerTopic.contains(&quot;huyết áp&quot;)) {&#10;            return &quot;timmach&quot;;&#10;        } else if (lowerTopic.contains(&quot;dinh dưỡng&quot;) || lowerTopic.contains(&quot;dinhduong&quot;) || lowerTopic.contains(&quot;ăn uống&quot;)) {&#10;            return &quot;dinhduong&quot;;&#10;        } else if (lowerTopic.contains(&quot;yoga&quot;) || lowerTopic.contains(&quot;thiền&quot;)) {&#10;            return &quot;yoga&quot;;&#10;        } else if (lowerTopic.contains(&quot;ngủ&quot;) || lowerTopic.contains(&quot;giấc ngủ&quot;)) {&#10;            return &quot;giacngu&quot;;&#10;        } else {&#10;            return &quot;suckhoe&quot;; // Default tag cho các topic khác&#10;        }&#10;    }&#10;&#10;    private List&lt;Video&gt; filterAndSortByRecommendation(List&lt;Video&gt; videos, Map&lt;String, Double&gt; userTags) {&#10;        List&lt;VideoScore&gt; videoScores = new ArrayList&lt;&gt;();&#10;&#10;        for (Video video : videos) {&#10;            double score = calculateRecommendationScore(video, userTags);&#10;            if (score &gt; 0) {&#10;                videoScores.add(new VideoScore(video, score));&#10;            }&#10;        }&#10;&#10;        // Sắp xếp theo điểm recommendation và thời gian upload&#10;        Collections.sort(videoScores, (vs1, vs2) -&gt; {&#10;            int scoreCompare = Double.compare(vs2.score, vs1.score);&#10;            if (scoreCompare == 0) {&#10;                return Long.compare(vs2.video.getUploadDate(), vs1.video.getUploadDate());&#10;            }&#10;            return scoreCompare;&#10;        });&#10;&#10;        List&lt;Video&gt; recommendedVideos = new ArrayList&lt;&gt;();&#10;        for (VideoScore vs : videoScores) {&#10;            recommendedVideos.add(vs.video);&#10;        }&#10;&#10;        return recommendedVideos;&#10;    }&#10;&#10;    private double calculateRecommendationScore(Video video, Map&lt;String, Double&gt; userTags) {&#10;        double score = 0.0;&#10;&#10;        if (video.getTags() != null) {&#10;            for (Map.Entry&lt;String, Boolean&gt; tagEntry : video.getTags().entrySet()) {&#10;                if (tagEntry.getValue() &amp;&amp; userTags.containsKey(tagEntry.getKey())) {&#10;                    score += userTags.get(tagEntry.getKey());&#10;                }&#10;            }&#10;        }&#10;&#10;        // Thêm điểm bonus cho video có viewCount và likeCount cao&#10;        score += Math.log(video.getViewCount() + 1) * 0.1;&#10;        score += Math.log(video.getLikeCount() + 1) * 0.2;&#10;&#10;        // Thêm điểm bonus cho video mới&#10;        long daysSinceUpload = (System.currentTimeMillis() - video.getUploadDate()) / (24 * 60 * 60 * 1000);&#10;        if (daysSinceUpload &lt; 7) {&#10;            score += 0.5; // Bonus cho video mới trong 7 ngày&#10;        }&#10;&#10;        return score;&#10;    }&#10;&#10;    private static class VideoScore {&#10;        Video video;&#10;        double score;&#10;&#10;        VideoScore(Video video, double score) {&#10;            this.video = video;&#10;            this.score = score;&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.vhn.doan.data.repository;&#10;&#10;import com.google.firebase.database.DataSnapshot;&#10;import com.google.firebase.database.DatabaseError;&#10;import com.google.firebase.database.DatabaseReference;&#10;import com.google.firebase.database.FirebaseDatabase;&#10;import com.google.firebase.database.Query;&#10;import com.google.firebase.database.ValueEventListener;&#10;import com.vhn.doan.data.Video;&#10;&#10;import java.util.ArrayList;&#10;import java.util.Collections;&#10;import java.util.Comparator;&#10;import java.util.HashMap;&#10;import java.util.List;&#10;import java.util.Map;&#10;&#10;public class VideoRepositoryImpl implements VideoRepository {&#10;&#10;    private DatabaseReference databaseReference;&#10;&#10;    public VideoRepositoryImpl() {&#10;        this.databaseReference = FirebaseDatabase.getInstance().getReference();&#10;    }&#10;&#10;    @Override&#10;    public void getRecommendedVideos(String userId, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        // Lấy preferences và topics của user để đề xuất video&#10;        getUserPreferences(userId, new RepositoryCallback&lt;Map&lt;String, Double&gt;&gt;() {&#10;            @Override&#10;            public void onSuccess(Map&lt;String, Double&gt; preferences) {&#10;                getUserTopics(userId, new RepositoryCallback&lt;Map&lt;String, Long&gt;&gt;() {&#10;                    @Override&#10;                    public void onSuccess(Map&lt;String, Long&gt; topics) {&#10;                        // Kết hợp preferences và topics để tạo danh sách tags ưu tiên&#10;                        Map&lt;String, Double&gt; combinedTags = combinePreferencesAndTopics(preferences, topics);&#10;&#10;                        // Lấy tất cả video và lọc theo tags ưu tiên&#10;                        getAllVideos(new RepositoryCallback&lt;List&lt;Video&gt;&gt;() {&#10;                            @Override&#10;                            public void onSuccess(List&lt;Video&gt; allVideos) {&#10;                                List&lt;Video&gt; recommendedVideos = filterAndSortByRecommendation(allVideos, combinedTags);&#10;                                callback.onSuccess(recommendedVideos);&#10;                            }&#10;&#10;                            @Override&#10;                            public void onError(String error) {&#10;                                // Nếu lỗi, fallback về trending videos&#10;                                getTrendingVideos(&quot;vietnam&quot;, callback);&#10;                            }&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onError(String error) {&#10;                        // Nếu không có topics, chỉ dùng preferences&#10;                        getAllVideos(new RepositoryCallback&lt;List&lt;Video&gt;&gt;() {&#10;                            @Override&#10;                            public void onSuccess(List&lt;Video&gt; allVideos) {&#10;                                List&lt;Video&gt; recommendedVideos = filterAndSortByRecommendation(allVideos, preferences);&#10;                                callback.onSuccess(recommendedVideos);&#10;                            }&#10;&#10;                            @Override&#10;                            public void onError(String error) {&#10;                                getTrendingVideos(&quot;vietnam&quot;, callback);&#10;                            }&#10;                        });&#10;                    }&#10;                });&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                // Nếu người dùng mới, hiển thị trending videos&#10;                getTrendingVideos(&quot;vietnam&quot;, callback);&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    public void getTrendingVideos(String region, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        databaseReference.child(&quot;trendingVideos&quot;).child(region)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    List&lt;String&gt; trendingVideoIds = new ArrayList&lt;&gt;();&#10;                    for (DataSnapshot child : snapshot.getChildren()) {&#10;                        trendingVideoIds.add(child.getKey());&#10;                    }&#10;&#10;                    if (trendingVideoIds.isEmpty()) {&#10;                        // Fallback: lấy video có viewCount cao nhất&#10;                        getTopViewedVideos(callback);&#10;                    } else {&#10;                        getVideosByIds(trendingVideoIds, callback);&#10;                    }&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    getTopViewedVideos(callback);&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void getVideosByCategory(String categoryId, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        databaseReference.child(&quot;videos&quot;)&#10;            .orderByChild(&quot;categoryId&quot;)&#10;            .equalTo(categoryId)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    List&lt;Video&gt; videos = new ArrayList&lt;&gt;();&#10;                    for (DataSnapshot child : snapshot.getChildren()) {&#10;                        Video video = child.getValue(Video.class);&#10;                        if (video != null) {&#10;                            videos.add(video);&#10;                        }&#10;                    }&#10;&#10;                    // Sắp xếp theo ngày upload mới nhất&#10;                    Collections.sort(videos, (v1, v2) -&gt; Long.compare(v2.getUploadDate(), v1.getUploadDate()));&#10;                    callback.onSuccess(videos);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onError(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void getVideosByTags(List&lt;String&gt; tags, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        getAllVideos(new RepositoryCallback&lt;List&lt;Video&gt;&gt;() {&#10;            @Override&#10;            public void onSuccess(List&lt;Video&gt; allVideos) {&#10;                List&lt;Video&gt; filteredVideos = new ArrayList&lt;&gt;();&#10;&#10;                for (Video video : allVideos) {&#10;                    if (video.getTags() != null) {&#10;                        boolean hasMatchingTag = false;&#10;                        for (String tag : tags) {&#10;                            if (video.getTags().containsKey(tag) &amp;&amp; video.getTags().get(tag)) {&#10;                                hasMatchingTag = true;&#10;                                break;&#10;                            }&#10;                        }&#10;                        if (hasMatchingTag) {&#10;                            filteredVideos.add(video);&#10;                        }&#10;                    }&#10;                }&#10;&#10;                // Sắp xếp theo likeCount và viewCount&#10;                Collections.sort(filteredVideos, (v1, v2) -&gt; {&#10;                    int likeDiff = v2.getLikeCount() - v1.getLikeCount();&#10;                    if (likeDiff == 0) {&#10;                        return v2.getViewCount() - v1.getViewCount();&#10;                    }&#10;                    return likeDiff;&#10;                });&#10;&#10;                callback.onSuccess(filteredVideos);&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                callback.onError(error);&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    public void getVideoById(String videoId, RepositoryCallback&lt;Video&gt; callback) {&#10;        databaseReference.child(&quot;videos&quot;).child(videoId)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    Video video = snapshot.getValue(Video.class);&#10;                    if (video != null) {&#10;                        callback.onSuccess(video);&#10;                    } else {&#10;                        callback.onError(&quot;Video not found&quot;);&#10;                    }&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onError(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void incrementViewCount(String videoId, RepositoryCallback&lt;Void&gt; callback) {&#10;        DatabaseReference videoRef = databaseReference.child(&quot;videos&quot;).child(videoId).child(&quot;viewCount&quot;);&#10;        videoRef.addListenerForSingleValueEvent(new ValueEventListener() {&#10;            @Override&#10;            public void onDataChange(DataSnapshot snapshot) {&#10;                int currentCount = snapshot.getValue(Integer.class) != null ? snapshot.getValue(Integer.class) : 0;&#10;                videoRef.setValue(currentCount + 1)&#10;                    .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;                    .addOnFailureListener(e -&gt; callback.onError(e.getMessage()));&#10;            }&#10;&#10;            @Override&#10;            public void onCancelled(DatabaseError error) {&#10;                callback.onError(error.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    public void toggleLikeVideo(String videoId, String userId, boolean isLiked, RepositoryCallback&lt;Void&gt; callback) {&#10;        DatabaseReference userLikesRef = databaseReference.child(&quot;user_likes&quot;).child(userId).child(videoId);&#10;        DatabaseReference videoLikeCountRef = databaseReference.child(&quot;videos&quot;).child(videoId).child(&quot;likeCount&quot;);&#10;&#10;        if (isLiked) {&#10;            // Thêm like&#10;            userLikesRef.setValue(true);&#10;            videoLikeCountRef.addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    int currentCount = snapshot.getValue(Integer.class) != null ? snapshot.getValue(Integer.class) : 0;&#10;                    videoLikeCountRef.setValue(currentCount + 1)&#10;                        .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;                        .addOnFailureListener(e -&gt; callback.onError(e.getMessage()));&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onError(error.getMessage());&#10;                }&#10;            });&#10;        } else {&#10;            // Bỏ like&#10;            userLikesRef.removeValue();&#10;            videoLikeCountRef.addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    int currentCount = snapshot.getValue(Integer.class) != null ? snapshot.getValue(Integer.class) : 0;&#10;                    videoLikeCountRef.setValue(Math.max(0, currentCount - 1))&#10;                        .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;                        .addOnFailureListener(e -&gt; callback.onError(e.getMessage()));&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onError(error.getMessage());&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void isVideoLiked(String videoId, String userId, RepositoryCallback&lt;Boolean&gt; callback) {&#10;        databaseReference.child(&quot;user_likes&quot;).child(userId).child(videoId)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    boolean isLiked = snapshot.exists() &amp;&amp; snapshot.getValue(Boolean.class) != null &#10;                        &amp;&amp; snapshot.getValue(Boolean.class);&#10;                    callback.onSuccess(isLiked);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onError(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void saveVideoView(String videoId, String userId, RepositoryCallback&lt;Void&gt; callback) {&#10;        long timestamp = System.currentTimeMillis();&#10;        databaseReference.child(&quot;user_views&quot;).child(userId).child(videoId).setValue(timestamp)&#10;            .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;            .addOnFailureListener(e -&gt; callback.onError(e.getMessage()));&#10;    }&#10;&#10;    @Override&#10;    public void getUserPreferences(String userId, RepositoryCallback&lt;Map&lt;String, Double&gt;&gt; callback) {&#10;        databaseReference.child(&quot;users&quot;).child(userId).child(&quot;preferences&quot;)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    Map&lt;String, Double&gt; preferences = new HashMap&lt;&gt;();&#10;                    if (snapshot.exists()) {&#10;                        for (DataSnapshot child : snapshot.getChildren()) {&#10;                            String tag = child.getKey();&#10;                            Double score = child.getValue(Double.class);&#10;                            if (tag != null &amp;&amp; score != null) {&#10;                                preferences.put(tag, score);&#10;                            }&#10;                        }&#10;                    }&#10;                    callback.onSuccess(preferences);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onError(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void getUserTopics(String userId, RepositoryCallback&lt;Map&lt;String, Long&gt;&gt; callback) {&#10;        databaseReference.child(&quot;user_topics&quot;).child(userId)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    Map&lt;String, Long&gt; topics = new HashMap&lt;&gt;();&#10;                    if (snapshot.exists()) {&#10;                        for (DataSnapshot child : snapshot.getChildren()) {&#10;                            String topic = child.getKey();&#10;                            Long timestamp = child.getValue(Long.class);&#10;                            if (topic != null &amp;&amp; timestamp != null) {&#10;                                topics.put(topic, timestamp);&#10;                            }&#10;                        }&#10;                    }&#10;                    callback.onSuccess(topics);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onError(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    @Override&#10;    public void updateUserPreferences(String userId, String tag, double score, RepositoryCallback&lt;Void&gt; callback) {&#10;        databaseReference.child(&quot;users&quot;).child(userId).child(&quot;preferences&quot;).child(tag).setValue(score)&#10;            .addOnSuccessListener(aVoid -&gt; callback.onSuccess(null))&#10;            .addOnFailureListener(e -&gt; callback.onError(e.getMessage()));&#10;    }&#10;&#10;    // Helper methods&#10;    private void getAllVideos(RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        databaseReference.child(&quot;videos&quot;)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    List&lt;Video&gt; videos = new ArrayList&lt;&gt;();&#10;                    for (DataSnapshot child : snapshot.getChildren()) {&#10;                        Video video = child.getValue(Video.class);&#10;                        if (video != null) {&#10;                            videos.add(video);&#10;                        }&#10;                    }&#10;                    callback.onSuccess(videos);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onError(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    private void getTopViewedVideos(RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        databaseReference.child(&quot;videos&quot;)&#10;            .orderByChild(&quot;viewCount&quot;)&#10;            .limitToLast(20)&#10;            .addListenerForSingleValueEvent(new ValueEventListener() {&#10;                @Override&#10;                public void onDataChange(DataSnapshot snapshot) {&#10;                    List&lt;Video&gt; videos = new ArrayList&lt;&gt;();&#10;                    for (DataSnapshot child : snapshot.getChildren()) {&#10;                        Video video = child.getValue(Video.class);&#10;                        if (video != null) {&#10;                            videos.add(video);&#10;                        }&#10;                    }&#10;&#10;                    // Đảo ngược để có viewCount cao nhất trước&#10;                    Collections.reverse(videos);&#10;                    callback.onSuccess(videos);&#10;                }&#10;&#10;                @Override&#10;                public void onCancelled(DatabaseError error) {&#10;                    callback.onError(error.getMessage());&#10;                }&#10;            });&#10;    }&#10;&#10;    private void getVideosByIds(List&lt;String&gt; videoIds, RepositoryCallback&lt;List&lt;Video&gt;&gt; callback) {&#10;        List&lt;Video&gt; videos = new ArrayList&lt;&gt;();&#10;        final int[] completedCount = {0};&#10;&#10;        if (videoIds.isEmpty()) {&#10;            callback.onSuccess(videos);&#10;            return;&#10;        }&#10;&#10;        for (String videoId : videoIds) {&#10;            getVideoById(videoId, new RepositoryCallback&lt;Video&gt;() {&#10;                @Override&#10;                public void onSuccess(Video video) {&#10;                    synchronized (videos) {&#10;                        videos.add(video);&#10;                        completedCount[0]++;&#10;                        if (completedCount[0] == videoIds.size()) {&#10;                            callback.onSuccess(videos);&#10;                        }&#10;                    }&#10;                }&#10;&#10;                @Override&#10;                public void onError(String error) {&#10;                    synchronized (videos) {&#10;                        completedCount[0]++;&#10;                        if (completedCount[0] == videoIds.size()) {&#10;                            callback.onSuccess(videos);&#10;                        }&#10;                    }&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    private Map&lt;String, Double&gt; combinePreferencesAndTopics(Map&lt;String, Double&gt; preferences, Map&lt;String, Long&gt; topics) {&#10;        Map&lt;String, Double&gt; combined = new HashMap&lt;&gt;(preferences);&#10;&#10;        // Chuyển đổi topics thành tags và thêm vào combined&#10;        for (Map.Entry&lt;String, Long&gt; entry : topics.entrySet()) {&#10;            String topic = entry.getKey();&#10;            String tag = mapTopicToTag(topic);&#10;&#10;            // Tính điểm dựa trên thời gian gần đây (topics mới có điểm cao hơn)&#10;            long currentTime = System.currentTimeMillis();&#10;            long timeDiff = currentTime - entry.getValue();&#10;            double timeScore = Math.max(0.1, 1.0 - (timeDiff / (7 * 24 * 60 * 60 * 1000.0))); // Giảm theo thời gian, tối thiểu 0.1&#10;&#10;            combined.put(tag, combined.getOrDefault(tag, 0.0) + timeScore);&#10;        }&#10;&#10;        return combined;&#10;    }&#10;&#10;    private String mapTopicToTag(String topic) {&#10;        // Ánh xạ các topic từ AI thành tags video tương ứng&#10;        String lowerTopic = topic.toLowerCase();&#10;&#10;        if (lowerTopic.contains(&quot;giảm cân&quot;) || lowerTopic.contains(&quot;giamcan&quot;)) {&#10;            return &quot;giamcan&quot;;&#10;        } else if (lowerTopic.contains(&quot;tập luyện&quot;) || lowerTopic.contains(&quot;tapluyen&quot;) || lowerTopic.contains(&quot;thể dục&quot;)) {&#10;            return &quot;tapluyen&quot;;&#10;        } else if (lowerTopic.contains(&quot;tim mạch&quot;) || lowerTopic.contains(&quot;timmach&quot;) || lowerTopic.contains(&quot;huyết áp&quot;)) {&#10;            return &quot;timmach&quot;;&#10;        } else if (lowerTopic.contains(&quot;dinh dưỡng&quot;) || lowerTopic.contains(&quot;dinhduong&quot;) || lowerTopic.contains(&quot;ăn uống&quot;)) {&#10;            return &quot;dinhduong&quot;;&#10;        } else if (lowerTopic.contains(&quot;yoga&quot;) || lowerTopic.contains(&quot;thiền&quot;)) {&#10;            return &quot;yoga&quot;;&#10;        } else if (lowerTopic.contains(&quot;ngủ&quot;) || lowerTopic.contains(&quot;giấc ngủ&quot;)) {&#10;            return &quot;giacngu&quot;;&#10;        } else {&#10;            return &quot;suckhoe&quot;; // Default tag cho các topic khác&#10;        }&#10;    }&#10;&#10;    private List&lt;Video&gt; filterAndSortByRecommendation(List&lt;Video&gt; videos, Map&lt;String, Double&gt; userTags) {&#10;        List&lt;VideoScore&gt; videoScores = new ArrayList&lt;&gt;();&#10;&#10;        for (Video video : videos) {&#10;            double score = calculateRecommendationScore(video, userTags);&#10;            if (score &gt; 0) {&#10;                videoScores.add(new VideoScore(video, score));&#10;            }&#10;        }&#10;&#10;        // Sắp xếp theo điểm recommendation và thời gian upload&#10;        Collections.sort(videoScores, (vs1, vs2) -&gt; {&#10;            int scoreCompare = Double.compare(vs2.score, vs1.score);&#10;            if (scoreCompare == 0) {&#10;                return Long.compare(vs2.video.getUploadDate(), vs1.video.getUploadDate());&#10;            }&#10;            return scoreCompare;&#10;        });&#10;&#10;        List&lt;Video&gt; recommendedVideos = new ArrayList&lt;&gt;();&#10;        for (VideoScore vs : videoScores) {&#10;            recommendedVideos.add(vs.video);&#10;        }&#10;&#10;        return recommendedVideos;&#10;    }&#10;&#10;    private double calculateRecommendationScore(Video video, Map&lt;String, Double&gt; userTags) {&#10;        double score = 0.0;&#10;&#10;        if (video.getTags() != null) {&#10;            for (Map.Entry&lt;String, Boolean&gt; tagEntry : video.getTags().entrySet()) {&#10;                if (tagEntry.getValue() &amp;&amp; userTags.containsKey(tagEntry.getKey())) {&#10;                    score += userTags.get(tagEntry.getKey());&#10;                }&#10;            }&#10;        }&#10;&#10;        // Thêm điểm bonus cho video có viewCount và likeCount cao&#10;        score += Math.log(video.getViewCount() + 1) * 0.1;&#10;        score += Math.log(video.getLikeCount() + 1) * 0.2;&#10;&#10;        // Thêm điểm bonus cho video mới&#10;        long daysSinceUpload = (System.currentTimeMillis() - video.getUploadDate()) / (24 * 60 * 60 * 1000);&#10;        if (daysSinceUpload &lt; 7) {&#10;            score += 0.5; // Bonus cho video mới trong 7 ngày&#10;        }&#10;&#10;        return score;&#10;    }&#10;&#10;    private static class VideoScore {&#10;        Video video;&#10;        double score;&#10;&#10;        VideoScore(Video video, double score) {&#10;            this.video = video;&#10;            this.score = score;&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/profile/LikedVideoPlayerActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/profile/LikedVideoPlayerActivity.java" />
              <option name="originalContent" value="package com.vhn.doan.presentation.profile;&#10;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.view.View;&#10;import android.widget.ImageButton;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.Nullable;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.PagerSnapHelper;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.google.android.material.progressindicator.LinearProgressIndicator;&#10;import com.vhn.doan.R;&#10;import com.vhn.doan.data.ShortVideo;&#10;import com.vhn.doan.data.repository.ShortVideoRepository;&#10;import com.vhn.doan.data.repository.ShortVideoRepositoryImpl;&#10;import com.vhn.doan.data.repository.RepositoryCallback;&#10;import com.vhn.doan.presentation.shortvideo.ShortVideoAdapter;&#10;import com.vhn.doan.utils.FirebaseAuthHelper;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;/**&#10; * Activity để phát video đã like với khả năng swipe giống TikTok&#10; * Mở trong full-screen mode cho trải nghiệm tốt nhất&#10; */&#10;public class LikedVideoPlayerActivity extends AppCompatActivity {&#10;&#10;    private static final String EXTRA_VIDEO_LIST = &quot;extra_video_list&quot;;&#10;    private static final String EXTRA_CURRENT_POSITION = &quot;extra_current_position&quot;;&#10;&#10;    private RecyclerView recyclerViewVideos;&#10;    private LinearProgressIndicator progressIndicator;&#10;    private View emptyStateLayout;&#10;    private ImageButton btnBack;&#10;    private TextView tvTitle;&#10;&#10;    private ShortVideoAdapter adapter;&#10;    private LinearLayoutManager layoutManager;&#10;    private PagerSnapHelper snapHelper;&#10;    private ShortVideoRepository repository;&#10;&#10;    private List&lt;ShortVideo&gt; likedVideos = new ArrayList&lt;&gt;();&#10;    private int currentPosition = 0;&#10;    private boolean isLoading = false;&#10;&#10;    /**&#10;     * Tạo Intent để mở LikedVideoPlayerActivity&#10;     * @param context Context&#10;     * @param videos Danh sách video đã like&#10;     * @param position Vị trí video hiện tại&#10;     * @return Intent&#10;     */&#10;    public static Intent createIntent(Context context, ArrayList&lt;ShortVideo&gt; videos, int position) {&#10;        Intent intent = new Intent(context, LikedVideoPlayerActivity.class);&#10;        intent.putParcelableArrayListExtra(EXTRA_VIDEO_LIST, videos);&#10;        intent.putExtra(EXTRA_CURRENT_POSITION, position);&#10;        return intent;&#10;    }&#10;&#10;    @Override&#10;    protected void onCreate(@Nullable Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_liked_video_player);&#10;&#10;        // Ẩn status bar và navigation bar để có trải nghiệm full-screen&#10;        hideSystemUI();&#10;&#10;        repository = new ShortVideoRepositoryImpl();&#10;&#10;        // Lấy dữ liệu từ Intent&#10;        getDataFromIntent();&#10;&#10;        // Khởi tạo views và setup&#10;        initViews();&#10;        setupRecyclerView();&#10;        setupListeners();&#10;&#10;        // Load data&#10;        if (likedVideos.isEmpty()) {&#10;            android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;No videos from Intent, loading from Firebase&quot;);&#10;            loadLikedVideos();&#10;        } else {&#10;            android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Received &quot; + likedVideos.size() + &quot; videos from Intent&quot;);&#10;            // Cập nhật adapter với dữ liệu từ Intent&#10;            if (adapter != null) {&#10;                adapter.updateData(likedVideos);&#10;            }&#10;&#10;            // Scroll đến vị trí được chỉ định và phát video ngay lập tức&#10;            recyclerViewVideos.post(() -&gt; {&#10;                if (currentPosition &lt; likedVideos.size()) {&#10;                    android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Scrolling to position: &quot; + currentPosition);&#10;                    recyclerViewVideos.scrollToPosition(currentPosition);&#10;&#10;                    // Đảm bảo video được phát ngay sau khi scroll - delay ngắn hơn&#10;                    recyclerViewVideos.postDelayed(() -&gt; {&#10;                        if (adapter != null) {&#10;                            android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Force playing video at position: &quot; + currentPosition);&#10;                            adapter.playVideoAt(currentPosition);&#10;                        }&#10;                    }, 200); // Giảm delay xuống 200ms&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    private void getDataFromIntent() {&#10;        Intent intent = getIntent();&#10;        if (intent != null) {&#10;            likedVideos = intent.getParcelableArrayListExtra(EXTRA_VIDEO_LIST);&#10;            currentPosition = intent.getIntExtra(EXTRA_CURRENT_POSITION, 0);&#10;            if (likedVideos == null) {&#10;                likedVideos = new ArrayList&lt;&gt;();&#10;            }&#10;        }&#10;    }&#10;&#10;    private void initViews() {&#10;        recyclerViewVideos = findViewById(R.id.recyclerViewVideos);&#10;        progressIndicator = findViewById(R.id.progressIndicator);&#10;        emptyStateLayout = findViewById(R.id.emptyStateLayout);&#10;        btnBack = findViewById(R.id.btnBack);&#10;        tvTitle = findViewById(R.id.tvTitle);&#10;    }&#10;&#10;    private void setupRecyclerView() {&#10;        layoutManager = new LinearLayoutManager(this, LinearLayoutManager.VERTICAL, false);&#10;        recyclerViewVideos.setLayoutManager(layoutManager);&#10;&#10;        // Tạo adapter với logging để debug&#10;        android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Setting up RecyclerView with &quot; + likedVideos.size() + &quot; videos&quot;);&#10;&#10;        adapter = new ShortVideoAdapter(this, new ArrayList&lt;&gt;(likedVideos));&#10;        recyclerViewVideos.setAdapter(adapter);&#10;&#10;        // PagerSnapHelper để tạo hiệu ứng swipe giống TikTok&#10;        snapHelper = new PagerSnapHelper();&#10;        snapHelper.attachToRecyclerView(recyclerViewVideos);&#10;&#10;        // Listener để theo dõi video hiện tại&#10;        recyclerViewVideos.addOnScrollListener(new RecyclerView.OnScrollListener() {&#10;            @Override&#10;            public void onScrollStateChanged(RecyclerView recyclerView, int newState) {&#10;                super.onScrollStateChanged(recyclerView, newState);&#10;&#10;                if (newState == RecyclerView.SCROLL_STATE_IDLE) {&#10;                    View centerView = snapHelper.findSnapView(layoutManager);&#10;                    if (centerView != null) {&#10;                        int position = layoutManager.getPosition(centerView);&#10;                        if (position != currentPosition) {&#10;                            // Pause video cũ&#10;                            if (currentPosition != -1) {&#10;                                adapter.pauseVideoAt(currentPosition);&#10;                            }&#10;&#10;                            currentPosition = position;&#10;                            android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Video position changed to: &quot; + position);&#10;&#10;                            // Play video mới&#10;                            adapter.playVideoAt(currentPosition);&#10;&#10;                            // Tải thêm video nếu gần hết danh sách&#10;                            if (position &gt;= likedVideos.size() - 3 &amp;&amp; !isLoading) {&#10;                                loadMoreLikedVideos();&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        });&#10;&#10;        // KHÔNG auto play ở đây - sẽ được xử lý sau khi scroll đến vị trí đúng&#10;    }&#10;&#10;    private void setupListeners() {&#10;        btnBack.setOnClickListener(v -&gt; onBackPressed());&#10;    }&#10;&#10;    private void loadLikedVideos() {&#10;        if (isLoading) return;&#10;&#10;        isLoading = true;&#10;        progressIndicator.setVisibility(View.VISIBLE);&#10;        emptyStateLayout.setVisibility(View.GONE);&#10;&#10;        String currentUserId = FirebaseAuthHelper.getCurrentUserId();&#10;        if (currentUserId == null) {&#10;            showError(&quot;Vui lòng đăng nhập để xem video đã like&quot;);&#10;            return;&#10;        }&#10;&#10;        repository.getLikedVideos(currentUserId, new RepositoryCallback&lt;List&lt;ShortVideo&gt;&gt;() {&#10;            @Override&#10;            public void onSuccess(List&lt;ShortVideo&gt; result) {&#10;                if (isFinishing()) return;&#10;&#10;                isLoading = false;&#10;                progressIndicator.setVisibility(View.GONE);&#10;&#10;                if (result == null || result.isEmpty()) {&#10;                    emptyStateLayout.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    likedVideos.clear();&#10;                    likedVideos.addAll(result);&#10;                    adapter.updateData(likedVideos);&#10;                    emptyStateLayout.setVisibility(View.GONE);&#10;&#10;                    // Scroll đến vị trí được chỉ định&#10;                    recyclerViewVideos.post(() -&gt; {&#10;                        if (currentPosition &lt; likedVideos.size()) {&#10;                            recyclerViewVideos.scrollToPosition(currentPosition);&#10;                        }&#10;                    });&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                if (isFinishing()) return;&#10;&#10;                isLoading = false;&#10;                progressIndicator.setVisibility(View.GONE);&#10;                showError(error);&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadMoreLikedVideos() {&#10;        // Implement pagination nếu cần&#10;        // Hiện tại chỉ load tất cả video đã like&#10;    }&#10;&#10;    private void showError(String message) {&#10;        Toast.makeText(this, message, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    private void hideSystemUI() {&#10;        // Ẩn status bar và navigation bar để có trải nghiệm full-screen&#10;        getWindow().getDecorView().setSystemUiVisibility(&#10;            View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY&#10;            | View.SYSTEM_UI_FLAG_LAYOUT_STABLE&#10;            | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION&#10;            | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN&#10;            | View.SYSTEM_UI_FLAG_HIDE_NAVIGATION&#10;            | View.SYSTEM_UI_FLAG_FULLSCREEN&#10;        );&#10;    }&#10;&#10;    @Override&#10;    public void onWindowFocusChanged(boolean hasFocus) {&#10;        super.onWindowFocusChanged(hasFocus);&#10;        if (hasFocus) {&#10;            hideSystemUI();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        // Resume video player nếu cần&#10;        if (adapter != null) {&#10;            adapter.resumeCurrentVideo();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    protected void onPause() {&#10;        super.onPause();&#10;        // Pause video player nếu cần&#10;        if (adapter != null) {&#10;            adapter.pauseCurrentVideo();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        if (adapter != null) {&#10;            adapter.releasePlayer();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBackPressed() {&#10;        super.onBackPressed();&#10;        // Animation khi back&#10;        overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_right);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.vhn.doan.presentation.profile;&#10;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.view.View;&#10;import android.widget.ImageButton;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.Nullable;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.PagerSnapHelper;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.google.android.material.progressindicator.LinearProgressIndicator;&#10;import com.vhn.doan.R;&#10;import com.vhn.doan.data.ShortVideo;&#10;import com.vhn.doan.data.repository.ShortVideoRepository;&#10;import com.vhn.doan.data.repository.ShortVideoRepositoryImpl;&#10;import com.vhn.doan.data.repository.RepositoryCallback;&#10;import com.vhn.doan.presentation.shortvideo.ShortVideoAdapter;&#10;import com.vhn.doan.utils.FirebaseAuthHelper;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;/**&#10; * Activity để phát video đã like với khả năng swipe giống TikTok&#10; * Mở trong full-screen mode cho trải nghiệm tốt nhất&#10; */&#10;public class LikedVideoPlayerActivity extends AppCompatActivity {&#10;&#10;    private static final String EXTRA_VIDEO_LIST = &quot;extra_video_list&quot;;&#10;    private static final String EXTRA_CURRENT_POSITION = &quot;extra_current_position&quot;;&#10;&#10;    private RecyclerView recyclerViewVideos;&#10;    private LinearProgressIndicator progressIndicator;&#10;    private View emptyStateLayout;&#10;    private ImageButton btnBack;&#10;    private TextView tvTitle;&#10;&#10;    private ShortVideoAdapter adapter;&#10;    private LinearLayoutManager layoutManager;&#10;    private PagerSnapHelper snapHelper;&#10;    private ShortVideoRepository repository;&#10;&#10;    private List&lt;ShortVideo&gt; likedVideos = new ArrayList&lt;&gt;();&#10;    private int currentPosition = 0;&#10;    private boolean isLoading = false;&#10;&#10;    /**&#10;     * Tạo Intent để mở LikedVideoPlayerActivity&#10;     * @param context Context&#10;     * @param videos Danh sách video đã like&#10;     * @param position Vị trí video hiện tại&#10;     * @return Intent&#10;     */&#10;    public static Intent createIntent(Context context, ArrayList&lt;ShortVideo&gt; videos, int position) {&#10;        Intent intent = new Intent(context, LikedVideoPlayerActivity.class);&#10;        intent.putParcelableArrayListExtra(EXTRA_VIDEO_LIST, videos);&#10;        intent.putExtra(EXTRA_CURRENT_POSITION, position);&#10;        return intent;&#10;    }&#10;&#10;    @Override&#10;    protected void onCreate(@Nullable Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_liked_video_player);&#10;&#10;        // Ẩn status bar và navigation bar để có trải nghiệm full-screen&#10;        hideSystemUI();&#10;&#10;        repository = new ShortVideoRepositoryImpl();&#10;&#10;        // Lấy dữ liệu từ Intent&#10;        getDataFromIntent();&#10;&#10;        // Khởi tạo views và setup&#10;        initViews();&#10;        setupRecyclerView();&#10;        setupListeners();&#10;&#10;        // Load data&#10;        if (likedVideos.isEmpty()) {&#10;            android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;No videos from Intent, loading from Firebase&quot;);&#10;            loadLikedVideos();&#10;        } else {&#10;            android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Received &quot; + likedVideos.size() + &quot; videos from Intent&quot;);&#10;            // Cập nhật adapter với dữ liệu từ Intent&#10;            if (adapter != null) {&#10;                adapter.updateData(likedVideos);&#10;            }&#10;&#10;            // Scroll đến vị trí được chỉ định và phát video ngay lập tức&#10;            recyclerViewVideos.post(() -&gt; {&#10;                if (currentPosition &lt; likedVideos.size()) {&#10;                    android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Scrolling to position: &quot; + currentPosition);&#10;                    recyclerViewVideos.scrollToPosition(currentPosition);&#10;&#10;                    // Đảm bảo video được phát ngay sau khi scroll - delay ngắn hơn&#10;                    recyclerViewVideos.postDelayed(() -&gt; {&#10;                        if (adapter != null) {&#10;                            android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Force playing video at position: &quot; + currentPosition);&#10;                            adapter.playVideoAt(currentPosition);&#10;                        }&#10;                    }, 200); // Giảm delay xuống 200ms&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    private void getDataFromIntent() {&#10;        Intent intent = getIntent();&#10;        if (intent != null) {&#10;            likedVideos = intent.getParcelableArrayListExtra(EXTRA_VIDEO_LIST);&#10;            currentPosition = intent.getIntExtra(EXTRA_CURRENT_POSITION, 0);&#10;            if (likedVideos == null) {&#10;                likedVideos = new ArrayList&lt;&gt;();&#10;            }&#10;        }&#10;    }&#10;&#10;    private void initViews() {&#10;        recyclerViewVideos = findViewById(R.id.recyclerViewVideos);&#10;        progressIndicator = findViewById(R.id.progressIndicator);&#10;        emptyStateLayout = findViewById(R.id.emptyStateLayout);&#10;        btnBack = findViewById(R.id.btnBack);&#10;        tvTitle = findViewById(R.id.tvTitle);&#10;    }&#10;&#10;    private void setupRecyclerView() {&#10;        layoutManager = new LinearLayoutManager(this, LinearLayoutManager.VERTICAL, false);&#10;        recyclerViewVideos.setLayoutManager(layoutManager);&#10;&#10;        // Tạo adapter với logging để debug&#10;        android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Setting up RecyclerView with &quot; + likedVideos.size() + &quot; videos&quot;);&#10;&#10;        adapter = new ShortVideoAdapter(this, new ArrayList&lt;&gt;(likedVideos));&#10;        recyclerViewVideos.setAdapter(adapter);&#10;&#10;        // PagerSnapHelper để tạo hiệu ứng swipe giống TikTok&#10;        snapHelper = new PagerSnapHelper();&#10;        snapHelper.attachToRecyclerView(recyclerViewVideos);&#10;&#10;        // Listener để theo dõi video hiện tại - SỬA LOGIC Ở ĐÂY&#10;        recyclerViewVideos.addOnScrollListener(new RecyclerView.OnScrollListener() {&#10;            @Override&#10;            public void onScrollStateChanged(RecyclerView recyclerView, int newState) {&#10;                super.onScrollStateChanged(recyclerView, newState);&#10;&#10;                if (newState == RecyclerView.SCROLL_STATE_IDLE) {&#10;                    View centerView = snapHelper.findSnapView(layoutManager);&#10;                    if (centerView != null) {&#10;                        int position = layoutManager.getPosition(centerView);&#10;                        if (position != currentPosition) {&#10;                            int oldPosition = currentPosition;&#10;                            currentPosition = position;&#10;                            &#10;                            android.util.Log.d(&quot;LikedVideoPlayer&quot;, &quot;Video position changed from &quot; + oldPosition + &quot; to: &quot; + position);&#10;&#10;                            // CHỈ pause video cũ, KHÔNG gọi play cho video mới&#10;                            // Video mới sẽ tự động play khi ExoPlayer ready&#10;                            if (oldPosition != -1) {&#10;                                adapter.pauseVideoAt(oldPosition);&#10;                            }&#10;&#10;                            // Tải thêm video nếu gần hết danh sách&#10;                            if (position &gt;= likedVideos.size() - 3 &amp;&amp; !isLoading) {&#10;                                loadMoreLikedVideos();&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        });&#10;&#10;        // Set RecyclerView reference cho adapter&#10;        adapter.setRecyclerView(recyclerViewVideos);&#10;    }&#10;&#10;    private void setupListeners() {&#10;        btnBack.setOnClickListener(v -&gt; onBackPressed());&#10;    }&#10;&#10;    private void loadLikedVideos() {&#10;        if (isLoading) return;&#10;&#10;        isLoading = true;&#10;        progressIndicator.setVisibility(View.VISIBLE);&#10;        emptyStateLayout.setVisibility(View.GONE);&#10;&#10;        String currentUserId = FirebaseAuthHelper.getCurrentUserId();&#10;        if (currentUserId == null) {&#10;            showError(&quot;Vui lòng đăng nhập để xem video đã like&quot;);&#10;            return;&#10;        }&#10;&#10;        repository.getLikedVideos(currentUserId, new RepositoryCallback&lt;List&lt;ShortVideo&gt;&gt;() {&#10;            @Override&#10;            public void onSuccess(List&lt;ShortVideo&gt; result) {&#10;                if (isFinishing()) return;&#10;&#10;                isLoading = false;&#10;                progressIndicator.setVisibility(View.GONE);&#10;&#10;                if (result == null || result.isEmpty()) {&#10;                    emptyStateLayout.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    likedVideos.clear();&#10;                    likedVideos.addAll(result);&#10;                    adapter.updateData(likedVideos);&#10;                    emptyStateLayout.setVisibility(View.GONE);&#10;&#10;                    // Scroll đến vị trí được chỉ định&#10;                    recyclerViewVideos.post(() -&gt; {&#10;                        if (currentPosition &lt; likedVideos.size()) {&#10;                            recyclerViewVideos.scrollToPosition(currentPosition);&#10;                        }&#10;                    });&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                if (isFinishing()) return;&#10;&#10;                isLoading = false;&#10;                progressIndicator.setVisibility(View.GONE);&#10;                showError(error);&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadMoreLikedVideos() {&#10;        // Implement pagination nếu cần&#10;        // Hiện tại chỉ load tất cả video đã like&#10;    }&#10;&#10;    private void showError(String message) {&#10;        Toast.makeText(this, message, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    private void hideSystemUI() {&#10;        // Ẩn status bar và navigation bar để có trải nghiệm full-screen&#10;        getWindow().getDecorView().setSystemUiVisibility(&#10;            View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY&#10;            | View.SYSTEM_UI_FLAG_LAYOUT_STABLE&#10;            | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION&#10;            | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN&#10;            | View.SYSTEM_UI_FLAG_HIDE_NAVIGATION&#10;            | View.SYSTEM_UI_FLAG_FULLSCREEN&#10;        );&#10;    }&#10;&#10;    @Override&#10;    public void onWindowFocusChanged(boolean hasFocus) {&#10;        super.onWindowFocusChanged(hasFocus);&#10;        if (hasFocus) {&#10;            hideSystemUI();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        // Resume video player nếu cần&#10;        if (adapter != null) {&#10;            adapter.resumeCurrentVideo();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    protected void onPause() {&#10;        super.onPause();&#10;        // Pause video player nếu cần&#10;        if (adapter != null) {&#10;            adapter.pauseCurrentVideo();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        if (adapter != null) {&#10;            adapter.releasePlayer();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBackPressed() {&#10;        super.onBackPressed();&#10;        // Animation khi back&#10;        overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_right);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/shortvideo/ExoPlayerPreloadManager.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/shortvideo/ExoPlayerPreloadManager.java" />
              <option name="originalContent" value="package com.vhn.doan.presentation.shortvideo;&#10;&#10;import android.content.Context;&#10;import android.os.Handler;&#10;import android.os.Looper;&#10;import android.util.Log;&#10;&#10;import com.google.android.exoplayer2.ExoPlayer;&#10;import com.google.android.exoplayer2.MediaItem;&#10;import com.google.android.exoplayer2.Player;&#10;import com.vhn.doan.data.ShortVideo;&#10;&#10;import java.util.HashMap;&#10;import java.util.List;&#10;import java.util.Map;&#10;&#10;/**&#10; * Phiên bản đơn giản hóa của ExoPlayerPreloadManager&#10; * Tập trung vào việc tạo player ổn định trước&#10; */&#10;public class ExoPlayerPreloadManager {&#10;    private static final String TAG = &quot;ExoPlayerPreloadManager&quot;;&#10;    private static final int PRELOAD_AHEAD = 1; // Giảm xuống 1 để ổn định hơn&#10;&#10;    private final Context context;&#10;    private final Map&lt;Integer, ExoPlayer&gt; preloadedPlayers = new HashMap&lt;&gt;();&#10;    private final Handler mainHandler;&#10;    private ExoPlayer currentPlayer;&#10;    private int currentPosition = -1;&#10;    private boolean isEnabled = true; // Flag để tắt preload nếu cần&#10;&#10;    public ExoPlayerPreloadManager(Context context) {&#10;        this.context = context.getApplicationContext();&#10;        this.mainHandler = new Handler(Looper.getMainLooper());&#10;        Log.d(TAG, &quot;ExoPlayerPreloadManager initialized&quot;);&#10;    }&#10;&#10;    /**&#10;     * Thiết lập video hiện tại - phiên bản đơn giản&#10;     */&#10;    public ExoPlayer setupCurrentVideo(List&lt;ShortVideo&gt; videos, int position) {&#10;        Log.d(TAG, &quot;Setting up current video at position: &quot; + position);&#10;&#10;        if (!isEnabled || position &lt; 0 || position &gt;= videos.size()) {&#10;            Log.w(TAG, &quot;Preload disabled or invalid position: &quot; + position);&#10;            return null;&#10;        }&#10;&#10;        try {&#10;            // Kiểm tra xem có player preload không&#10;            if (preloadedPlayers.containsKey(position)) {&#10;                Log.d(TAG, &quot;Using preloaded player for position: &quot; + position);&#10;                currentPlayer = preloadedPlayers.remove(position);&#10;                currentPosition = position;&#10;&#10;                // Trigger preload background sau khi setup xong&#10;                schedulePreload(videos, position);&#10;                return currentPlayer;&#10;            }&#10;&#10;            // Nếu không có preload, tạo player mới ngay lập tức&#10;            Log.d(TAG, &quot;Creating new player for position: &quot; + position);&#10;            releaseCurrentPlayer();&#10;&#10;            currentPlayer = createPlayerSync(videos.get(position).getOptimizedVideoUrl());&#10;            currentPosition = position;&#10;&#10;            // Trigger preload background&#10;            schedulePreload(videos, position);&#10;            return currentPlayer;&#10;&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;Error in setupCurrentVideo: &quot; + e.getMessage());&#10;            isEnabled = false; // Tắt preload nếu có lỗi&#10;            return null;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Tạo player đồng bộ để tránh delay&#10;     */&#10;    private ExoPlayer createPlayerSync(String videoUrl) {&#10;        try {&#10;            if (videoUrl == null || videoUrl.isEmpty()) {&#10;                Log.e(TAG, &quot;Invalid video URL&quot;);&#10;                return null;&#10;            }&#10;&#10;            ExoPlayer player = new ExoPlayer.Builder(context).build();&#10;            MediaItem item = MediaItem.fromUri(videoUrl);&#10;            player.setMediaItem(item);&#10;            player.setRepeatMode(Player.REPEAT_MODE_ONE);&#10;            player.prepare();&#10;&#10;            Log.d(TAG, &quot;Created sync player for URL: &quot; + videoUrl);&#10;            return player;&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;Error creating sync player: &quot; + e.getMessage());&#10;            return null;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Tạo preload cho các video xung quanh vị trí hiện tại&#10;     */&#10;    private void schedulePreloadInternal(List&lt;ShortVideo&gt; videos, int currentPos) {&#10;        if (!isEnabled) return;&#10;&#10;        mainHandler.post(() -&gt; {&#10;            try {&#10;                // Preload video tiếp theo&#10;                int nextPos = currentPos + 1;&#10;                if (nextPos &lt; videos.size() &amp;&amp; !preloadedPlayers.containsKey(nextPos)) {&#10;                    createPreloadPlayer(videos.get(nextPos).getOptimizedVideoUrl(), nextPos);&#10;                }&#10;&#10;                // Preload video trước đó (nếu cần)&#10;                int prevPos = currentPos - 1;&#10;                if (prevPos &gt;= 0 &amp;&amp; !preloadedPlayers.containsKey(prevPos)) {&#10;                    createPreloadPlayer(videos.get(prevPos).getOptimizedVideoUrl(), prevPos);&#10;                }&#10;&#10;                // Cleanup các player cũ không cần thiết&#10;                cleanupOldPlayers(currentPos);&#10;            } catch (Exception e) {&#10;                Log.e(TAG, &quot;Error in preload scheduling: &quot; + e.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Public method để ShortVideoAdapter có thể gọi&#10;     */&#10;    public void schedulePreload(List&lt;ShortVideo&gt; videos, int currentPos) {&#10;        schedulePreloadInternal(videos, currentPos);&#10;    }&#10;&#10;    private void createPreloadPlayer(String videoUrl, int position) {&#10;        try {&#10;            if (videoUrl == null || videoUrl.isEmpty()) {&#10;                Log.w(TAG, &quot;Skipping preload for position &quot; + position + &quot; - invalid URL&quot;);&#10;                return;&#10;            }&#10;&#10;            ExoPlayer player = new ExoPlayer.Builder(context).build();&#10;            MediaItem item = MediaItem.fromUri(videoUrl);&#10;            player.setMediaItem(item);&#10;            player.setRepeatMode(Player.REPEAT_MODE_ONE);&#10;            player.prepare();&#10;&#10;            preloadedPlayers.put(position, player);&#10;            Log.d(TAG, &quot;Preloaded player for position: &quot; + position);&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;Error creating preload player for position &quot; + position + &quot;: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    private void cleanupOldPlayers(int currentPos) {&#10;        // Remove players that are too far from current position&#10;        preloadedPlayers.entrySet().removeIf(entry -&gt; {&#10;            int pos = entry.getKey();&#10;            if (Math.abs(pos - currentPos) &gt; PRELOAD_AHEAD) {&#10;                try {&#10;                    entry.getValue().release();&#10;                    Log.d(TAG, &quot;Released old preload player at position: &quot; + pos);&#10;                } catch (Exception e) {&#10;                    Log.w(TAG, &quot;Error releasing old player: &quot; + e.getMessage());&#10;                }&#10;                return true;&#10;            }&#10;            return false;&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Release player hiện tại&#10;     */&#10;    private void releaseCurrentPlayer() {&#10;        if (currentPlayer != null) {&#10;            try {&#10;                currentPlayer.release();&#10;                Log.d(TAG, &quot;Released current player&quot;);&#10;            } catch (Exception e) {&#10;                Log.w(TAG, &quot;Error releasing current player: &quot; + e.getMessage());&#10;            }&#10;            currentPlayer = null;&#10;        }&#10;        currentPosition = -1;&#10;    }&#10;&#10;    /**&#10;     * Release tất cả resources&#10;     */&#10;    public void releaseAllResources() {&#10;        Log.d(TAG, &quot;Releasing all resources&quot;);&#10;&#10;        releaseCurrentPlayer();&#10;&#10;        for (Map.Entry&lt;Integer, ExoPlayer&gt; entry : preloadedPlayers.entrySet()) {&#10;            try {&#10;                entry.getValue().release();&#10;            } catch (Exception e) {&#10;                Log.w(TAG, &quot;Error releasing preload player: &quot; + e.getMessage());&#10;            }&#10;        }&#10;        preloadedPlayers.clear();&#10;&#10;        isEnabled = true; // Reset enable flag&#10;    }&#10;&#10;    /**&#10;     * Lấy player hiện tại&#10;     */&#10;    public ExoPlayer getCurrentPlayer() {&#10;        return currentPlayer;&#10;    }&#10;&#10;    /**&#10;     * Lấy vị trí hiện tại&#10;     */&#10;    public int getCurrentPosition() {&#10;        return currentPosition;&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra xem có player preload cho vị trí này không&#10;     */&#10;    public boolean hasPreloadedPlayer(int position) {&#10;        return preloadedPlayers.containsKey(position);&#10;    }&#10;&#10;    /**&#10;     * Lấy số lượng player đã preload&#10;     */&#10;    public int getPreloadedCount() {&#10;        return preloadedPlayers.size();&#10;    }&#10;&#10;    public void setEnabled(boolean enabled) {&#10;        this.isEnabled = enabled;&#10;        if (!enabled) {&#10;            releaseAllResources();&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.vhn.doan.presentation.shortvideo;&#10;&#10;import android.content.Context;&#10;import android.os.Handler;&#10;import android.os.Looper;&#10;import android.util.Log;&#10;&#10;import com.google.android.exoplayer2.ExoPlayer;&#10;import com.google.android.exoplayer2.MediaItem;&#10;import com.google.android.exoplayer2.Player;&#10;import com.vhn.doan.data.ShortVideo;&#10;&#10;import java.util.HashMap;&#10;import java.util.List;&#10;import java.util.Map;&#10;&#10;/**&#10; * Phiên bản đơn giản hóa của ExoPlayerPreloadManager&#10; * Tập trung vào việc tạo player ổn định trước&#10; */&#10;public class ExoPlayerPreloadManager {&#10;    private static final String TAG = &quot;ExoPlayerPreloadManager&quot;;&#10;    private static final int PRELOAD_AHEAD = 1; // Giảm xuống 1 để ổn định hơn&#10;&#10;    private final Context context;&#10;    private final Map&lt;Integer, ExoPlayer&gt; preloadedPlayers = new HashMap&lt;&gt;();&#10;    private final Handler mainHandler;&#10;    private ExoPlayer currentPlayer;&#10;    private int currentPosition = -1;&#10;    private boolean isEnabled = true; // Flag để tắt preload nếu cần&#10;&#10;    public ExoPlayerPreloadManager(Context context) {&#10;        this.context = context.getApplicationContext();&#10;        this.mainHandler = new Handler(Looper.getMainLooper());&#10;        Log.d(TAG, &quot;ExoPlayerPreloadManager initialized&quot;);&#10;    }&#10;&#10;    /**&#10;     * Thiết lập video hiện tại - phiên bản đơn giản&#10;     */&#10;    public ExoPlayer setupCurrentVideo(List&lt;ShortVideo&gt; videos, int position) {&#10;        Log.d(TAG, &quot;Setting up current video at position: &quot; + position);&#10;&#10;        if (!isEnabled || position &lt; 0 || position &gt;= videos.size()) {&#10;            Log.w(TAG, &quot;Preload disabled or invalid position: &quot; + position);&#10;            return null;&#10;        }&#10;&#10;        try {&#10;            // Kiểm tra xem có player preload không&#10;            if (preloadedPlayers.containsKey(position)) {&#10;                Log.d(TAG, &quot;Using preloaded player for position: &quot; + position);&#10;                currentPlayer = preloadedPlayers.remove(position);&#10;                currentPosition = position;&#10;&#10;                // Trigger preload background sau khi setup xong&#10;                schedulePreloadInternal(videos, position);&#10;                return currentPlayer;&#10;            }&#10;&#10;            // Nếu không có preload, tạo player mới ngay lập tức&#10;            Log.d(TAG, &quot;Creating new player for position: &quot; + position);&#10;            releaseCurrentPlayer();&#10;&#10;            currentPlayer = createPlayerSync(videos.get(position).getOptimizedVideoUrl());&#10;            currentPosition = position;&#10;&#10;            // Trigger preload background&#10;            schedulePreloadInternal(videos, position);&#10;            return currentPlayer;&#10;&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;Error in setupCurrentVideo: &quot; + e.getMessage());&#10;            isEnabled = false; // Tắt preload nếu có lỗi&#10;            return null;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Tạo player đồng bộ để tránh delay&#10;     */&#10;    private ExoPlayer createPlayerSync(String videoUrl) {&#10;        try {&#10;            if (videoUrl == null || videoUrl.isEmpty()) {&#10;                Log.e(TAG, &quot;Invalid video URL&quot;);&#10;                return null;&#10;            }&#10;&#10;            ExoPlayer player = new ExoPlayer.Builder(context).build();&#10;            MediaItem item = MediaItem.fromUri(videoUrl);&#10;            player.setMediaItem(item);&#10;            player.setRepeatMode(Player.REPEAT_MODE_ONE);&#10;            player.prepare();&#10;&#10;            Log.d(TAG, &quot;Created sync player for URL: &quot; + videoUrl);&#10;            return player;&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;Error creating sync player: &quot; + e.getMessage());&#10;            return null;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Tạo preload cho các video xung quanh vị trí hiện tại&#10;     */&#10;    private void schedulePreloadInternal(List&lt;ShortVideo&gt; videos, int currentPos) {&#10;        if (!isEnabled) return;&#10;&#10;        mainHandler.post(() -&gt; {&#10;            try {&#10;                // Preload video tiếp theo&#10;                int nextPos = currentPos + 1;&#10;                if (nextPos &lt; videos.size() &amp;&amp; !preloadedPlayers.containsKey(nextPos)) {&#10;                    createPreloadPlayer(videos.get(nextPos).getOptimizedVideoUrl(), nextPos);&#10;                }&#10;&#10;                // Preload video trước đó (nếu cần)&#10;                int prevPos = currentPos - 1;&#10;                if (prevPos &gt;= 0 &amp;&amp; !preloadedPlayers.containsKey(prevPos)) {&#10;                    createPreloadPlayer(videos.get(prevPos).getOptimizedVideoUrl(), prevPos);&#10;                }&#10;&#10;                // Cleanup các player cũ không cần thiết&#10;                cleanupOldPlayers(currentPos);&#10;            } catch (Exception e) {&#10;                Log.e(TAG, &quot;Error in preload scheduling: &quot; + e.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Public method để ShortVideoAdapter có thể gọi&#10;     */&#10;    public void schedulePreload(List&lt;ShortVideo&gt; videos, int currentPos) {&#10;        schedulePreloadInternal(videos, currentPos);&#10;    }&#10;&#10;    private void createPreloadPlayer(String videoUrl, int position) {&#10;        try {&#10;            if (videoUrl == null || videoUrl.isEmpty()) {&#10;                Log.w(TAG, &quot;Skipping preload for position &quot; + position + &quot; - invalid URL&quot;);&#10;                return;&#10;            }&#10;&#10;            ExoPlayer player = new ExoPlayer.Builder(context).build();&#10;            MediaItem item = MediaItem.fromUri(videoUrl);&#10;            player.setMediaItem(item);&#10;            player.setRepeatMode(Player.REPEAT_MODE_ONE);&#10;            player.prepare();&#10;&#10;            preloadedPlayers.put(position, player);&#10;            Log.d(TAG, &quot;Preloaded player for position: &quot; + position);&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;Error creating preload player for position &quot; + position + &quot;: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    private void cleanupOldPlayers(int currentPos) {&#10;        // Remove players that are too far from current position&#10;        preloadedPlayers.entrySet().removeIf(entry -&gt; {&#10;            int pos = entry.getKey();&#10;            if (Math.abs(pos - currentPos) &gt; PRELOAD_AHEAD) {&#10;                try {&#10;                    entry.getValue().release();&#10;                    Log.d(TAG, &quot;Released old preload player at position: &quot; + pos);&#10;                } catch (Exception e) {&#10;                    Log.w(TAG, &quot;Error releasing old player: &quot; + e.getMessage());&#10;                }&#10;                return true;&#10;            }&#10;            return false;&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Release player hiện tại&#10;     */&#10;    private void releaseCurrentPlayer() {&#10;        if (currentPlayer != null) {&#10;            try {&#10;                currentPlayer.release();&#10;                Log.d(TAG, &quot;Released current player&quot;);&#10;            } catch (Exception e) {&#10;                Log.w(TAG, &quot;Error releasing current player: &quot; + e.getMessage());&#10;            }&#10;            currentPlayer = null;&#10;        }&#10;        currentPosition = -1;&#10;    }&#10;&#10;    /**&#10;     * Release tất cả resources&#10;     */&#10;    public void releaseAllResources() {&#10;        Log.d(TAG, &quot;Releasing all resources&quot;);&#10;&#10;        releaseCurrentPlayer();&#10;&#10;        for (Map.Entry&lt;Integer, ExoPlayer&gt; entry : preloadedPlayers.entrySet()) {&#10;            try {&#10;                entry.getValue().release();&#10;            } catch (Exception e) {&#10;                Log.w(TAG, &quot;Error releasing preload player: &quot; + e.getMessage());&#10;            }&#10;        }&#10;        preloadedPlayers.clear();&#10;&#10;        isEnabled = true; // Reset enable flag&#10;    }&#10;&#10;    /**&#10;     * Lấy player hiện tại&#10;     */&#10;    public ExoPlayer getCurrentPlayer() {&#10;        return currentPlayer;&#10;    }&#10;&#10;    /**&#10;     * Lấy vị trí hiện tại&#10;     */&#10;    public int getCurrentPosition() {&#10;        return currentPosition;&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra xem có player preload cho vị trí này không&#10;     */&#10;    public boolean hasPreloadedPlayer(int position) {&#10;        return preloadedPlayers.containsKey(position);&#10;    }&#10;&#10;    /**&#10;     * Lấy số lượng player đã preload&#10;     */&#10;    public int getPreloadedCount() {&#10;        return preloadedPlayers.size();&#10;    }&#10;&#10;    public void setEnabled(boolean enabled) {&#10;        this.isEnabled = enabled;&#10;        if (!enabled) {&#10;            releaseAllResources();&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/video/ShortVideoAdapter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/video/ShortVideoAdapter.java" />
              <option name="updatedContent" value="package com.vhn.doan.presentation.video;&#10;&#10;import android.content.Context;&#10;import android.media.MediaMetadataRetriever;&#10;import android.net.Uri;&#10;import android.text.format.DateUtils;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.LinearLayout;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.VideoView;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.bumptech.glide.Glide;&#10;import com.bumptech.glide.load.engine.DiskCacheStrategy;&#10;import com.google.android.flexbox.FlexboxLayout;&#10;import com.vhn.doan.R;&#10;import com.vhn.doan.data.Video;&#10;import com.vhn.doan.utils.FormatUtils;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Locale;&#10;import java.util.Map;&#10;&#10;public class ShortVideoAdapter extends RecyclerView.Adapter&lt;ShortVideoAdapter.VideoViewHolder&gt; {&#10;&#10;    private List&lt;Video&gt; videos;&#10;    private VideoInteractionListener listener;&#10;    private int currentPlayingPosition = -1;&#10;&#10;    public interface VideoInteractionListener {&#10;        void onVideoLiked(String videoId, boolean isCurrentlyLiked);&#10;        void onVideoShared(String videoId);&#10;        void onVideoClicked(Video video);&#10;        void onVideoViewed(String videoId);&#10;        void onVideoStarted(String videoId);&#10;        void onVideoCompleted(String videoId);&#10;    }&#10;&#10;    public ShortVideoAdapter(VideoInteractionListener listener) {&#10;        this.videos = new ArrayList&lt;&gt;();&#10;        this.listener = listener;&#10;    }&#10;&#10;    @NonNull&#10;    @Override&#10;    public VideoViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#10;        View view = LayoutInflater.from(parent.getContext())&#10;                .inflate(R.layout.item_short_video, parent, false);&#10;        return new VideoViewHolder(view);&#10;    }&#10;&#10;    @Override&#10;    public void onBindViewHolder(@NonNull VideoViewHolder holder, int position) {&#10;        Video video = videos.get(position);&#10;        holder.bind(video, position);&#10;    }&#10;&#10;    @Override&#10;    public int getItemCount() {&#10;        return videos.size();&#10;    }&#10;&#10;    public void updateVideos(List&lt;Video&gt; newVideos) {&#10;        this.videos.clear();&#10;        this.videos.addAll(newVideos);&#10;        notifyDataSetChanged();&#10;    }&#10;&#10;    public void addMoreVideos(List&lt;Video&gt; moreVideos) {&#10;        int startPosition = videos.size();&#10;        this.videos.addAll(moreVideos);&#10;        notifyItemRangeInserted(startPosition, moreVideos.size());&#10;    }&#10;&#10;    public void updateLikeStatus(String videoId, boolean isLiked, int likeCount) {&#10;        for (int i = 0; i &lt; videos.size(); i++) {&#10;            Video video = videos.get(i);&#10;            if (video.getId().equals(videoId)) {&#10;                video.setLikeCount(likeCount);&#10;                notifyItemChanged(i);&#10;                break;&#10;            }&#10;        }&#10;    }&#10;&#10;    public void updateViewCount(String videoId, int viewCount) {&#10;        for (int i = 0; i &lt; videos.size(); i++) {&#10;            Video video = videos.get(i);&#10;            if (video.getId().equals(videoId)) {&#10;                video.setViewCount(viewCount);&#10;                notifyItemChanged(i);&#10;                break;&#10;            }&#10;        }&#10;    }&#10;&#10;    public void playVideoAtPosition(int position) {&#10;        if (position &gt;= 0 &amp;&amp; position &lt; videos.size()) {&#10;            // Pause video hiện tại nếu có&#10;            pauseAllVideos();&#10;            &#10;            currentPlayingPosition = position;&#10;            notifyItemChanged(position);&#10;        }&#10;    }&#10;&#10;    public void pauseAllVideos() {&#10;        currentPlayingPosition = -1;&#10;        notifyDataSetChanged();&#10;    }&#10;&#10;    public class VideoViewHolder extends RecyclerView.ViewHolder {&#10;        private VideoView videoView;&#10;        private ImageView ivThumbnail;&#10;        private ImageView ivPlayButton;&#10;        private ProgressBar progressBarVideo;&#10;        private TextView tvTitle;&#10;        private TextView tvCaption;&#10;        private FlexboxLayout layoutTags;&#10;        private TextView tvViewCount;&#10;        private TextView tvUploadDate;&#10;        private LinearLayout layoutLike;&#10;        private ImageView ivLike;&#10;        private TextView tvLikeCount;&#10;        private LinearLayout layoutShare;&#10;        private LinearLayout layoutMore;&#10;        private ProgressBar progressBarVideoProgress;&#10;&#10;        private boolean isLiked = false;&#10;        private boolean isVideoLoaded = false;&#10;&#10;        public VideoViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            initViews();&#10;            setupClickListeners();&#10;        }&#10;&#10;        private void initViews() {&#10;            videoView = itemView.findViewById(R.id.videoView);&#10;            ivThumbnail = itemView.findViewById(R.id.ivThumbnail);&#10;            ivPlayButton = itemView.findViewById(R.id.ivPlayButton);&#10;            progressBarVideo = itemView.findViewById(R.id.progressBarVideo);&#10;            tvTitle = itemView.findViewById(R.id.tvTitle);&#10;            tvCaption = itemView.findViewById(R.id.tvCaption);&#10;            layoutTags = itemView.findViewById(R.id.layoutTags);&#10;            tvViewCount = itemView.findViewById(R.id.tvViewCount);&#10;            tvUploadDate = itemView.findViewById(R.id.tvUploadDate);&#10;            layoutLike = itemView.findViewById(R.id.layoutLike);&#10;            ivLike = itemView.findViewById(R.id.ivLike);&#10;            tvLikeCount = itemView.findViewById(R.id.tvLikeCount);&#10;            layoutShare = itemView.findViewById(R.id.layoutShare);&#10;            layoutMore = itemView.findViewById(R.id.layoutMore);&#10;            progressBarVideoProgress = itemView.findViewById(R.id.progressBarVideoProgress);&#10;        }&#10;&#10;        private void setupClickListeners() {&#10;            // Click vào video để play/pause&#10;            videoView.setOnClickListener(v -&gt; {&#10;                if (videoView.isPlaying()) {&#10;                    videoView.pause();&#10;                    ivPlayButton.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    videoView.start();&#10;                    ivPlayButton.setVisibility(View.GONE);&#10;                    if (listener != null) {&#10;                        Video video = videos.get(getAdapterPosition());&#10;                        listener.onVideoStarted(video.getId());&#10;                    }&#10;                }&#10;            });&#10;&#10;            // Click vào thumbnail để bắt đầu phát video&#10;            ivThumbnail.setOnClickListener(v -&gt; {&#10;                loadAndPlayVideo();&#10;            });&#10;&#10;            ivPlayButton.setOnClickListener(v -&gt; {&#10;                loadAndPlayVideo();&#10;            });&#10;&#10;            // Like button&#10;            layoutLike.setOnClickListener(v -&gt; {&#10;                if (listener != null) {&#10;                    Video video = videos.get(getAdapterPosition());&#10;                    listener.onVideoLiked(video.getId(), isLiked);&#10;                }&#10;            });&#10;&#10;            // Share button&#10;            layoutShare.setOnClickListener(v -&gt; {&#10;                if (listener != null) {&#10;                    Video video = videos.get(getAdapterPosition());&#10;                    listener.onVideoShared(video.getId());&#10;                }&#10;            });&#10;&#10;            // More options&#10;            layoutMore.setOnClickListener(v -&gt; {&#10;                // TODO: Implement more options menu&#10;            });&#10;&#10;            // Double tap to like&#10;            itemView.setOnClickListener(v -&gt; {&#10;                if (listener != null) {&#10;                    Video video = videos.get(getAdapterPosition());&#10;                    listener.onVideoClicked(video);&#10;                }&#10;            });&#10;        }&#10;&#10;        public void bind(Video video, int position) {&#10;            // Set video info&#10;            tvTitle.setText(video.getTitle());&#10;            tvCaption.setText(video.getCaption());&#10;            &#10;            // Format view count&#10;            String viewCountText = FormatUtils.formatCount(video.getViewCount()) + &quot; &quot; + &#10;                    itemView.getContext().getString(R.string.views);&#10;            tvViewCount.setText(viewCountText);&#10;            &#10;            // Format upload date&#10;            String uploadDateText = FormatUtils.formatTimeAgo(itemView.getContext(), video.getUploadDate());&#10;            tvUploadDate.setText(uploadDateText);&#10;            &#10;            // Format like count&#10;            tvLikeCount.setText(FormatUtils.formatCount(video.getLikeCount()));&#10;            &#10;            // Load thumbnail&#10;            if (video.getThumbnailUrl() != null &amp;&amp; !video.getThumbnailUrl().isEmpty()) {&#10;                Glide.with(itemView.getContext())&#10;                        .load(video.getThumbnailUrl())&#10;                        .diskCacheStrategy(DiskCacheStrategy.ALL)&#10;                        .placeholder(R.drawable.placeholder_image)&#10;                        .error(R.drawable.error_image)&#10;                        .into(ivThumbnail);&#10;            }&#10;            &#10;            // Setup tags&#10;            setupTags(video.getTags());&#10;            &#10;            // Reset video state&#10;            resetVideoState();&#10;            &#10;            // Auto play if this is the current position&#10;            if (position == currentPlayingPosition) {&#10;                loadAndPlayVideo();&#10;            }&#10;            &#10;            // Check like status&#10;            // TODO: Implement like status check với presenter&#10;        }&#10;&#10;        private void setupTags(Map&lt;String, Boolean&gt; tags) {&#10;            layoutTags.removeAllViews();&#10;            &#10;            if (tags != null) {&#10;                for (Map.Entry&lt;String, Boolean&gt; entry : tags.entrySet()) {&#10;                    if (entry.getValue()) {&#10;                        TextView tagView = createTagView(entry.getKey());&#10;                        layoutTags.addView(tagView);&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        private TextView createTagView(String tag) {&#10;            TextView tagView = new TextView(itemView.getContext());&#10;            tagView.setText(&quot;#&quot; + tag);&#10;            tagView.setTextColor(itemView.getContext().getColor(android.R.color.white));&#10;            tagView.setTextSize(12);&#10;            tagView.setPadding(16, 8, 16, 8);&#10;            tagView.setBackground(itemView.getContext().getDrawable(R.drawable.bg_category_label));&#10;            &#10;            // Set margin&#10;            FlexboxLayout.LayoutParams params = new FlexboxLayout.LayoutParams(&#10;                    ViewGroup.LayoutParams.WRAP_CONTENT,&#10;                    ViewGroup.LayoutParams.WRAP_CONTENT&#10;            );&#10;            params.setMargins(0, 0, 12, 8);&#10;            tagView.setLayoutParams(params);&#10;            &#10;            return tagView;&#10;        }&#10;&#10;        private void loadAndPlayVideo() {&#10;            if (!isVideoLoaded) {&#10;                Video video = videos.get(getAdapterPosition());&#10;                &#10;                progressBarVideo.setVisibility(View.VISIBLE);&#10;                ivPlayButton.setVisibility(View.GONE);&#10;                &#10;                videoView.setVideoURI(Uri.parse(video.getVideoUrl()));&#10;                &#10;                videoView.setOnPreparedListener(mp -&gt; {&#10;                    progressBarVideo.setVisibility(View.GONE);&#10;                    ivThumbnail.setVisibility(View.GONE);&#10;                    ivPlayButton.setVisibility(View.GONE);&#10;                    &#10;                    isVideoLoaded = true;&#10;                    videoView.start();&#10;                    &#10;                    // Thông báo video đã được xem&#10;                    if (listener != null) {&#10;                        listener.onVideoViewed(video.getId());&#10;                        listener.onVideoStarted(video.getId());&#10;                    }&#10;                    &#10;                    // Set video to loop&#10;                    mp.setLooping(true);&#10;                });&#10;                &#10;                videoView.setOnErrorListener((mp, what, extra) -&gt; {&#10;                    progressBarVideo.setVisibility(View.GONE);&#10;                    ivPlayButton.setVisibility(View.VISIBLE);&#10;                    // TODO: Show error message&#10;                    return true;&#10;                });&#10;                &#10;                videoView.setOnCompletionListener(mp -&gt; {&#10;                    if (listener != null) {&#10;                        listener.onVideoCompleted(video.getId());&#10;                    }&#10;                });&#10;                &#10;            } else {&#10;                // Video đã load, chỉ cần play&#10;                ivThumbnail.setVisibility(View.GONE);&#10;                ivPlayButton.setVisibility(View.GONE);&#10;                videoView.start();&#10;                &#10;                if (listener != null) {&#10;                    Video video = videos.get(getAdapterPosition());&#10;                    listener.onVideoStarted(video.getId());&#10;                }&#10;            }&#10;        }&#10;&#10;        private void resetVideoState() {&#10;            videoView.stopPlayback();&#10;            isVideoLoaded = false;&#10;            ivThumbnail.setVisibility(View.VISIBLE);&#10;            ivPlayButton.setVisibility(View.VISIBLE);&#10;            progressBarVideo.setVisibility(View.GONE);&#10;            progressBarVideoProgress.setVisibility(View.GONE);&#10;        }&#10;&#10;        public void updateLikeState(boolean liked) {&#10;            isLiked = liked;&#10;            ivLike.setImageResource(liked ? R.drawable.ic_favorite : R.drawable.ic_favorite_border);&#10;            ivLike.setColorFilter(liked ? &#10;                    itemView.getContext().getColor(R.color.error_color) : &#10;                    itemView.getContext().getColor(android.R.color.white));&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/video/ShortVideoContract.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/video/ShortVideoContract.java" />
              <option name="originalContent" value="package com.vhn.doan.presentation.video;&#10;&#10;import com.vhn.doan.data.Video;&#10;import com.vhn.doan.presentation.base.BasePresenter;&#10;import com.vhn.doan.presentation.base.BaseView;&#10;&#10;import java.util.List;&#10;&#10;public interface ShortVideoContract {&#10;&#10;    interface View extends BaseView {&#10;        /**&#10;         * Hiển thị danh sách video được đề xuất&#10;         */&#10;        void showRecommendedVideos(List&lt;Video&gt; videos);&#10;&#10;        /**&#10;         * Hiển thị video trending cho người dùng mới&#10;         */&#10;        void showTrendingVideos(List&lt;Video&gt; videos);&#10;&#10;        /**&#10;         * Hiển thị trạng thái loading&#10;         */&#10;        void showLoading();&#10;&#10;        /**&#10;         * Ẩn trạng thái loading&#10;         */&#10;        void hideLoading();&#10;&#10;        /**&#10;         * Hiển thị thông báo lỗi&#10;         */&#10;        void showError(String message);&#10;&#10;        /**&#10;         * Cập nhật trạng thái like của video&#10;         */&#10;        void updateLikeStatus(String videoId, boolean isLiked, int likeCount);&#10;&#10;        /**&#10;         * Cập nhật số lượt xem của video&#10;         */&#10;        void updateViewCount(String videoId, int viewCount);&#10;&#10;        /**&#10;         * Hiển thị thông báo thành công&#10;         */&#10;        void showSuccessMessage(String message);&#10;&#10;        /**&#10;         * Chuyển đến màn hình phát video toàn màn hình&#10;         */&#10;        void navigateToFullScreenVideo(Video video);&#10;&#10;        /**&#10;         * Hiển thị dialog chia sẻ video&#10;         */&#10;        void showShareDialog(Video video);&#10;&#10;        /**&#10;         * Refresh danh sách video&#10;         */&#10;        void refreshVideoList();&#10;&#10;        /**&#10;         * Load thêm video (pagination)&#10;         */&#10;        void loadMoreVideos(List&lt;Video&gt; moreVideos);&#10;    }&#10;&#10;    interface Presenter extends BasePresenter&lt;ShortVideoContract.View&gt; {&#10;        /**&#10;         * Load video được đề xuất cho người dùng hiện tại&#10;         */&#10;        void loadRecommendedVideos();&#10;&#10;        /**&#10;         * Load video trending&#10;         */&#10;        void loadTrendingVideos();&#10;&#10;        /**&#10;         * Xử lý khi người dùng like/unlike video&#10;         */&#10;        void onVideoLiked(String videoId, boolean isCurrentlyLiked);&#10;&#10;        /**&#10;         * Xử lý khi video được xem&#10;         */&#10;        void onVideoViewed(String videoId);&#10;&#10;        /**&#10;         * Xử lý khi người dùng chia sẻ video&#10;         */&#10;        void onVideoShared(String videoId);&#10;&#10;        /**&#10;         * Xử lý khi người dùng click vào video để xem toàn màn hình&#10;         */&#10;        void onVideoClicked(Video video);&#10;&#10;        /**&#10;         * Refresh danh sách video&#10;         */&#10;        void refreshVideos();&#10;&#10;        /**&#10;         * Load thêm video (khi scroll đến cuối)&#10;         */&#10;        void loadMoreVideos();&#10;&#10;        /**&#10;         * Xử lý khi video bắt đầu phát&#10;         */&#10;        void onVideoStarted(String videoId);&#10;&#10;        /**&#10;         * Xử lý khi video kết thúc&#10;         */&#10;        void onVideoCompleted(String videoId);&#10;&#10;        /**&#10;         * Lấy user ID hiện tại&#10;         */&#10;        String getCurrentUserId();&#10;&#10;        /**&#10;         * Kiểm tra trạng thái like của video&#10;         */&#10;        void checkLikeStatus(String videoId);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.vhn.doan.presentation.video;&#10;&#10;import com.vhn.doan.data.Video;&#10;import com.vhn.doan.presentation.base.BaseView;&#10;&#10;import java.util.List;&#10;&#10;public interface ShortVideoContract {&#10;&#10;    interface View extends BaseView {&#10;        /**&#10;         * Hiển thị danh sách video được đề xuất&#10;         */&#10;        void showRecommendedVideos(List&lt;Video&gt; videos);&#10;&#10;        /**&#10;         * Hiển thị video trending cho người dùng mới&#10;         */&#10;        void showTrendingVideos(List&lt;Video&gt; videos);&#10;&#10;        /**&#10;         * Hiển thị trạng thái loading&#10;         */&#10;        void showLoading();&#10;&#10;        /**&#10;         * Ẩn trạng thái loading&#10;         */&#10;        void hideLoading();&#10;&#10;        /**&#10;         * Hiển thị thông báo lỗi&#10;         */&#10;        void showError(String message);&#10;&#10;        /**&#10;         * Cập nhật trạng thái like của video&#10;         */&#10;        void updateLikeStatus(String videoId, boolean isLiked, int likeCount);&#10;&#10;        /**&#10;         * Cập nhật số lượt xem của video&#10;         */&#10;        void updateViewCount(String videoId, int viewCount);&#10;&#10;        /**&#10;         * Hiển thị thông báo thành công&#10;         */&#10;        void showSuccessMessage(String message);&#10;&#10;        /**&#10;         * Chuyển đến màn hình phát video toàn màn hình&#10;         */&#10;        void navigateToFullScreenVideo(Video video);&#10;&#10;        /**&#10;         * Hiển thị dialog chia sẻ video&#10;         */&#10;        void showShareDialog(Video video);&#10;&#10;        /**&#10;         * Refresh danh sách video&#10;         */&#10;        void refreshVideoList();&#10;&#10;        /**&#10;         * Load thêm video (pagination)&#10;         */&#10;        void loadMoreVideos(List&lt;Video&gt; moreVideos);&#10;    }&#10;&#10;    interface Presenter {&#10;        /**&#10;         * Gắn view vào presenter&#10;         */&#10;        void attachView(ShortVideoContract.View view);&#10;&#10;        /**&#10;         * Gỡ bỏ view khỏi presenter&#10;         */&#10;        void detachView();&#10;&#10;        /**&#10;         * Bắt đầu presenter&#10;         */&#10;        void start();&#10;&#10;        /**&#10;         * Load video được đề xuất cho người dùng hiện tại&#10;         */&#10;        void loadRecommendedVideos();&#10;&#10;        /**&#10;         * Load video trending&#10;         */&#10;        void loadTrendingVideos();&#10;&#10;        /**&#10;         * Xử lý khi người dùng like/unlike video&#10;         */&#10;        void onVideoLiked(String videoId, boolean isCurrentlyLiked);&#10;&#10;        /**&#10;         * Xử lý khi video được xem&#10;         */&#10;        void onVideoViewed(String videoId);&#10;&#10;        /**&#10;         * Xử lý khi người dùng chia sẻ video&#10;         */&#10;        void onVideoShared(String videoId);&#10;&#10;        /**&#10;         * Xử lý khi người dùng click vào video để xem toàn màn hình&#10;         */&#10;        void onVideoClicked(Video video);&#10;&#10;        /**&#10;         * Refresh danh sách video&#10;         */&#10;        void refreshVideos();&#10;&#10;        /**&#10;         * Load thêm video (khi scroll đến cuối)&#10;         */&#10;        void loadMoreVideos();&#10;&#10;        /**&#10;         * Xử lý khi video bắt đầu phát&#10;         */&#10;        void onVideoStarted(String videoId);&#10;&#10;        /**&#10;         * Xử lý khi video kết thúc&#10;         */&#10;        void onVideoCompleted(String videoId);&#10;&#10;        /**&#10;         * Lấy user ID hiện tại&#10;         */&#10;        String getCurrentUserId();&#10;&#10;        /**&#10;         * Kiểm tra trạng thái like của video&#10;         */&#10;        void checkLikeStatus(String videoId);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/video/ShortVideoItem.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/video/ShortVideoItem.java" />
              <option name="updatedContent" value="package com.vhn.doan.presentation.video;&#10;&#10;/**&#10; * Model đại diện cho một video ngắn&#10; */&#10;public class ShortVideoItem {&#10;    private String id;&#10;    private String title;&#10;    private String description;&#10;    private String videoUrl;&#10;    private String thumbnailUrl;&#10;    private String duration;&#10;    private int viewCount;&#10;    private int likeCount;&#10;    private int commentCount;&#10;&#10;    public ShortVideoItem() {&#10;        // Constructor rỗng cho Firebase&#10;    }&#10;&#10;    public ShortVideoItem(String id, String title, String description, String videoUrl, &#10;                         String thumbnailUrl, String duration, int viewCount, &#10;                         int likeCount, int commentCount) {&#10;        this.id = id;&#10;        this.title = title;&#10;        this.description = description;&#10;        this.videoUrl = videoUrl;&#10;        this.thumbnailUrl = thumbnailUrl;&#10;        this.duration = duration;&#10;        this.viewCount = viewCount;&#10;        this.likeCount = likeCount;&#10;        this.commentCount = commentCount;&#10;    }&#10;&#10;    // Getters&#10;    public String getId() { return id; }&#10;    public String getTitle() { return title; }&#10;    public String getDescription() { return description; }&#10;    public String getVideoUrl() { return videoUrl; }&#10;    public String getThumbnailUrl() { return thumbnailUrl; }&#10;    public String getDuration() { return duration; }&#10;    public int getViewCount() { return viewCount; }&#10;    public int getLikeCount() { return likeCount; }&#10;    public int getCommentCount() { return commentCount; }&#10;&#10;    // Setters&#10;    public void setId(String id) { this.id = id; }&#10;    public void setTitle(String title) { this.title = title; }&#10;    public void setDescription(String description) { this.description = description; }&#10;    public void setVideoUrl(String videoUrl) { this.videoUrl = videoUrl; }&#10;    public void setThumbnailUrl(String thumbnailUrl) { this.thumbnailUrl = thumbnailUrl; }&#10;    public void setDuration(String duration) { this.duration = duration; }&#10;    public void setViewCount(int viewCount) { this.viewCount = viewCount; }&#10;    public void setLikeCount(int likeCount) { this.likeCount = likeCount; }&#10;    public void setCommentCount(int commentCount) { this.commentCount = commentCount; }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoplayer/VideoPlayerActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoplayer/VideoPlayerActivity.java" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortAdapter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortAdapter.java" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortContract.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortContract.java" />
              <option name="updatedContent" value="    interface View {&#10;        void showLoading();&#10;        void hideLoading();&#10;        void showVideos(List&lt;HealthTipVideo&gt; videos);&#10;        void showError(String message);&#10;        void showNoVideos();&#10;        void updateVideoLikeStatus(String videoId, boolean isLiked, int likeCount);&#10;        void showVideoDetails(HealthTipVideo video);&#10;        void showNetworkError();&#10;        void navigateToVideoPlayer(HealthTipVideo video);&#10;        void showSearchResults(List&lt;HealthTipVideo&gt; videos);&#10;        void clearSearchResults();&#10;        &#10;        // Thêm method cho TikTok-style pagination&#10;        void addMoreVideos(List&lt;HealthTipVideo&gt; newVideos);&#10;        void showLoadingMore();&#10;        void hideLoadingMore();&#10;    }" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortFragment.java" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.vhn.doan.presentation.videoshort;&#10;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.viewpager2.widget.ViewPager2;&#10;import com.google.android.material.progressindicator.CircularProgressIndicator;&#10;import com.vhn.doan.R;&#10;import com.vhn.doan.data.HealthTipVideo;&#10;import javax.inject.Inject;&#10;import java.util.List;&#10;&#10;public class VideoShortFragment extends Fragment implements VideoShortContract.View {&#10;&#10;    private static final String TAG = &quot;VideoShortFragment&quot;;&#10;&#10;    @Inject&#10;    VideoShortPresenter presenter;&#10;&#10;    // Views - TikTok style vertical ViewPager&#10;    private ViewPager2 vpVideos;&#10;    private CircularProgressIndicator progressBar;&#10;    private View layoutErrorState;&#10;&#10;    // Adapter - TikTok style vertical video adapter&#10;    private VideoShortVerticalAdapter videoAdapter;&#10;&#10;    // State&#10;    private boolean isLoading = false;&#10;    private int currentPosition = 0;&#10;&#10;    public static VideoShortFragment newInstance() {&#10;        return new VideoShortFragment();&#10;    }&#10;&#10;    @Override&#10;    public void onCreate(@Nullable Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        // Dagger injection sẽ được thực hiện ở đây&#10;    }&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,&#10;                            @Nullable Bundle savedInstanceState) {&#10;        return inflater.inflate(R.layout.fragment_video_short_vertical, container, false);&#10;    }&#10;&#10;    @Override&#10;    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {&#10;        super.onViewCreated(view, savedInstanceState);&#10;        initViews(view);&#10;        setupVerticalViewPager();&#10;        setupPresenter();&#10;&#10;        // Load dữ liệu ban đầu&#10;        loadInitialData();&#10;    }&#10;&#10;    private void initViews(View view) {&#10;        vpVideos = view.findViewById(R.id.vp_videos);&#10;        progressBar = view.findViewById(R.id.progress_bar);&#10;        layoutErrorState = view.findViewById(R.id.layout_error_state);&#10;    }&#10;&#10;    private void setupVerticalViewPager() {&#10;        videoAdapter = new VideoShortVerticalAdapter(requireContext());&#10;        vpVideos.setAdapter(videoAdapter);&#10;        vpVideos.setOrientation(ViewPager2.ORIENTATION_VERTICAL);&#10;&#10;        // Thiết lập listeners cho adapter&#10;        videoAdapter.setOnVideoInteractionListener(new VideoShortVerticalAdapter.OnVideoInteractionListener() {&#10;            @Override&#10;            public void onVideoLike(HealthTipVideo video, boolean isLiked) {&#10;                if (presenter != null) {&#10;                    presenter.onVideoLiked(video, isLiked);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onVideoShare(HealthTipVideo video) {&#10;                shareVideo(video);&#10;            }&#10;&#10;            @Override&#10;            public void onVideoComment(HealthTipVideo video) {&#10;                // TODO: Implement comment functionality&#10;                Toast.makeText(requireContext(), &quot;Chức năng bình luận đang phát triển&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;&#10;            @Override&#10;            public void onVideoView(HealthTipVideo video) {&#10;                if (presenter != null) {&#10;                    presenter.onVideoViewed(video);&#10;                }&#10;            }&#10;        });&#10;&#10;        // Thiết lập page change callback để load more và pause/play video&#10;        vpVideos.registerOnPageChangeCallback(new ViewPager2.OnPageChangeCallback() {&#10;            @Override&#10;            public void onPageSelected(int position) {&#10;                super.onPageSelected(position);&#10;                currentPosition = position;&#10;&#10;                // Pause video ở vị trí cũ và play video ở vị trí mới&#10;                videoAdapter.pauseAllVideos();&#10;                videoAdapter.playVideoAt(position);&#10;&#10;                // Load more videos khi gần hết&#10;                if (position &gt;= videoAdapter.getItemCount() - 3) {&#10;                    loadMoreVideos();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onPageScrollStateChanged(int state) {&#10;                super.onPageScrollStateChanged(state);&#10;                // Có thể thêm logic để pause video khi đang scroll&#10;                if (state == ViewPager2.SCROLL_STATE_DRAGGING) {&#10;                    videoAdapter.pauseAllVideos();&#10;                } else if (state == ViewPager2.SCROLL_STATE_IDLE) {&#10;                    videoAdapter.playVideoAt(currentPosition);&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void setupPresenter() {&#10;        if (presenter != null) {&#10;            presenter.attachView(this);&#10;        }&#10;    }&#10;&#10;    private void loadInitialData() {&#10;        if (presenter != null) {&#10;            presenter.loadRecommendedVideos();&#10;        }&#10;    }&#10;&#10;    private void loadMoreVideos() {&#10;        if (!isLoading &amp;&amp; presenter != null) {&#10;            presenter.loadMoreVideos();&#10;        }&#10;    }&#10;&#10;    private void shareVideo(HealthTipVideo video) {&#10;        Intent shareIntent = new Intent(Intent.ACTION_SEND);&#10;        shareIntent.setType(&quot;text/plain&quot;);&#10;        shareIntent.putExtra(Intent.EXTRA_TEXT,&#10;            &quot;Xem video mẹo sức khỏe hay này: &quot; + video.getTitle() + &quot;\n&quot; + video.getVideoUrl());&#10;        shareIntent.putExtra(Intent.EXTRA_SUBJECT, &quot;Mẹo sức khỏe từ HealthTips&quot;);&#10;&#10;        Intent chooser = Intent.createChooser(shareIntent, &quot;Chia sẻ video&quot;);&#10;        if (shareIntent.resolveActivity(requireContext().getPackageManager()) != null) {&#10;            startActivity(chooser);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onResume() {&#10;        super.onResume();&#10;        if (presenter != null) {&#10;            presenter.attachView(this);&#10;        }&#10;        // Resume video hiện tại&#10;        if (videoAdapter != null) {&#10;            videoAdapter.playVideoAt(currentPosition);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onPause() {&#10;        super.onPause();&#10;        // Pause tất cả video khi fragment bị pause&#10;        if (videoAdapter != null) {&#10;            videoAdapter.pauseAllVideos();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onDestroyView() {&#10;        super.onDestroyView();&#10;        if (presenter != null) {&#10;            presenter.detachView();&#10;        }&#10;        if (videoAdapter != null) {&#10;            videoAdapter.releaseAllPlayers();&#10;        }&#10;    }&#10;&#10;    // Implement VideoShortContract.View methods&#10;&#10;    @Override&#10;    public void showLoading() {&#10;        if (!isLoading) {&#10;            isLoading = true;&#10;            if (progressBar != null) {&#10;                progressBar.setVisibility(View.VISIBLE);&#10;            }&#10;        }&#10;        hideErrorState();&#10;    }&#10;&#10;    @Override&#10;    public void hideLoading() {&#10;        isLoading = false;&#10;        if (progressBar != null) {&#10;            progressBar.setVisibility(View.GONE);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void showVideos(List&lt;HealthTipVideo&gt; videos) {&#10;        hideErrorState();&#10;        if (videoAdapter != null) {&#10;            videoAdapter.setVideos(videos);&#10;            // Auto play video đầu tiên&#10;            if (!videos.isEmpty()) {&#10;                videoAdapter.playVideoAt(0);&#10;            }&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void showError(String message) {&#10;        hideLoading();&#10;        if (layoutErrorState != null) {&#10;            layoutErrorState.setVisibility(View.VISIBLE);&#10;        }&#10;        Toast.makeText(requireContext(), message, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    @Override&#10;    public void showNoVideos() {&#10;        hideLoading();&#10;        Toast.makeText(requireContext(), &quot;Không có video nào để hiển thị&quot;, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    @Override&#10;    public void updateVideoLikeStatus(String videoId, boolean isLiked, int likeCount) {&#10;        if (videoAdapter != null) {&#10;            videoAdapter.updateVideoLikeStatus(videoId, isLiked, likeCount);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void showVideoDetails(HealthTipVideo video) {&#10;        // Có thể implement bottom sheet hiển thị chi tiết video&#10;    }&#10;&#10;    @Override&#10;    public void showNetworkError() {&#10;        showError(getString(R.string.network_error_message));&#10;    }&#10;&#10;    @Override&#10;    public void navigateToVideoPlayer(HealthTipVideo video) {&#10;        // Trong TikTok style, video đã được phát ngay trong fragment&#10;        // Có thể implement fullscreen mode hoặc detail view&#10;    }&#10;&#10;    @Override&#10;    public void showSearchResults(List&lt;HealthTipVideo&gt; videos) {&#10;        showVideos(videos);&#10;    }&#10;&#10;    @Override&#10;    public void clearSearchResults() {&#10;        loadInitialData();&#10;    }&#10;    &#10;    // Implement các method mới cho TikTok-style pagination&#10;    @Override&#10;    public void addMoreVideos(List&lt;HealthTipVideo&gt; newVideos) {&#10;        if (videoAdapter != null &amp;&amp; newVideos != null &amp;&amp; !newVideos.isEmpty()) {&#10;            videoAdapter.addVideos(newVideos);&#10;        }&#10;    }&#10;    &#10;    @Override&#10;    public void showLoadingMore() {&#10;        // Có thể hiển thị loading indicator nhỏ ở cuối danh sách&#10;        // hoặc để trống vì TikTok style thường không hiển thị loading khi load more&#10;    }&#10;    &#10;    @Override&#10;    public void hideLoadingMore() {&#10;        // Ẩn loading indicator nếu có&#10;    }&#10;    &#10;    // Public methods for external access&#10;    public void refreshVideos() {&#10;        if (presenter != null) {&#10;            presenter.refreshVideos();&#10;        }&#10;    }&#10;    &#10;    public void searchVideos(String query) {&#10;        if (presenter != null) {&#10;            presenter.searchVideos(query);&#10;        }&#10;    }&#10;    &#10;    // Method để handle double tap like trên video (như TikTok)&#10;    public void handleDoubleTapLike(HealthTipVideo video) {&#10;        if (presenter != null &amp;&amp; video != null) {&#10;            presenter.onVideoLiked(video, true);&#10;            // Show heart animation effect&#10;            showLikeAnimation();&#10;        }&#10;    }&#10;    &#10;    private void showLikeAnimation() {&#10;        // TODO: Implement heart animation effect khi double tap&#10;        // Có thể sử dụng Lottie animation hoặc custom animation&#10;    }&#10;    &#10;    // Method để pause/resume video khi app vào background&#10;    @Override&#10;    public void onStop() {&#10;        super.onStop();&#10;        if (videoAdapter != null) {&#10;            videoAdapter.pauseAllVideos();&#10;        }&#10;    }&#10;    &#10;    @Override&#10;    public void onStart() {&#10;        super.onStart();&#10;        if (videoAdapter != null &amp;&amp; currentPosition &gt;= 0) {&#10;            videoAdapter.playVideoAt(currentPosition);&#10;        }&#10;    }&#10;    &#10;    private void hideErrorState() {&#10;        if (layoutErrorState != null) {&#10;            layoutErrorState.setVisibility(View.GONE);&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortPresenter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortPresenter.java" />
              <option name="updatedContent" value="    @Override&#10;    public void loadMoreVideos() {&#10;        // TODO: Implement pagination for loading more videos&#10;        Log.d(TAG, &quot;Load more videos - chưa implement&quot;);&#10;    }&#10;    &#10;    // Phương thức hỗ trợ&#10;    private void recordVideoView(HealthTipVideo video) {&#10;        videoRepository.recordVideoView(video.getId(), new RepositoryCallback&lt;Boolean&gt;() {&#10;            @Override&#10;            public void onSuccess(Boolean success) {&#10;                if (success) {&#10;                    // Tăng view count&#10;                    videoRepository.incrementViewCount(video.getId(), new RepositoryCallback&lt;Boolean&gt;() {&#10;                        @Override&#10;                        public void onSuccess(Boolean incrementSuccess) {&#10;                            if (incrementSuccess) {&#10;                                video.setViewCount(video.getViewCount() + 1);&#10;                                Log.d(TAG, &quot;Đã tăng view count cho video: &quot; + video.getId());&#10;                            }&#10;                        }&#10;                        &#10;                        @Override&#10;                        public void onError(String error) {&#10;                            Log.e(TAG, &quot;Lỗi khi tăng view count: &quot; + error);&#10;                        }&#10;                    });&#10;                }&#10;            }&#10;            &#10;            @Override&#10;            public void onError(String error) {&#10;                Log.e(TAG, &quot;Lỗi khi ghi nhận lượt xem: &quot; + error);&#10;            }&#10;        });&#10;    }&#10;    &#10;    public List&lt;HealthTipVideo&gt; getCurrentVideos() {&#10;        return new ArrayList&lt;&gt;(currentVideos);&#10;    }&#10;    &#10;    public boolean isCurrentlyLoading() {&#10;        return isLoading;&#10;    }&#10;    &#10;    // Pagination support&#10;    private int currentPage = 0;&#10;    private static final int PAGE_SIZE = 5;&#10;    private boolean hasMoreVideos = true;&#10;    &#10;    @Override&#10;    public void loadMoreVideos() {&#10;        if (isLoading || !hasMoreVideos || view == null) return;&#10;        &#10;        isLoading = true;&#10;        currentPage++;&#10;        &#10;        // Load videos theo page hiện tại&#10;        loadVideosWithPagination(currentPage, PAGE_SIZE);&#10;    }&#10;    &#10;    private void loadVideosWithPagination(int page, int pageSize) {&#10;        // Tạm thời sử dụng recommended videos, có thể customize theo nhu cầu&#10;        videoRepository.getRecommendedVideos(pageSize, new RepositoryCallback&lt;List&lt;HealthTipVideo&gt;&gt;() {&#10;            @Override&#10;            public void onSuccess(List&lt;HealthTipVideo&gt; newVideos) {&#10;                isLoading = false;&#10;                if (view != null) {&#10;                    if (newVideos.isEmpty() || newVideos.size() &lt; pageSize) {&#10;                        hasMoreVideos = false;&#10;                    }&#10;                    &#10;                    if (!newVideos.isEmpty()) {&#10;                        // Filter để tránh duplicate videos&#10;                        List&lt;HealthTipVideo&gt; filteredVideos = filterDuplicateVideos(newVideos);&#10;                        if (!filteredVideos.isEmpty()) {&#10;                            currentVideos.addAll(filteredVideos);&#10;                            addMoreVideosToView(filteredVideos);&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;            &#10;            @Override&#10;            public void onError(String error) {&#10;                isLoading = false;&#10;                currentPage--; // Rollback page nếu lỗi&#10;                Log.e(TAG, &quot;Lỗi khi tải thêm video: &quot; + error);&#10;                if (view != null) {&#10;                    view.showError(&quot;Không thể tải thêm video. Vui lòng thử lại.&quot;);&#10;                }&#10;            }&#10;        });&#10;    }&#10;    &#10;    private List&lt;HealthTipVideo&gt; filterDuplicateVideos(List&lt;HealthTipVideo&gt; newVideos) {&#10;        List&lt;HealthTipVideo&gt; filteredVideos = new ArrayList&lt;&gt;();&#10;        for (HealthTipVideo newVideo : newVideos) {&#10;            boolean isDuplicate = false;&#10;            for (HealthTipVideo existingVideo : currentVideos) {&#10;                if (existingVideo.getId().equals(newVideo.getId())) {&#10;                    isDuplicate = true;&#10;                    break;&#10;                }&#10;            }&#10;            if (!isDuplicate) {&#10;                filteredVideos.add(newVideo);&#10;            }&#10;        }&#10;        return filteredVideos;&#10;    }&#10;    &#10;    private void addMoreVideosToView(List&lt;HealthTipVideo&gt; newVideos) {&#10;        // Gọi method mới trong view để add videos thay vì replace&#10;        if (view instanceof VideoShortFragment) {&#10;            VideoShortFragment fragment = (VideoShortFragment) view;&#10;            // Sẽ cần thêm method này vào contract&#10;        }&#10;    }&#10;    &#10;    // Reset pagination khi refresh&#10;    @Override&#10;    public void refreshVideos() {&#10;        currentVideos.clear();&#10;        currentPage = 0;&#10;        hasMoreVideos = true;&#10;        if (currentCategoryId != null) {&#10;            loadVideosByCategory(currentCategoryId);&#10;        } else {&#10;            loadRecommendedVideos();&#10;        }&#10;    }" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortVerticalAdapter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/presentation/videoshort/VideoShortVerticalAdapter.java" />
              <option name="updatedContent" value="package com.vhn.doan.presentation.videoshort;&#10;&#10;import android.content.Context;&#10;import android.net.Uri;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.TextView;&#10;import androidx.annotation.NonNull;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;import com.bumptech.glide.Glide;&#10;import com.google.android.exoplayer2.ExoPlayer;&#10;import com.google.android.exoplayer2.MediaItem;&#10;import com.google.android.exoplayer2.Player;&#10;import com.google.android.exoplayer2.ui.StyledPlayerView;&#10;import com.vhn.doan.R;&#10;import com.vhn.doan.data.HealthTipVideo;&#10;import java.text.SimpleDateFormat;&#10;import java.util.ArrayList;&#10;import java.util.Date;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;public class VideoShortVerticalAdapter extends RecyclerView.Adapter&lt;VideoShortVerticalAdapter.VideoViewHolder&gt; {&#10;    &#10;    private List&lt;HealthTipVideo&gt; videos;&#10;    private Context context;&#10;    private OnVideoInteractionListener listener;&#10;    private List&lt;ExoPlayer&gt; players; // Quản lý multiple players&#10;    &#10;    public interface OnVideoInteractionListener {&#10;        void onVideoLike(HealthTipVideo video, boolean isLiked);&#10;        void onVideoShare(HealthTipVideo video);&#10;        void onVideoComment(HealthTipVideo video);&#10;        void onVideoView(HealthTipVideo video);&#10;    }&#10;    &#10;    public VideoShortVerticalAdapter(Context context) {&#10;        this.context = context;&#10;        this.videos = new ArrayList&lt;&gt;();&#10;        this.players = new ArrayList&lt;&gt;();&#10;    }&#10;    &#10;    public void setOnVideoInteractionListener(OnVideoInteractionListener listener) {&#10;        this.listener = listener;&#10;    }&#10;    &#10;    public void setVideos(List&lt;HealthTipVideo&gt; videos) {&#10;        // Release old players&#10;        releaseAllPlayers();&#10;        &#10;        this.videos.clear();&#10;        this.players.clear();&#10;        &#10;        if (videos != null) {&#10;            this.videos.addAll(videos);&#10;            // Tạo players cho mỗi video&#10;            for (int i = 0; i &lt; videos.size(); i++) {&#10;                ExoPlayer player = new ExoPlayer.Builder(context).build();&#10;                players.add(player);&#10;            }&#10;        }&#10;        notifyDataSetChanged();&#10;    }&#10;    &#10;    public void addVideos(List&lt;HealthTipVideo&gt; newVideos) {&#10;        if (newVideos != null &amp;&amp; !newVideos.isEmpty()) {&#10;            int startPosition = this.videos.size();&#10;            this.videos.addAll(newVideos);&#10;            &#10;            // Tạo players cho videos mới&#10;            for (int i = 0; i &lt; newVideos.size(); i++) {&#10;                ExoPlayer player = new ExoPlayer.Builder(context).build();&#10;                players.add(player);&#10;            }&#10;            &#10;            notifyItemRangeInserted(startPosition, newVideos.size());&#10;        }&#10;    }&#10;    &#10;    public void updateVideoLikeStatus(String videoId, boolean isLiked, int likeCount) {&#10;        for (int i = 0; i &lt; videos.size(); i++) {&#10;            HealthTipVideo video = videos.get(i);&#10;            if (video.getId().equals(videoId)) {&#10;                video.setLikeCount(likeCount);&#10;                notifyItemChanged(i);&#10;                break;&#10;            }&#10;        }&#10;    }&#10;    &#10;    public void playVideoAt(int position) {&#10;        if (position &gt;= 0 &amp;&amp; position &lt; players.size()) {&#10;            ExoPlayer player = players.get(position);&#10;            if (player != null) {&#10;                player.setPlayWhenReady(true);&#10;                &#10;                // Gọi callback cho presenter để record view&#10;                if (listener != null &amp;&amp; position &lt; videos.size()) {&#10;                    listener.onVideoView(videos.get(position));&#10;                }&#10;            }&#10;        }&#10;    }&#10;    &#10;    public void pauseAllVideos() {&#10;        for (ExoPlayer player : players) {&#10;            if (player != null) {&#10;                player.setPlayWhenReady(false);&#10;            }&#10;        }&#10;    }&#10;    &#10;    public void releaseAllPlayers() {&#10;        for (ExoPlayer player : players) {&#10;            if (player != null) {&#10;                player.release();&#10;            }&#10;        }&#10;        players.clear();&#10;    }&#10;    &#10;    @NonNull&#10;    @Override&#10;    public VideoViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#10;        View view = LayoutInflater.from(parent.getContext())&#10;                .inflate(R.layout.item_video_short_vertical, parent, false);&#10;        return new VideoViewHolder(view);&#10;    }&#10;    &#10;    @Override&#10;    public void onBindViewHolder(@NonNull VideoViewHolder holder, int position) {&#10;        HealthTipVideo video = videos.get(position);&#10;        ExoPlayer player = players.get(position);&#10;        holder.bind(video, player, position);&#10;    }&#10;    &#10;    @Override&#10;    public int getItemCount() {&#10;        return videos.size();&#10;    }&#10;    &#10;    public class VideoViewHolder extends RecyclerView.ViewHolder {&#10;        private StyledPlayerView playerView;&#10;        private TextView tvTitle;&#10;        private TextView tvDescription;&#10;        private TextView tvAuthor;&#10;        private TextView tvViewCount;&#10;        private TextView tvLikeCount;&#10;        private TextView tvCommentCount;&#10;        private ImageView ivLike;&#10;        private ImageView ivComment;&#10;        private ImageView ivShare;&#10;        private ImageView ivUserAvatar;&#10;        private View btnFollow;&#10;        &#10;        // State&#10;        private boolean isLiked = false;&#10;        &#10;        public VideoViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            initViews(itemView);&#10;        }&#10;        &#10;        private void initViews(View itemView) {&#10;            playerView = itemView.findViewById(R.id.player_view);&#10;            tvTitle = itemView.findViewById(R.id.tv_title);&#10;            tvDescription = itemView.findViewById(R.id.tv_description);&#10;            tvAuthor = itemView.findViewById(R.id.tv_author);&#10;            tvViewCount = itemView.findViewById(R.id.tv_view_count);&#10;            tvLikeCount = itemView.findViewById(R.id.tv_like_count);&#10;            tvCommentCount = itemView.findViewById(R.id.tv_comment_count);&#10;            ivLike = itemView.findViewById(R.id.iv_like);&#10;            ivComment = itemView.findViewById(R.id.iv_comment);&#10;            ivShare = itemView.findViewById(R.id.iv_share);&#10;            ivUserAvatar = itemView.findViewById(R.id.iv_user_avatar);&#10;            btnFollow = itemView.findViewById(R.id.btn_follow);&#10;        }&#10;        &#10;        public void bind(HealthTipVideo video, ExoPlayer player, int position) {&#10;            // Thiết lập thông tin video&#10;            tvTitle.setText(video.getTitle());&#10;            tvDescription.setText(video.getDescription());&#10;            tvAuthor.setText(&quot;@healthtips&quot;); // Có thể lấy từ authorId&#10;            tvViewCount.setText(formatCount(video.getViewCount()) + &quot; lượt xem&quot;);&#10;            tvLikeCount.setText(formatCount(video.getLikeCount()));&#10;            tvCommentCount.setText(&quot;0&quot;); // TODO: Implement comment count&#10;            &#10;            // Thiết lập video player&#10;            setupVideoPlayer(video, player);&#10;            &#10;            // Thiết lập user avatar&#10;            setupUserAvatar();&#10;            &#10;            // Thiết lập click listeners&#10;            setupClickListeners(video, position);&#10;            &#10;            // Check like status (tạm thời set false, sẽ được update từ presenter)&#10;            updateLikeButton(false);&#10;        }&#10;        &#10;        private void setupVideoPlayer(HealthTipVideo video, ExoPlayer player) {&#10;            playerView.setPlayer(player);&#10;            playerView.setUseController(false); // Tắt controls mặc định như TikTok&#10;            playerView.setShowBuffering(StyledPlayerView.SHOW_BUFFERING_WHEN_PLAYING);&#10;            &#10;            // Thiết lập media item&#10;            if (video.getVideoUrl() != null &amp;&amp; !video.getVideoUrl().isEmpty()) {&#10;                MediaItem mediaItem = MediaItem.fromUri(Uri.parse(video.getVideoUrl()));&#10;                player.setMediaItem(mediaItem);&#10;                player.prepare();&#10;                player.setRepeatMode(Player.REPEAT_MODE_ONE); // Loop video như TikTok&#10;            }&#10;            &#10;            // Double tap để like (như TikTok)&#10;            playerView.setOnClickListener(v -&gt; {&#10;                // Single tap pause/play&#10;                if (player.isPlaying()) {&#10;                    player.setPlayWhenReady(false);&#10;                } else {&#10;                    player.setPlayWhenReady(true);&#10;                }&#10;            });&#10;        }&#10;        &#10;        private void setupUserAvatar() {&#10;            // Load avatar placeholder&#10;            Glide.with(context)&#10;                    .load(R.drawable.ic_user_avatar_placeholder)&#10;                    .circleCrop()&#10;                    .into(ivUserAvatar);&#10;        }&#10;        &#10;        private void setupClickListeners(HealthTipVideo video, int position) {&#10;            // Like button&#10;            ivLike.setOnClickListener(v -&gt; {&#10;                isLiked = !isLiked;&#10;                updateLikeButton(isLiked);&#10;                if (listener != null) {&#10;                    listener.onVideoLike(video, isLiked);&#10;                }&#10;                &#10;                // Animation effect như TikTok&#10;                animateLikeButton();&#10;            });&#10;            &#10;            // Comment button&#10;            ivComment.setOnClickListener(v -&gt; {&#10;                if (listener != null) {&#10;                    listener.onVideoComment(video);&#10;                }&#10;            });&#10;            &#10;            // Share button&#10;            ivShare.setOnClickListener(v -&gt; {&#10;                if (listener != null) {&#10;                    listener.onVideoShare(video);&#10;                }&#10;            });&#10;            &#10;            // Follow button&#10;            btnFollow.setOnClickListener(v -&gt; {&#10;                // TODO: Implement follow functionality&#10;            });&#10;            &#10;            // User avatar click&#10;            ivUserAvatar.setOnClickListener(v -&gt; {&#10;                // TODO: Navigate to user profile&#10;            });&#10;        }&#10;        &#10;        private void updateLikeButton(boolean isLiked) {&#10;            if (isLiked) {&#10;                ivLike.setImageResource(R.drawable.ic_heart_filled);&#10;                ivLike.setColorFilter(context.getResources().getColor(R.color.red_like));&#10;            } else {&#10;                ivLike.setImageResource(R.drawable.ic_heart_outline);&#10;                ivLike.setColorFilter(context.getResources().getColor(R.color.white));&#10;            }&#10;        }&#10;        &#10;        private void animateLikeButton() {&#10;            // Simple scale animation&#10;            ivLike.animate()&#10;                    .scaleX(1.2f)&#10;                    .scaleY(1.2f)&#10;                    .setDuration(100)&#10;                    .withEndAction(() -&gt; {&#10;                        ivLike.animate()&#10;                                .scaleX(1.0f)&#10;                                .scaleY(1.0f)&#10;                                .setDuration(100)&#10;                                .start();&#10;                    })&#10;                    .start();&#10;        }&#10;        &#10;        private String formatCount(int count) {&#10;            if (count &lt; 1000) {&#10;                return String.valueOf(count);&#10;            } else if (count &lt; 1000000) {&#10;                return String.format(Locale.getDefault(), &quot;%.1fK&quot;, count / 1000.0);&#10;            } else {&#10;                return String.format(Locale.getDefault(), &quot;%.1fM&quot;, count / 1000000.0);&#10;            }&#10;        }&#10;    }&#10;    &#10;    public List&lt;HealthTipVideo&gt; getVideos() {&#10;        return new ArrayList&lt;&gt;(videos);&#10;    }&#10;    &#10;    public HealthTipVideo getVideoAt(int position) {&#10;        if (position &gt;= 0 &amp;&amp; position &lt; videos.size()) {&#10;            return videos.get(position);&#10;        }&#10;        return null;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/services/CloudinaryManager.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/services/CloudinaryManager.java" />
              <option name="updatedContent" value="package com.vhn.doan.services;&#10;&#10;import android.content.Context;&#10;import android.net.Uri;&#10;import android.util.Log;&#10;&#10;import com.cloudinary.Cloudinary;&#10;import com.cloudinary.utils.ObjectUtils;&#10;&#10;import java.io.IOException;&#10;import java.io.InputStream;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;import java.util.concurrent.ExecutorService;&#10;import java.util.concurrent.Executors;&#10;&#10;/**&#10; * Manager để quản lý upload video lên Cloudinary&#10; * Thay thế Firebase Storage cho chức năng video ngắn&#10; */&#10;public class CloudinaryManager {&#10;    private static final String TAG = &quot;CloudinaryManager&quot;;&#10;    private static CloudinaryManager instance;&#10;    private Cloudinary cloudinary;&#10;    private ExecutorService executorService;&#10;&#10;    // Callback interface cho upload&#10;    public interface CloudinaryUploadCallback {&#10;        void onSuccess(String publicId, String videoUrl, String thumbnailUrl);&#10;        void onError(String error);&#10;        void onProgress(int progress);&#10;    }&#10;&#10;    private CloudinaryManager() {&#10;        // Khởi tạo Cloudinary với thông tin cấu hình&#10;        // Bạn cần thay thế các giá trị này bằng thông tin từ Cloudinary dashboard&#10;        Map&lt;String, String&gt; config = new HashMap&lt;&gt;();&#10;        config.put(&quot;cloud_name&quot;, &quot;YOUR_CLOUD_NAME&quot;); // Thay bằng cloud name của bạn&#10;        config.put(&quot;api_key&quot;, &quot;YOUR_API_KEY&quot;); // Thay bằng API key của bạn&#10;        config.put(&quot;api_secret&quot;, &quot;YOUR_API_SECRET&quot;); // Thay bằng API secret của bạn&#10;        config.put(&quot;secure&quot;, &quot;true&quot;);&#10;        &#10;        cloudinary = new Cloudinary(config);&#10;        executorService = Executors.newFixedThreadPool(3);&#10;    }&#10;&#10;    public static synchronized CloudinaryManager getInstance() {&#10;        if (instance == null) {&#10;            instance = new CloudinaryManager();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    /**&#10;     * Upload video lên Cloudinary&#10;     * @param context Context của ứng dụng&#10;     * @param videoUri URI của video cần upload&#10;     * @param videoTitle Tiêu đề video (dùng làm public_id)&#10;     * @param callback Callback để nhận kết quả&#10;     */&#10;    public void uploadVideo(Context context, Uri videoUri, String videoTitle, CloudinaryUploadCallback callback) {&#10;        executorService.execute(() -&gt; {&#10;            try {&#10;                // Tạo public_id từ title và timestamp để tránh trùng lặp&#10;                String publicId = &quot;videos/&quot; + sanitizeTitle(videoTitle) + &quot;_&quot; + System.currentTimeMillis();&#10;                &#10;                // Mở InputStream từ URI&#10;                InputStream inputStream = context.getContentResolver().openInputStream(videoUri);&#10;                if (inputStream == null) {&#10;                    callback.onError(&quot;Không thể đọc file video&quot;);&#10;                    return;&#10;                }&#10;&#10;                // Cấu hình upload options&#10;                Map&lt;String, Object&gt; uploadOptions = ObjectUtils.asMap(&#10;                    &quot;public_id&quot;, publicId,&#10;                    &quot;resource_type&quot;, &quot;video&quot;,&#10;                    &quot;folder&quot;, &quot;health_tips_videos&quot;,&#10;                    &quot;format&quot;, &quot;mp4&quot;,&#10;                    &quot;quality&quot;, &quot;auto:good&quot;,&#10;                    &quot;eager&quot;, ObjectUtils.asArray(&#10;                        ObjectUtils.asMap(&#10;                            &quot;width&quot;, 720,&#10;                            &quot;height&quot;, 1280,&#10;                            &quot;crop&quot;, &quot;fill&quot;,&#10;                            &quot;format&quot;, &quot;mp4&quot;,&#10;                            &quot;quality&quot;, &quot;auto:good&quot;&#10;                        )&#10;                    ),&#10;                    &quot;eager_async&quot;, true,&#10;                    &quot;notification_url&quot;, &quot;&quot; // Có thể thêm webhook URL nếu cần&#10;                );&#10;&#10;                Log.d(TAG, &quot;Bắt đầu upload video: &quot; + publicId);&#10;                callback.onProgress(10);&#10;&#10;                // Thực hiện upload&#10;                Map uploadResult = cloudinary.uploader().upload(inputStream, uploadOptions);&#10;                &#10;                inputStream.close();&#10;                &#10;                callback.onProgress(90);&#10;&#10;                // Lấy URL video và thumbnail&#10;                String videoUrl = (String) uploadResult.get(&quot;secure_url&quot;);&#10;                String thumbnailUrl = generateThumbnailUrl(publicId);&#10;                &#10;                Log.d(TAG, &quot;Upload thành công - Video URL: &quot; + videoUrl);&#10;                Log.d(TAG, &quot;Thumbnail URL: &quot; + thumbnailUrl);&#10;                &#10;                callback.onProgress(100);&#10;                callback.onSuccess(publicId, videoUrl, thumbnailUrl);&#10;&#10;            } catch (IOException e) {&#10;                Log.e(TAG, &quot;Lỗi upload video: &quot; + e.getMessage(), e);&#10;                callback.onError(&quot;Lỗi upload video: &quot; + e.getMessage());&#10;            } catch (Exception e) {&#10;                Log.e(TAG, &quot;Lỗi không xác định: &quot; + e.getMessage(), e);&#10;                callback.onError(&quot;Lỗi không xác định: &quot; + e.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Tạo URL thumbnail từ public_id của video&#10;     */&#10;    private String generateThumbnailUrl(String publicId) {&#10;        try {&#10;            Map&lt;String, Object&gt; options = ObjectUtils.asMap(&#10;                &quot;width&quot;, 480,&#10;                &quot;height&quot;, 854,&#10;                &quot;crop&quot;, &quot;fill&quot;,&#10;                &quot;format&quot;, &quot;jpg&quot;,&#10;                &quot;quality&quot;, &quot;auto:good&quot;&#10;            );&#10;            &#10;            return cloudinary.url()&#10;                .resourceType(&quot;video&quot;)&#10;                .transformation(options)&#10;                .generate(publicId);&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;Lỗi tạo thumbnail URL: &quot; + e.getMessage());&#10;            return &quot;&quot;;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Làm sạch title để sử dụng làm public_id&#10;     */&#10;    private String sanitizeTitle(String title) {&#10;        if (title == null || title.trim().isEmpty()) {&#10;            return &quot;untitled&quot;;&#10;        }&#10;        &#10;        return title.trim()&#10;                .toLowerCase()&#10;                .replaceAll(&quot;[^a-zA-Z0-9]&quot;, &quot;_&quot;)&#10;                .replaceAll(&quot;_{2,}&quot;, &quot;_&quot;)&#10;                .replaceAll(&quot;^_|_$&quot;, &quot;&quot;);&#10;    }&#10;&#10;    /**&#10;     * Xóa video từ Cloudinary&#10;     */&#10;    public void deleteVideo(String publicId, CloudinaryUploadCallback callback) {&#10;        executorService.execute(() -&gt; {&#10;            try {&#10;                Map result = cloudinary.uploader().destroy(publicId, &#10;                    ObjectUtils.asMap(&quot;resource_type&quot;, &quot;video&quot;));&#10;                &#10;                String resultStatus = (String) result.get(&quot;result&quot;);&#10;                if (&quot;ok&quot;.equals(resultStatus)) {&#10;                    Log.d(TAG, &quot;Xóa video thành công: &quot; + publicId);&#10;                    callback.onSuccess(publicId, &quot;&quot;, &quot;&quot;);&#10;                } else {&#10;                    Log.e(TAG, &quot;Lỗi xóa video: &quot; + result.toString());&#10;                    callback.onError(&quot;Không thể xóa video&quot;);&#10;                }&#10;            } catch (Exception e) {&#10;                Log.e(TAG, &quot;Lỗi xóa video: &quot; + e.getMessage(), e);&#10;                callback.onError(&quot;Lỗi xóa video: &quot; + e.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Lấy thông tin video từ Cloudinary&#10;     */&#10;    public void getVideoInfo(String publicId, CloudinaryUploadCallback callback) {&#10;        executorService.execute(() -&gt; {&#10;            try {&#10;                Map result = cloudinary.api().resource(publicId, &#10;                    ObjectUtils.asMap(&quot;resource_type&quot;, &quot;video&quot;));&#10;                &#10;                String videoUrl = (String) result.get(&quot;secure_url&quot;);&#10;                String thumbnailUrl = generateThumbnailUrl(publicId);&#10;                &#10;                callback.onSuccess(publicId, videoUrl, thumbnailUrl);&#10;            } catch (Exception e) {&#10;                Log.e(TAG, &quot;Lỗi lấy thông tin video: &quot; + e.getMessage(), e);&#10;                callback.onError(&quot;Lỗi lấy thông tin video: &quot; + e.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Cleanup resources&#10;     */&#10;    public void shutdown() {&#10;        if (executorService != null &amp;&amp; !executorService.isShutdown()) {&#10;            executorService.shutdown();&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/services/CloudinaryVideoUploadService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/services/CloudinaryVideoUploadService.java" />
              <option name="updatedContent" value="package com.vhn.doan.services;&#10;&#10;import android.content.Context;&#10;import android.net.Uri;&#10;import android.util.Log;&#10;&#10;/**&#10; * Implementation của VideoUploadService sử dụng Cloudinary&#10; * Thay thế Firebase Storage cho việc upload video&#10; */&#10;public class CloudinaryVideoUploadService implements VideoUploadService {&#10;    private static final String TAG = &quot;CloudinaryVideoUpload&quot;;&#10;    private Context context;&#10;    private CloudinaryManager cloudinaryManager;&#10;&#10;    public CloudinaryVideoUploadService(Context context) {&#10;        this.context = context;&#10;        this.cloudinaryManager = CloudinaryManager.getInstance();&#10;    }&#10;&#10;    @Override&#10;    public void uploadVideo(Uri videoUri, String title, VideoUploadCallback callback) {&#10;        Log.d(TAG, &quot;Bắt đầu upload video: &quot; + title);&#10;        callback.onUploadStart();&#10;&#10;        cloudinaryManager.uploadVideo(context, videoUri, title, new CloudinaryManager.CloudinaryUploadCallback() {&#10;            @Override&#10;            public void onSuccess(String publicId, String videoUrl, String thumbnailUrl) {&#10;                Log.d(TAG, &quot;Upload video thành công - PublicId: &quot; + publicId);&#10;                callback.onUploadSuccess(videoUrl, thumbnailUrl, publicId);&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                Log.e(TAG, &quot;Lỗi upload video: &quot; + error);&#10;                callback.onUploadError(error);&#10;            }&#10;&#10;            @Override&#10;            public void onProgress(int progress) {&#10;                Log.d(TAG, &quot;Tiến trình upload: &quot; + progress + &quot;%&quot;);&#10;                callback.onUploadProgress(progress);&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    public void deleteVideo(String publicId, VideoUploadCallback callback) {&#10;        Log.d(TAG, &quot;Bắt đầu xóa video: &quot; + publicId);&#10;        &#10;        cloudinaryManager.deleteVideo(publicId, new CloudinaryManager.CloudinaryUploadCallback() {&#10;            @Override&#10;            public void onSuccess(String publicId, String videoUrl, String thumbnailUrl) {&#10;                Log.d(TAG, &quot;Xóa video thành công: &quot; + publicId);&#10;                callback.onUploadSuccess(&quot;&quot;, &quot;&quot;, publicId);&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                Log.e(TAG, &quot;Lỗi xóa video: &quot; + error);&#10;                callback.onUploadError(error);&#10;            }&#10;&#10;            @Override&#10;            public void onProgress(int progress) {&#10;                // Không cần progress cho delete&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    public void checkVideoExists(String publicId, VideoUploadCallback callback) {&#10;        Log.d(TAG, &quot;Kiểm tra video tồn tại: &quot; + publicId);&#10;        &#10;        cloudinaryManager.getVideoInfo(publicId, new CloudinaryManager.CloudinaryUploadCallback() {&#10;            @Override&#10;            public void onSuccess(String publicId, String videoUrl, String thumbnailUrl) {&#10;                Log.d(TAG, &quot;Video tồn tại: &quot; + publicId);&#10;                callback.onUploadSuccess(videoUrl, thumbnailUrl, publicId);&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                Log.e(TAG, &quot;Video không tồn tại hoặc lỗi: &quot; + error);&#10;                callback.onUploadError(error);&#10;            }&#10;&#10;            @Override&#10;            public void onProgress(int progress) {&#10;                // Không cần progress cho check&#10;            }&#10;        });&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/services/VideoUploadService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/services/VideoUploadService.java" />
              <option name="updatedContent" value="package com.vhn.doan.services;&#10;&#10;import android.net.Uri;&#10;&#10;/**&#10; * Interface cho service upload video&#10; * Định nghĩa các phương thức cần thiết cho việc upload video&#10; */&#10;public interface VideoUploadService {&#10;    &#10;    /**&#10;     * Callback interface cho upload video&#10;     */&#10;    interface VideoUploadCallback {&#10;        void onUploadStart();&#10;        void onUploadProgress(int progress);&#10;        void onUploadSuccess(String videoUrl, String thumbnailUrl, String publicId);&#10;        void onUploadError(String error);&#10;    }&#10;&#10;    /**&#10;     * Upload video lên cloud storage&#10;     * @param videoUri URI của video cần upload&#10;     * @param title Tiêu đề video&#10;     * @param callback Callback để nhận kết quả&#10;     */&#10;    void uploadVideo(Uri videoUri, String title, VideoUploadCallback callback);&#10;&#10;    /**&#10;     * Xóa video từ cloud storage&#10;     * @param publicId ID của video trên cloud&#10;     * @param callback Callback để nhận kết quả&#10;     */&#10;    void deleteVideo(String publicId, VideoUploadCallback callback);&#10;&#10;    /**&#10;     * Kiểm tra video có tồn tại không&#10;     * @param publicId ID của video trên cloud&#10;     * @param callback Callback để nhận kết quả&#10;     */&#10;    void checkVideoExists(String publicId, VideoUploadCallback callback);&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/utils/FirebaseTestDataUploader.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/utils/FirebaseTestDataUploader.java" />
              <option name="updatedContent" value="package com.vhn.doan.utils;&#10;&#10;import com.google.firebase.database.DatabaseReference;&#10;import com.google.firebase.database.FirebaseDatabase;&#10;import com.vhn.doan.data.model.ShortVideoModel;&#10;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;/**&#10; * Utility class để upload dữ liệu test lên Firebase&#10; * CHỈ SỬ DỤNG CHO TESTING - XÓA SAU KHI HOÀN THÀNH&#10; */&#10;public class FirebaseTestDataUploader {&#10;&#10;    private static final String FIREBASE_URL = &quot;https://reminderwater-84694-default-rtdb.firebaseio.com/&quot;;&#10;&#10;    /**&#10;     * Upload dữ liệu video test lên Firebase&#10;     * GỌI METHOD NÀY MỘT LẦN DUY NHẤT để upload dữ liệu test&#10;     */&#10;    public static void uploadTestVideoData() {&#10;        FirebaseDatabase database = FirebaseDatabase.getInstance(FIREBASE_URL);&#10;        DatabaseReference videosRef = database.getReference(&quot;videos&quot;);&#10;&#10;        // Tạo dữ liệu video test&#10;        Map&lt;String, ShortVideoModel&gt; videosData = createTestVideoData();&#10;&#10;        // Upload lên Firebase&#10;        videosRef.setValue(videosData)&#10;                .addOnSuccessListener(aVoid -&gt; {&#10;                    android.util.Log.d(&quot;FirebaseUploader&quot;, &quot;✅ Upload video data thành công!&quot;);&#10;                })&#10;                .addOnFailureListener(e -&gt; {&#10;                    android.util.Log.e(&quot;FirebaseUploader&quot;, &quot;❌ Lỗi upload video data: &quot; + e.getMessage());&#10;                });&#10;    }&#10;&#10;    /**&#10;     * Tạo dữ liệu video test giống như trong firebase_test_data.json&#10;     */&#10;    private static Map&lt;String, ShortVideoModel&gt; createTestVideoData() {&#10;        Map&lt;String, ShortVideoModel&gt; videos = new HashMap&lt;&gt;();&#10;&#10;        // Video 001&#10;        ShortVideoModel video001 = new ShortVideoModel();&#10;        video001.setTitle(&quot;10 Bài tập cardio đốt cháy mỡ bụng hiệu quả&quot;);&#10;        video001.setCaption(&quot;Hướng dẫn 10 bài tập cardio đơn giản giúp đốt cháy mỡ bụng tại nhà, phù hợp cho người mới bắt đầu. Thực hiện 15-20 phút mỗi ngày để có hiệu quả tốt nhất.&quot;);&#10;        video001.setUploadDate(1733472000000L);&#10;        video001.setVideoUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/video%2F247419804982081.mp4?alt=media&amp;token=4204f472-b1f2-4110-9b0f-ed0e2cfcede2&quot;);&#10;        video001.setThumbnailUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/image%2Fretouch_2024050322414530.jpg?alt=media&amp;token=8a0f4e12-8116-4633-96f1-a1997720f2ea&quot;);&#10;        video001.setCategoryId(&quot;cat002&quot;);&#10;        Map&lt;String, Boolean&gt; tags001 = new HashMap&lt;&gt;();&#10;        tags001.put(&quot;giamcan&quot;, true);&#10;        tags001.put(&quot;tapluyen&quot;, true);&#10;        tags001.put(&quot;cardio&quot;, true);&#10;        tags001.put(&quot;tainhanewbie&quot;, true);&#10;        video001.setTags(tags001);&#10;        video001.setViewCount(2840L);&#10;        video001.setLikeCount(187L);&#10;        video001.setUserId(&quot;user001&quot;);&#10;        videos.put(&quot;video001&quot;, video001);&#10;&#10;        // Video 002&#10;        ShortVideoModel video002 = new ShortVideoModel();&#10;        video002.setTitle(&quot;Yoga buổi sáng 15 phút cho năng lượng cả ngày&quot;);&#10;        video002.setCaption(&quot;Bài tập yoga nhẹ nhàng giúp khởi động cơ thể, giải tỏa căng thẳng và tạo năng lượng tích cực cho ngày mới. Phù hợp cho mọi độ tuổi.&quot;);&#10;        video002.setUploadDate(1733385600000L);&#10;        video002.setVideoUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/video%2F247419804982081.mp4?alt=media&amp;token=4204f472-b1f2-4110-9b0f-ed0e2cfcede2&quot;);&#10;        video002.setThumbnailUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/image%2Fretouch_2024050322414530.jpg?alt=media&amp;token=8a0f4e12-8116-4633-96f1-a1997720f2ea&quot;);&#10;        video002.setCategoryId(&quot;cat004&quot;);&#10;        Map&lt;String, Boolean&gt; tags002 = new HashMap&lt;&gt;();&#10;        tags002.put(&quot;yoga&quot;, true);&#10;        tags002.put(&quot;thientanh&quot;, true);&#10;        tags002.put(&quot;buoisang&quot;, true);&#10;        tags002.put(&quot;suckhoetirithan&quot;, true);&#10;        video002.setTags(tags002);&#10;        video002.setViewCount(1956L);&#10;        video002.setLikeCount(143L);&#10;        video002.setUserId(&quot;user002&quot;);&#10;        videos.put(&quot;video002&quot;, video002);&#10;&#10;        // Video 003&#10;        ShortVideoModel video003 = new ShortVideoModel();&#10;        video003.setTitle(&quot;Cách pha nước detox giảm cân từ chanh và mật ong&quot;);&#10;        video003.setCaption(&quot;Công thức đơn giản pha nước detox giúp thanh lọc cơ thể, tăng cường trao đổi chất và hỗ trợ giảm cân hiệu quả. Nguyên liệu dễ tìm tại nhà.&quot;);&#10;        video003.setUploadDate(1733299200000L);&#10;        video003.setVideoUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/video%2F247419804982081.mp4?alt=media&amp;token=4204f472-b1f2-4110-9b0f-ed0e2cfcede2&quot;);&#10;        video003.setThumbnailUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/image%2Fretouch_2024050322414530.jpg?alt=media&amp;token=8a0f4e12-8116-4633-96f1-a1997720f2ea&quot;);&#10;        video003.setCategoryId(&quot;cat001&quot;);&#10;        Map&lt;String, Boolean&gt; tags003 = new HashMap&lt;&gt;();&#10;        tags003.put(&quot;detox&quot;, true);&#10;        tags003.put(&quot;giamcan&quot;, true);&#10;        tags003.put(&quot;dinhdong&quot;, true);&#10;        tags003.put(&quot;chanh&quot;, true);&#10;        tags003.put(&quot;matong&quot;, true);&#10;        video003.setTags(tags003);&#10;        video003.setViewCount(3214L);&#10;        video003.setLikeCount(298L);&#10;        video003.setUserId(&quot;user003&quot;);&#10;        videos.put(&quot;video003&quot;, video003);&#10;&#10;        // Video 004&#10;        ShortVideoModel video004 = new ShortVideoModel();&#10;        video004.setTitle(&quot;5 Phút massage giảm đau vai gáy hiệu quả&quot;);&#10;        video004.setCaption(&quot;Hướng dẫn massage tự thực hiện tại nhà để giải tỏa đau mỏi vai gáy cho dân văn phòng. Chỉ cần 5 phút mỗi ngày để cải thiện tình trạng.&quot;);&#10;        video004.setUploadDate(1733212800000L);&#10;        video004.setVideoUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/video%2F247419804982081.mp4?alt=media&amp;token=4204f472-b1f2-4110-9b0f-ed0e2cfcede2&quot;);&#10;        video004.setThumbnailUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/image%2Fretouch_2024050322414530.jpg?alt=media&amp;token=8a0f4e12-8116-4633-96f1-a1997720f2ea&quot;);&#10;        video004.setCategoryId(&quot;cat004&quot;);&#10;        Map&lt;String, Boolean&gt; tags004 = new HashMap&lt;&gt;();&#10;        tags004.put(&quot;massage&quot;, true);&#10;        tags004.put(&quot;vaigay&quot;, true);&#10;        tags004.put(&quot;danvanphong&quot;, true);&#10;        tags004.put(&quot;giamdau&quot;, true);&#10;        video004.setTags(tags004);&#10;        video004.setViewCount(1687L);&#10;        video004.setLikeCount(124L);&#10;        video004.setUserId(&quot;user001&quot;);&#10;        videos.put(&quot;video004&quot;, video004);&#10;&#10;        // Video 005&#10;        ShortVideoModel video005 = new ShortVideoModel();&#10;        video005.setTitle(&quot;Thực đơn eat clean 7 ngày cho người bận rộn&quot;);&#10;        video005.setCaption(&quot;Menu ăn sạch 7 ngày với các món ăn đơn giản, dễ làm phù hợp cho người bận rộn. Đầy đủ dinh dưỡng và hỗ trợ giảm cân hiệu quả.&quot;);&#10;        video005.setUploadDate(1733126400000L);&#10;        video005.setVideoUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/video%2F247419804982081.mp4?alt=media&amp;token=4204f472-b1f2-4110-9b0f-ed0e2cfcede2&quot;);&#10;        video005.setThumbnailUrl(&quot;https://firebasestorage.googleapis.com/v0/b/reminderwater-84694.appspot.com/o/image%2Fretouch_2024050322414530.jpg?alt=media&amp;token=8a0f4e12-8116-4633-96f1-a1997720f2ea&quot;);&#10;        video005.setCategoryId(&quot;cat001&quot;);&#10;        Map&lt;String, Boolean&gt; tags005 = new HashMap&lt;&gt;();&#10;        tags005.put(&quot;eatclean&quot;, true);&#10;        tags005.put(&quot;thucdon&quot;, true);&#10;        tags005.put(&quot;dinhdong&quot;, true);&#10;        tags005.put(&quot;giamcan&quot;, true);&#10;        tags005.put(&quot;banron&quot;, true);&#10;        video005.setTags(tags005);&#10;        video005.setViewCount(4521L);&#10;        video005.setLikeCount(378L);&#10;        video005.setUserId(&quot;user004&quot;);&#10;        videos.put(&quot;video005&quot;, video005);&#10;&#10;        return videos;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/utils/FormatUtils.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/utils/FormatUtils.java" />
              <option name="updatedContent" value="package com.vhn.doan.utils;&#10;&#10;import android.content.Context;&#10;import com.vhn.doan.R;&#10;&#10;import java.text.NumberFormat;&#10;import java.util.Locale;&#10;&#10;public class FormatUtils {&#10;&#10;    /**&#10;     * Format số lượng (view count, like count) thành định dạng ngắn gọn&#10;     * Ví dụ: 1200 -&gt; 1.2K, 1500000 -&gt; 1.5M&#10;     */&#10;    public static String formatCount(int count) {&#10;        if (count &lt; 1000) {&#10;            return String.valueOf(count);&#10;        } else if (count &lt; 1000000) {&#10;            if (count % 1000 == 0) {&#10;                return (count / 1000) + &quot;K&quot;;&#10;            } else {&#10;                return String.format(Locale.getDefault(), &quot;%.1fK&quot;, count / 1000.0);&#10;            }&#10;        } else if (count &lt; 1000000000) {&#10;            if (count % 1000000 == 0) {&#10;                return (count / 1000000) + &quot;M&quot;;&#10;            } else {&#10;                return String.format(Locale.getDefault(), &quot;%.1fM&quot;, count / 1000000.0);&#10;            }&#10;        } else {&#10;            if (count % 1000000000 == 0) {&#10;                return (count / 1000000000) + &quot;B&quot;;&#10;            } else {&#10;                return String.format(Locale.getDefault(), &quot;%.1fB&quot;, count / 1000000000.0);&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Format thời gian upload thành chuỗi &quot;x ngày trước&quot;, &quot;x giờ trước&quot;, v.v&#10;     */&#10;    public static String formatTimeAgo(Context context, long timestamp) {&#10;        long currentTime = System.currentTimeMillis();&#10;        long timeDiff = currentTime - timestamp;&#10;&#10;        // Chuyển đổi thành giây&#10;        long seconds = timeDiff / 1000;&#10;        &#10;        if (seconds &lt; 60) {&#10;            return context.getString(R.string.just_now);&#10;        }&#10;&#10;        // Chuyển đổi thành phút&#10;        long minutes = seconds / 60;&#10;        if (minutes &lt; 60) {&#10;            return context.getString(R.string.minutes_ago, (int) minutes);&#10;        }&#10;&#10;        // Chuyển đổi thành giờ&#10;        long hours = minutes / 60;&#10;        if (hours &lt; 24) {&#10;            return context.getString(R.string.hours_ago, (int) hours);&#10;        }&#10;&#10;        // Chuyển đổi thành ngày&#10;        long days = hours / 24;&#10;        if (days &lt; 30) {&#10;            return context.getString(R.string.days_ago, (int) days);&#10;        }&#10;&#10;        // Nếu quá 30 ngày, hiển thị số tháng&#10;        long months = days / 30;&#10;        if (months &lt; 12) {&#10;            return months + &quot; tháng trước&quot;;&#10;        }&#10;&#10;        // Nếu quá 12 tháng, hiển thị số năm&#10;        long years = months / 12;&#10;        return years + &quot; năm trước&quot;;&#10;    }&#10;&#10;    /**&#10;     * Format thời lượng video từ milliseconds thành định dạng mm:ss hoặc hh:mm:ss&#10;     */&#10;    public static String formatVideoDuration(long durationMs) {&#10;        long seconds = durationMs / 1000;&#10;        long minutes = seconds / 60;&#10;        long hours = minutes / 60;&#10;&#10;        seconds = seconds % 60;&#10;        minutes = minutes % 60;&#10;&#10;        if (hours &gt; 0) {&#10;            return String.format(Locale.getDefault(), &quot;%02d:%02d:%02d&quot;, hours, minutes, seconds);&#10;        } else {&#10;            return String.format(Locale.getDefault(), &quot;%02d:%02d&quot;, minutes, seconds);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Format số với định dạng địa phương (có dấu phẩy phân cách)&#10;     */&#10;    public static String formatNumber(int number) {&#10;        NumberFormat numberFormat = NumberFormat.getNumberInstance(Locale.getDefault());&#10;        return numberFormat.format(number);&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra và trả về chuỗi an toàn (không null)&#10;     */&#10;    public static String getSafeString(String input) {&#10;        return input != null ? input : &quot;&quot;;&#10;    }&#10;&#10;    /**&#10;     * Cắt ngắn chuỗi nếu quá dài&#10;     */&#10;    public static String truncateString(String input, int maxLength) {&#10;        if (input == null) {&#10;            return &quot;&quot;;&#10;        }&#10;        &#10;        if (input.length() &lt;= maxLength) {&#10;            return input;&#10;        }&#10;        &#10;        return input.substring(0, maxLength - 3) + &quot;...&quot;;&#10;    }&#10;&#10;    /**&#10;     * Format file size thành định dạng dễ đọc&#10;     */&#10;    public static String formatFileSize(long bytes) {&#10;        if (bytes &lt; 1024) {&#10;            return bytes + &quot; B&quot;;&#10;        } else if (bytes &lt; 1024 * 1024) {&#10;            return String.format(Locale.getDefault(), &quot;%.1f KB&quot;, bytes / 1024.0);&#10;        } else if (bytes &lt; 1024 * 1024 * 1024) {&#10;            return String.format(Locale.getDefault(), &quot;%.1f MB&quot;, bytes / (1024.0 * 1024.0));&#10;        } else {&#10;            return String.format(Locale.getDefault(), &quot;%.1f GB&quot;, bytes / (1024.0 * 1024.0 * 1024.0));&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/utils/VideoRecommendationUtils.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/vhn/doan/utils/VideoRecommendationUtils.java" />
              <option name="updatedContent" value="package com.vhn.doan.utils;&#10;&#10;import com.vhn.doan.data.model.ShortVideoModel;&#10;import com.vhn.doan.data.model.UserTopicModel;&#10;&#10;import java.util.ArrayList;&#10;import java.util.Collections;&#10;import java.util.Comparator;&#10;import java.util.HashMap;&#10;import java.util.HashSet;&#10;import java.util.List;&#10;import java.util.Map;&#10;import java.util.Set;&#10;&#10;/**&#10; * Utility class để xử lý logic đề xuất video cho người dùng&#10; * Dựa trên sở thích (preferences), chủ đề quan tâm (topics) và các yếu tố khác&#10; */&#10;public class VideoRecommendationUtils {&#10;&#10;    /**&#10;     * Hàm chính để đề xuất video cho người dùng&#10;     * &#10;     * @param allVideos Danh sách tất cả video có sẵn&#10;     * @param preferences Map sở thích từ /users/{userId}/preferences (key: topic, value: preference score 0.0-1.0)&#10;     * @param topics Map chủ đề từ /user_topics/{userId} (key: topic name, value: interaction count)&#10;     * @param limit Số lượng video tối đa cần lấy&#10;     * @return Danh sách video được đề xuất, đã sắp xếp theo độ ưu tiên&#10;     */&#10;    public static List&lt;ShortVideoModel&gt; recommendVideos(&#10;            List&lt;ShortVideoModel&gt; allVideos,&#10;            Map&lt;String, Float&gt; preferences,&#10;            Map&lt;String, Long&gt; topics,&#10;            int limit) {&#10;        &#10;        if (allVideos == null || allVideos.isEmpty() || limit &lt;= 0) {&#10;            return new ArrayList&lt;&gt;();&#10;        }&#10;&#10;        // Chuẩn hóa input parameters&#10;        Map&lt;String, Float&gt; userPreferences = preferences != null ? preferences : new HashMap&lt;&gt;();&#10;        Map&lt;String, Long&gt; userTopics = topics != null ? topics : new HashMap&lt;&gt;();&#10;&#10;        // Tạo set các tag từ preferences và topics đã chuẩn hóa&#10;        Set&lt;String&gt; userInterestTags = getUserInterestTags(userPreferences, userTopics);&#10;&#10;        List&lt;ShortVideoModel&gt; result = new ArrayList&lt;&gt;();&#10;        List&lt;ShortVideoModel&gt; remainingVideos = new ArrayList&lt;&gt;(allVideos);&#10;&#10;        // B1: Ưu tiên video có tag trùng với tag trong preferences hoặc topics&#10;        List&lt;ShortVideoModel&gt; matchingVideos = getVideosWithMatchingTags(remainingVideos, userInterestTags);&#10;        &#10;        // Sắp xếp video có tag trùng theo điểm ưu tiên&#10;        matchingVideos = sortVideosByPriority(matchingVideos, userPreferences, userTopics);&#10;        &#10;        // Thêm video matching vào kết quả&#10;        int addedCount = Math.min(matchingVideos.size(), limit);&#10;        result.addAll(matchingVideos.subList(0, addedCount));&#10;        &#10;        // Loại bỏ các video đã thêm khỏi danh sách còn lại&#10;        remainingVideos.removeAll(result);&#10;&#10;        // B2: Nếu chưa đủ số lượng, ưu tiên video có viewCount hoặc likeCount cao&#10;        if (result.size() &lt; limit &amp;&amp; !remainingVideos.isEmpty()) {&#10;            List&lt;ShortVideoModel&gt; popularVideos = sortVideosByPopularity(remainingVideos);&#10;            int needMore = limit - result.size();&#10;            int addMore = Math.min(popularVideos.size(), needMore);&#10;            result.addAll(popularVideos.subList(0, addMore));&#10;            &#10;            // Cập nhật danh sách còn lại&#10;            remainingVideos.removeAll(result.subList(result.size() - addMore, result.size()));&#10;        }&#10;&#10;        // B3: Nếu không đủ số lượng, bổ sung thêm video cùng categoryId&#10;        if (result.size() &lt; limit &amp;&amp; !remainingVideos.isEmpty()) {&#10;            List&lt;ShortVideoModel&gt; sameCategoryVideos = getVideosBySameCategory(remainingVideos, result);&#10;            sameCategoryVideos = sortVideosByPopularity(sameCategoryVideos);&#10;            &#10;            int needMore = limit - result.size();&#10;            int addMore = Math.min(sameCategoryVideos.size(), needMore);&#10;            result.addAll(sameCategoryVideos.subList(0, addMore));&#10;            &#10;            // Cập nhật danh sách còn lại&#10;            remainingVideos.removeAll(result.subList(result.size() - addMore, result.size()));&#10;        }&#10;&#10;        // B4: Nếu không có sở thích hoặc vẫn chưa đủ, trả về video trending&#10;        if (result.size() &lt; limit &amp;&amp; !remainingVideos.isEmpty()) {&#10;            List&lt;ShortVideoModel&gt; trendingVideos = getTrendingVideos(remainingVideos);&#10;            &#10;            int needMore = limit - result.size();&#10;            int addMore = Math.min(trendingVideos.size(), needMore);&#10;            result.addAll(trendingVideos.subList(0, addMore));&#10;        }&#10;&#10;        return result;&#10;    }&#10;&#10;    /**&#10;     * Tạo set các tag quan tâm từ preferences và topics&#10;     */&#10;    private static Set&lt;String&gt; getUserInterestTags(Map&lt;String, Float&gt; preferences, Map&lt;String, Long&gt; topics) {&#10;        Set&lt;String&gt; tags = new HashSet&lt;&gt;();&#10;        &#10;        // Thêm tags từ preferences (chỉ lấy những tag có điểm &gt; 0.3)&#10;        for (Map.Entry&lt;String, Float&gt; entry : preferences.entrySet()) {&#10;            if (entry.getValue() != null &amp;&amp; entry.getValue() &gt; 0.3f) {&#10;                String normalizedTag = UserTopicModel.normalizeTopicToTag(entry.getKey());&#10;                if (!normalizedTag.isEmpty()) {&#10;                    tags.add(normalizedTag);&#10;                }&#10;            }&#10;        }&#10;        &#10;        // Thêm tags từ topics (chỉ lấy những topic có tương tác &gt;= 3 lần)&#10;        for (Map.Entry&lt;String, Long&gt; entry : topics.entrySet()) {&#10;            if (entry.getValue() != null &amp;&amp; entry.getValue() &gt;= 3L) {&#10;                String normalizedTag = UserTopicModel.normalizeTopicToTag(entry.getKey());&#10;                if (!normalizedTag.isEmpty()) {&#10;                    tags.add(normalizedTag);&#10;                }&#10;            }&#10;        }&#10;        &#10;        return tags;&#10;    }&#10;&#10;    /**&#10;     * Lấy danh sách video có tag trùng với sở thích người dùng&#10;     */&#10;    private static List&lt;ShortVideoModel&gt; getVideosWithMatchingTags(&#10;            List&lt;ShortVideoModel&gt; videos, Set&lt;String&gt; userTags) {&#10;        &#10;        List&lt;ShortVideoModel&gt; matchingVideos = new ArrayList&lt;&gt;();&#10;        &#10;        for (ShortVideoModel video : videos) {&#10;            if (video.getTags() != null &amp;&amp; hasMatchingTag(video.getTags(), userTags)) {&#10;                matchingVideos.add(video);&#10;            }&#10;        }&#10;        &#10;        return matchingVideos;&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra xem video có tag trùng với sở thích người dùng không&#10;     */&#10;    private static boolean hasMatchingTag(Map&lt;String, Boolean&gt; videoTags, Set&lt;String&gt; userTags) {&#10;        for (Map.Entry&lt;String, Boolean&gt; entry : videoTags.entrySet()) {&#10;            if (Boolean.TRUE.equals(entry.getValue())) {&#10;                String normalizedTag = UserTopicModel.normalizeTopicToTag(entry.getKey());&#10;                if (userTags.contains(normalizedTag)) {&#10;                    return true;&#10;                }&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;&#10;    /**&#10;     * Sắp xếp video theo độ ưu tiên dựa trên preferences và topics&#10;     */&#10;    private static List&lt;ShortVideoModel&gt; sortVideosByPriority(&#10;            List&lt;ShortVideoModel&gt; videos,&#10;            Map&lt;String, Float&gt; preferences,&#10;            Map&lt;String, Long&gt; topics) {&#10;        &#10;        List&lt;ShortVideoModel&gt; sortedVideos = new ArrayList&lt;&gt;(videos);&#10;        &#10;        Collections.sort(sortedVideos, new Comparator&lt;ShortVideoModel&gt;() {&#10;            @Override&#10;            public int compare(ShortVideoModel v1, ShortVideoModel v2) {&#10;                // Tính điểm ưu tiên cho từng video&#10;                double score1 = calculatePriorityScore(v1, preferences, topics);&#10;                double score2 = calculatePriorityScore(v2, preferences, topics);&#10;                &#10;                // Sắp xếp giảm dần theo điểm&#10;                return Double.compare(score2, score1);&#10;            }&#10;        });&#10;        &#10;        return sortedVideos;&#10;    }&#10;&#10;    /**&#10;     * Tính điểm ưu tiên cho video dựa trên preferences và topics&#10;     */&#10;    private static double calculatePriorityScore(&#10;            ShortVideoModel video,&#10;            Map&lt;String, Float&gt; preferences,&#10;            Map&lt;String, Long&gt; topics) {&#10;        &#10;        double score = 0.0;&#10;        &#10;        if (video.getTags() != null) {&#10;            for (Map.Entry&lt;String, Boolean&gt; tagEntry : video.getTags().entrySet()) {&#10;                if (Boolean.TRUE.equals(tagEntry.getValue())) {&#10;                    String tag = tagEntry.getKey();&#10;                    String normalizedTag = UserTopicModel.normalizeTopicToTag(tag);&#10;                    &#10;                    // Điểm từ preferences (trọng số 0.7)&#10;                    Float prefScore = preferences.get(tag);&#10;                    if (prefScore != null) {&#10;                        score += prefScore * 0.7;&#10;                    }&#10;                    &#10;                    // Điểm từ topics (trọng số 0.3, chuẩn hóa theo log)&#10;                    for (Map.Entry&lt;String, Long&gt; topicEntry : topics.entrySet()) {&#10;                        String topicNormalized = UserTopicModel.normalizeTopicToTag(topicEntry.getKey());&#10;                        if (normalizedTag.equals(topicNormalized)) {&#10;                            Long count = topicEntry.getValue();&#10;                            if (count != null &amp;&amp; count &gt; 0) {&#10;                                // Sử dụng log để giảm ảnh hưởng của số lần tương tác quá lớn&#10;                                double topicScore = Math.log(count + 1) / Math.log(100); // Chuẩn hóa về 0-1&#10;                                score += Math.min(topicScore, 1.0) * 0.3;&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;        &#10;        // Thêm điểm bonus nhỏ cho video có popularity cao&#10;        long viewCount = video.getViewCount() != null ? video.getViewCount() : 0L;&#10;        long likeCount = video.getLikeCount() != null ? video.getLikeCount() : 0L;&#10;        double popularityBonus = Math.log(viewCount + likeCount + 1) / Math.log(10000); // Bonus nhỏ&#10;        score += Math.min(popularityBonus, 0.2); // Tối đa 0.2 điểm bonus&#10;        &#10;        return score;&#10;    }&#10;&#10;    /**&#10;     * Sắp xếp video theo độ phổ biến (viewCount + likeCount)&#10;     */&#10;    private static List&lt;ShortVideoModel&gt; sortVideosByPopularity(List&lt;ShortVideoModel&gt; videos) {&#10;        List&lt;ShortVideoModel&gt; sortedVideos = new ArrayList&lt;&gt;(videos);&#10;        &#10;        Collections.sort(sortedVideos, new Comparator&lt;ShortVideoModel&gt;() {&#10;            @Override&#10;            public int compare(ShortVideoModel v1, ShortVideoModel v2) {&#10;                long popularity1 = getVideoPopularity(v1);&#10;                long popularity2 = getVideoPopularity(v2);&#10;                return Long.compare(popularity2, popularity1); // Sắp xếp giảm dần&#10;            }&#10;        });&#10;        &#10;        return sortedVideos;&#10;    }&#10;&#10;    /**&#10;     * Tính độ phổ biến của video&#10;     */&#10;    private static long getVideoPopularity(ShortVideoModel video) {&#10;        long viewCount = video.getViewCount() != null ? video.getViewCount() : 0L;&#10;        long likeCount = video.getLikeCount() != null ? video.getLikeCount() : 0L;&#10;        &#10;        // Trọng số: view = 1, like = 3 (like quan trọng hơn view)&#10;        return viewCount + (likeCount * 3);&#10;    }&#10;&#10;    /**&#10;     * Lấy video cùng category với các video đã được chọn&#10;     */&#10;    private static List&lt;ShortVideoModel&gt; getVideosBySameCategory(&#10;            List&lt;ShortVideoModel&gt; remainingVideos,&#10;            List&lt;ShortVideoModel&gt; selectedVideos) {&#10;        &#10;        // Lấy tất cả categoryId từ video đã chọn&#10;        Set&lt;String&gt; selectedCategories = new HashSet&lt;&gt;();&#10;        for (ShortVideoModel video : selectedVideos) {&#10;            if (video.getCategoryId() != null) {&#10;                selectedCategories.add(video.getCategoryId());&#10;            }&#10;        }&#10;        &#10;        // Lọc video có cùng category&#10;        List&lt;ShortVideoModel&gt; sameCategoryVideos = new ArrayList&lt;&gt;();&#10;        for (ShortVideoModel video : remainingVideos) {&#10;            if (video.getCategoryId() != null &amp;&amp; selectedCategories.contains(video.getCategoryId())) {&#10;                sameCategoryVideos.add(video);&#10;            }&#10;        }&#10;        &#10;        return sameCategoryVideos;&#10;    }&#10;&#10;    /**&#10;     * Lấy video trending (mock data - có thể thay thế bằng logic thực từ Firebase)&#10;     */&#10;    private static List&lt;ShortVideoModel&gt; getTrendingVideos(List&lt;ShortVideoModel&gt; videos) {&#10;        // Hiện tại sử dụng logic đơn giản: video có (viewCount + likeCount * 2) cao nhất&#10;        List&lt;ShortVideoModel&gt; trendingVideos = new ArrayList&lt;&gt;(videos);&#10;        &#10;        Collections.sort(trendingVideos, new Comparator&lt;ShortVideoModel&gt;() {&#10;            @Override&#10;            public int compare(ShortVideoModel v1, ShortVideoModel v2) {&#10;                long trend1 = getTrendingScore(v1);&#10;                long trend2 = getTrendingScore(v2);&#10;                return Long.compare(trend2, trend1); // Sắp xếp giảm dần&#10;            }&#10;        });&#10;        &#10;        return trendingVideos;&#10;    }&#10;&#10;    /**&#10;     * Tính điểm trending cho video&#10;     */&#10;    private static long getTrendingScore(ShortVideoModel video) {&#10;        long viewCount = video.getViewCount() != null ? video.getViewCount() : 0L;&#10;        long likeCount = video.getLikeCount() != null ? video.getLikeCount() : 0L;&#10;        Long uploadDate = video.getUploadDate();&#10;        &#10;        // Điểm cơ bản&#10;        long baseScore = viewCount + (likeCount * 2);&#10;        &#10;        // Bonus cho video mới (trong vòng 7 ngày gần đây)&#10;        if (uploadDate != null) {&#10;            long currentTime = System.currentTimeMillis();&#10;            long daysSinceUpload = (currentTime - uploadDate) / (1000 * 60 * 60 * 24);&#10;            &#10;            if (daysSinceUpload &lt;= 7) {&#10;                // Video mới được bonus&#10;                double recencyBonus = (7 - daysSinceUpload) / 7.0; // Từ 0 đến 1&#10;                baseScore += (long) (baseScore * recencyBonus * 0.3); // Tối đa 30% bonus&#10;            }&#10;        }&#10;        &#10;        return baseScore;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_circle_red.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_circle_red.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:shape=&quot;oval&quot;&gt;&#10;    &lt;solid android:color=&quot;@color/red_like&quot; /&gt;&#10;&lt;/shape&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_circle_white.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_circle_white.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:shape=&quot;oval&quot;&gt;&#10;    &lt;solid android:color=&quot;@color/white&quot; /&gt;&#10;    &lt;stroke android:width=&quot;2dp&quot; android:color=&quot;@color/white&quot; /&gt;&#10;&lt;/shape&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_duration.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_duration.xml" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_follow_button.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_follow_button.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:shape=&quot;rectangle&quot;&gt;&#10;    &lt;corners android:radius=&quot;4dp&quot; /&gt;&#10;    &lt;stroke android:width=&quot;1dp&quot; android:color=&quot;@color/white&quot; /&gt;&#10;    &lt;solid android:color=&quot;@color/black_overlay&quot; /&gt;&#10;&lt;/shape&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_gradient_bottom.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_gradient_bottom.xml" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_gradient_bottom_overlay.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_gradient_bottom_overlay.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:shape=&quot;rectangle&quot;&gt;&#10;    &lt;gradient&#10;        android:angle=&quot;90&quot;&#10;        android:startColor=&quot;@android:color/transparent&quot;&#10;        android:centerColor=&quot;@color/semi_transparent_black&quot;&#10;        android:endColor=&quot;@color/semi_transparent_dark&quot;&#10;        android:type=&quot;linear&quot; /&gt;&#10;    &lt;corners android:radius=&quot;0dp&quot; /&gt;&#10;&lt;/shape&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_gradient_top.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_gradient_top.xml" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_play_button.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_play_button.xml" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_rounded_dark_semi_transparent.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_rounded_dark_semi_transparent.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:shape=&quot;rectangle&quot;&gt;&#10;    &lt;solid android:color=&quot;@color/semi_transparent_black&quot; /&gt;&#10;    &lt;corners android:radius=&quot;8dp&quot; /&gt;&#10;&lt;/shape&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_video_thumbnail.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_video_thumbnail.xml" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/circle_background_semi_transparent.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/circle_background_semi_transparent.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:shape=&quot;oval&quot;&gt;&#10;    &lt;solid android:color=&quot;#80000000&quot; /&gt;&#10;&lt;/shape&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/ic_error_outline.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/ic_error_outline.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&#10;    android:tint=&quot;?attr/colorOnSurface&quot;&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;@android:color/white&quot;&#10;        android:pathData=&quot;M12,2C13.1,2 14,2.9 14,4C14,5.1 13.1,6 12,6C10.9,6 10,5.1 10,4C10,2.9 10.9,2 12,2ZM21,9V7L15,7V9C15,10.65 13.65,12 12,12C10.35,12 9,10.65 9,9V7L3,7V9C3,11.76 5.24,14 8,14V16H16V14C18.76,14 21,11.76 21,9ZM12,17.5C11.2,17.5 10.5,18.2 10.5,19C10.5,19.8 11.2,20.5 12,20.5C12.8,20.5 13.5,19.8 13.5,19C13.5,18.2 12.8,17.5 12,17.5Z&quot;/&gt;&#10;&lt;/vector&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/ic_upload.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/ic_upload.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;@android:color/white&quot;&#10;        android:pathData=&quot;M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z&quot;/&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;@android:color/white&quot;&#10;        android:pathData=&quot;M12,19L8,15H10.5V12H13.5V15H16L12,19Z&quot;/&gt;&#10;&lt;/vector&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/activity_video_player.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/activity_video_player.xml" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/custom_player_control.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/custom_player_control.xml" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/fragment_home.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/fragment_home.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#10;    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;match_parent&quot;&#10;    android:background=&quot;@color/backgroundSecondary&quot;&gt;&#10;&#10;    &lt;!-- =============================================== --&gt;&#10;    &lt;!-- MODERN COMPACT HEADER - Thanh tiêu đề nhỏ gọn --&gt;&#10;    &lt;!-- =============================================== --&gt;&#10;    &lt;com.google.android.material.appbar.AppBarLayout&#10;        android:id=&quot;@+id/app_bar_layout&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:elevation=&quot;0dp&quot;&#10;        android:background=&quot;@color/backgroundColor&quot;&#10;        android:fitsSystemWindows=&quot;true&quot;&gt;&#10;&#10;        &lt;androidx.constraintlayout.widget.ConstraintLayout&#10;            android:id=&quot;@+id/layoutHeader&quot;&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;56dp&quot;&#10;            android:paddingStart=&quot;16dp&quot;&#10;            android:paddingEnd=&quot;16dp&quot;&#10;            android:paddingTop=&quot;8dp&quot;&#10;            android:paddingBottom=&quot;8dp&quot;&gt;&#10;&#10;            &lt;!-- Logo HealthFlow --&gt;&#10;            &lt;TextView&#10;                android:id=&quot;@+id/textViewAppLogo&quot;&#10;                android:layout_width=&quot;0dp&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:text=&quot;HealthTips&quot;&#10;                android:textColor=&quot;@color/primary_button_start&quot;&#10;                android:textSize=&quot;20sp&quot;&#10;                android:textStyle=&quot;bold&quot;&#10;                android:fontFamily=&quot;sans-serif-medium&quot;&#10;                android:ellipsize=&quot;end&quot;&#10;                android:maxLines=&quot;1&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toStartOf=&quot;@id/buttonSearch&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot;&#10;                app:layout_constraintHorizontal_bias=&quot;0&quot;&#10;                app:layout_constraintHorizontal_chainStyle=&quot;spread_inside&quot; /&gt;&#10;&#10;            &lt;!-- Icon Tìm kiếm --&gt;&#10;            &lt;androidx.appcompat.widget.AppCompatImageButton&#10;                android:id=&quot;@+id/buttonSearch&quot;&#10;                android:layout_width=&quot;40dp&quot;&#10;                android:layout_height=&quot;40dp&quot;&#10;                android:layout_marginStart=&quot;8dp&quot;&#10;                android:background=&quot;?attr/selectableItemBackgroundBorderless&quot;&#10;                android:contentDescription=&quot;@string/search&quot;&#10;                android:src=&quot;@drawable/icon_search&quot;&#10;                android:padding=&quot;8dp&quot;&#10;                app:tint=&quot;@color/text_primary&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toStartOf=&quot;@id/notificationContainer&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;&#10;&#10;            &lt;!-- Icon Thông báo (Chuông) với Badge --&gt;&#10;            &lt;FrameLayout&#10;                android:id=&quot;@+id/notificationContainer&quot;&#10;                android:layout_width=&quot;40dp&quot;&#10;                android:layout_height=&quot;40dp&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;androidx.appcompat.widget.AppCompatImageButton&#10;                    android:id=&quot;@+id/buttonNotification&quot;&#10;                    android:layout_width=&quot;match_parent&quot;&#10;                    android:layout_height=&quot;match_parent&quot;&#10;                    android:background=&quot;?attr/selectableItemBackgroundBorderless&quot;&#10;                    android:contentDescription=&quot;Thông báo&quot;&#10;                    android:src=&quot;@drawable/notification&quot;&#10;                    android:padding=&quot;6dp&quot;&#10;                    app:tint=&quot;@color/text_primary&quot;&#10;                    android:scaleType=&quot;fitCenter&quot; /&gt;&#10;&#10;                &lt;!-- Badge hiển thị số lượng thông báo chưa đọc --&gt;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/badgeNotificationCount&quot;&#10;                    android:layout_width=&quot;16dp&quot;&#10;                    android:layout_height=&quot;16dp&quot;&#10;                    android:layout_gravity=&quot;top|end&quot;&#10;                    android:layout_marginTop=&quot;4dp&quot;&#10;                    android:layout_marginEnd=&quot;4dp&quot;&#10;                    android:background=&quot;@drawable/bg_notification_badge&quot;&#10;                    android:gravity=&quot;center&quot;&#10;                    android:text=&quot;0&quot;&#10;                    android:textColor=&quot;@android:color/white&quot;&#10;                    android:textSize=&quot;9sp&quot;&#10;                    android:textStyle=&quot;bold&quot;&#10;                    android:visibility=&quot;gone&quot;&#10;                    tools:visibility=&quot;visible&quot;&#10;                    tools:text=&quot;9&quot; /&gt;&#10;&#10;            &lt;/FrameLayout&gt;&#10;&#10;        &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;&#10;&#10;    &lt;/com.google.android.material.appbar.AppBarLayout&gt;&#10;&#10;    &lt;!-- =============================================== --&gt;&#10;    &lt;!-- MAIN SCROLLABLE CONTENT --&gt;&#10;    &lt;!-- =============================================== --&gt;&#10;    &lt;androidx.core.widget.NestedScrollView&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;match_parent&quot;&#10;        android:fillViewport=&quot;true&quot;&#10;        app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;&gt;&#10;&#10;        &lt;androidx.constraintlayout.widget.ConstraintLayout&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:paddingBottom=&quot;16dp&quot;&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- THANH TÌM KIẾM PILL-SHAPED --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/searchBarCard&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;48dp&quot;&#10;                android:layout_marginStart=&quot;16dp&quot;&#10;                android:layout_marginEnd=&quot;16dp&quot;&#10;                android:layout_marginTop=&quot;16dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:gravity=&quot;center_vertical&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                android:clickable=&quot;true&quot;&#10;                android:focusable=&quot;true&quot;&#10;                android:background=&quot;@drawable/bg_search_input&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;ImageView&#10;                    android:layout_width=&quot;20dp&quot;&#10;                    android:layout_height=&quot;20dp&quot;&#10;                    android:src=&quot;@android:drawable/ic_menu_search&quot;&#10;                    app:tint=&quot;@color/text_hint&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:layout_marginStart=&quot;12dp&quot;&#10;                    android:text=&quot;Tìm kiếm mẹo, bệnh, hay công thức...&quot;&#10;                    android:textColor=&quot;@color/text_hint&quot;&#10;                    android:textSize=&quot;14sp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- PHẦN CHÀO MỪNG - Thay đổi theo thời gian --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;TextView&#10;                android:id=&quot;@+id/textViewGreeting&quot;&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginStart=&quot;16dp&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:text=&quot;Chào buổi sáng, Bạn!&quot;&#10;                android:textColor=&quot;@color/text_primary&quot;&#10;                android:textSize=&quot;24sp&quot;&#10;                android:textStyle=&quot;bold&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/searchBarCard&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- FEATURED TIPS - Danh sách cuộn ngang liên tục --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewFeaturedTips&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;220dp&quot;&#10;                android:layout_marginTop=&quot;16dp&quot;&#10;                android:clipToPadding=&quot;false&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;8dp&quot;&#10;                android:paddingEnd=&quot;8dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/textViewGreeting&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;3&quot;&#10;                tools:listitem=&quot;@layout/item_featured_tip&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- DANH MỤC (CATEGORIES) - Horizontal Scroll --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutCategoriesHeader&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/recyclerViewFeaturedTips&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:text=&quot;@string/categories&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot;&#10;                    android:textSize=&quot;18sp&quot;&#10;                    android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/textViewSeeAllCategories&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;@string/see_all&quot;&#10;                    android:textColor=&quot;@color/primary_button_end&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:clickable=&quot;true&quot;&#10;                    android:focusable=&quot;true&quot;&#10;                    android:background=&quot;?attr/selectableItemBackground&quot;&#10;                    android:padding=&quot;4dp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewCategories&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;8dp&quot;&#10;                android:clipToPadding=&quot;false&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;8dp&quot;&#10;                android:paddingEnd=&quot;8dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/layoutCategoriesHeader&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;5&quot;&#10;                tools:listitem=&quot;@layout/item_category&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- MẸO MỚI NHẤT (LATEST TIPS) - Vertical List --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutLatestTipsHeader&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/recyclerViewCategories&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:text=&quot;@string/latest_tips&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot;&#10;                    android:textSize=&quot;18sp&quot;&#10;                    android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/textViewSeeAllLatestTips&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;@string/see_all&quot;&#10;                    android:textColor=&quot;@color/primary_button_end&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:clickable=&quot;true&quot;&#10;                    android:focusable=&quot;true&quot;&#10;                    android:background=&quot;?attr/selectableItemBackground&quot;&#10;                    android:padding=&quot;4dp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewLatestTips&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;8dp&quot;&#10;                android:nestedScrollingEnabled=&quot;false&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/layoutLatestTipsHeader&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;3&quot;&#10;                tools:listitem=&quot;@layout/item_health_tip&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- XEM NHIỀU NHẤT (MOST VIEWED TIPS) --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutMostViewedHeader&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/recyclerViewLatestTips&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:text=&quot;@string/most_viewed&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot;&#10;                    android:textSize=&quot;18sp&quot;&#10;                    android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/textViewSeeAllMostViewed&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;@string/see_all&quot;&#10;                    android:textColor=&quot;@color/primary_button_end&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:clickable=&quot;true&quot;&#10;                    android:focusable=&quot;true&quot;&#10;                    android:background=&quot;?attr/selectableItemBackground&quot;&#10;                    android:padding=&quot;4dp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewMostViewedTips&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;8dp&quot;&#10;                android:clipToPadding=&quot;false&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;8dp&quot;&#10;                android:paddingEnd=&quot;8dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/layoutMostViewedHeader&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;5&quot;&#10;                tools:listitem=&quot;@layout/item_health_tip&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- YÊU THÍCH NHẤT (MOST LIKED TIPS) --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutMostLikedHeader&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/recyclerViewMostViewedTips&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:text=&quot;@string/most_liked&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot;&#10;                    android:textSize=&quot;18sp&quot;&#10;                    android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/textViewSeeAllMostLiked&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;@string/see_all&quot;&#10;                    android:textColor=&quot;@color/primary_button_end&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:clickable=&quot;true&quot;&#10;                    android:focusable=&quot;true&quot;&#10;                    android:background=&quot;?attr/selectableItemBackground&quot;&#10;                    android:padding=&quot;4dp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewMostLikedTips&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;8dp&quot;&#10;                android:clipToPadding=&quot;false&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;8dp&quot;&#10;                android:paddingEnd=&quot;8dp&quot;&#10;                android:paddingBottom=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/layoutMostLikedHeader&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;5&quot;&#10;                tools:listitem=&quot;@layout/item_health_tip&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- PROGRESS BAR --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;ProgressBar&#10;                android:id=&quot;@+id/progressBar&quot;&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:indeterminateTint=&quot;@color/primary_button_start&quot;&#10;                android:visibility=&quot;gone&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- OFFLINE MODE INDICATOR --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutOfflineMode&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:background=&quot;#AA000000&quot;&#10;                android:gravity=&quot;center&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:padding=&quot;8dp&quot;&#10;                android:visibility=&quot;gone&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;ImageView&#10;                    android:layout_width=&quot;24dp&quot;&#10;                    android:layout_height=&quot;24dp&quot;&#10;                    android:src=&quot;@android:drawable/ic_dialog_alert&quot;&#10;                    app:tint=&quot;@color/text_primary&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_marginStart=&quot;8dp&quot;&#10;                    android:text=&quot;@string/offline_mode&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;        &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;&#10;&#10;    &lt;/androidx.core.widget.NestedScrollView&gt;&#10;&#10;&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#10;    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;match_parent&quot;&#10;    android:background=&quot;@color/backgroundSecondary&quot;&gt;&#10;&#10;    &lt;!-- =============================================== --&gt;&#10;    &lt;!-- MODERN COMPACT HEADER - Thanh tiêu đề nhỏ gọn --&gt;&#10;    &lt;!-- =============================================== --&gt;&#10;    &lt;com.google.android.material.appbar.AppBarLayout&#10;        android:id=&quot;@+id/app_bar_layout&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:elevation=&quot;0dp&quot;&#10;        android:background=&quot;@color/backgroundColor&quot;&#10;        android:fitsSystemWindows=&quot;true&quot;&gt;&#10;&#10;        &lt;androidx.constraintlayout.widget.ConstraintLayout&#10;            android:id=&quot;@+id/layoutHeader&quot;&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;56dp&quot;&#10;            android:paddingStart=&quot;16dp&quot;&#10;            android:paddingEnd=&quot;16dp&quot;&#10;            android:paddingTop=&quot;8dp&quot;&#10;            android:paddingBottom=&quot;8dp&quot;&gt;&#10;&#10;            &lt;!-- Logo HealthFlow --&gt;&#10;            &lt;TextView&#10;                android:id=&quot;@+id/textViewAppLogo&quot;&#10;                android:layout_width=&quot;0dp&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:text=&quot;HealthTips&quot;&#10;                android:textColor=&quot;@color/primary_button_start&quot;&#10;                android:textSize=&quot;20sp&quot;&#10;                android:textStyle=&quot;bold&quot;&#10;                android:fontFamily=&quot;sans-serif-medium&quot;&#10;                android:ellipsize=&quot;end&quot;&#10;                android:maxLines=&quot;1&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toStartOf=&quot;@id/buttonSearch&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot;&#10;                app:layout_constraintHorizontal_bias=&quot;0&quot;&#10;                app:layout_constraintHorizontal_chainStyle=&quot;spread_inside&quot; /&gt;&#10;&#10;            &lt;!-- Icon Tìm kiếm --&gt;&#10;            &lt;androidx.appcompat.widget.AppCompatImageButton&#10;                android:id=&quot;@+id/buttonSearch&quot;&#10;                android:layout_width=&quot;40dp&quot;&#10;                android:layout_height=&quot;40dp&quot;&#10;                android:layout_marginStart=&quot;8dp&quot;&#10;                android:background=&quot;?attr/selectableItemBackgroundBorderless&quot;&#10;                android:contentDescription=&quot;@string/search&quot;&#10;                android:src=&quot;@drawable/icon_search&quot;&#10;                android:padding=&quot;8dp&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toStartOf=&quot;@id/notificationContainer&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;&#10;&#10;            &lt;!-- Icon Thông báo (Chuông) với Badge --&gt;&#10;            &lt;FrameLayout&#10;                android:id=&quot;@+id/notificationContainer&quot;&#10;                android:layout_width=&quot;40dp&quot;&#10;                android:layout_height=&quot;40dp&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;androidx.appcompat.widget.AppCompatImageButton&#10;                    android:id=&quot;@+id/buttonNotification&quot;&#10;                    android:layout_width=&quot;match_parent&quot;&#10;                    android:layout_height=&quot;match_parent&quot;&#10;                    android:background=&quot;?attr/selectableItemBackgroundBorderless&quot;&#10;                    android:contentDescription=&quot;Thông báo&quot;&#10;                    android:src=&quot;@drawable/notification&quot;&#10;                    android:padding=&quot;6dp&quot;&#10;                    app:tint=&quot;@color/text_primary&quot;&#10;                    android:scaleType=&quot;fitCenter&quot; /&gt;&#10;&#10;                &lt;!-- Badge hiển thị số lượng thông báo chưa đọc --&gt;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/badgeNotificationCount&quot;&#10;                    android:layout_width=&quot;16dp&quot;&#10;                    android:layout_height=&quot;16dp&quot;&#10;                    android:layout_gravity=&quot;top|end&quot;&#10;                    android:layout_marginTop=&quot;4dp&quot;&#10;                    android:layout_marginEnd=&quot;4dp&quot;&#10;                    android:background=&quot;@drawable/bg_notification_badge&quot;&#10;                    android:gravity=&quot;center&quot;&#10;                    android:text=&quot;0&quot;&#10;                    android:textColor=&quot;@android:color/white&quot;&#10;                    android:textSize=&quot;9sp&quot;&#10;                    android:textStyle=&quot;bold&quot;&#10;                    android:visibility=&quot;gone&quot;&#10;                    tools:visibility=&quot;visible&quot;&#10;                    tools:text=&quot;9&quot; /&gt;&#10;&#10;            &lt;/FrameLayout&gt;&#10;&#10;        &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;&#10;&#10;    &lt;/com.google.android.material.appbar.AppBarLayout&gt;&#10;&#10;    &lt;!-- =============================================== --&gt;&#10;    &lt;!-- MAIN SCROLLABLE CONTENT --&gt;&#10;    &lt;!-- =============================================== --&gt;&#10;    &lt;androidx.core.widget.NestedScrollView&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;match_parent&quot;&#10;        android:fillViewport=&quot;true&quot;&#10;        app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;&gt;&#10;&#10;        &lt;androidx.constraintlayout.widget.ConstraintLayout&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:paddingBottom=&quot;16dp&quot;&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- THANH TÌM KIẾM PILL-SHAPED --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/searchBarCard&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;48dp&quot;&#10;                android:layout_marginStart=&quot;16dp&quot;&#10;                android:layout_marginEnd=&quot;16dp&quot;&#10;                android:layout_marginTop=&quot;16dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:gravity=&quot;center_vertical&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                android:clickable=&quot;true&quot;&#10;                android:focusable=&quot;true&quot;&#10;                android:background=&quot;@drawable/bg_search_input&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;ImageView&#10;                    android:layout_width=&quot;20dp&quot;&#10;                    android:layout_height=&quot;20dp&quot;&#10;                    android:src=&quot;@android:drawable/ic_menu_search&quot;&#10;                    app:tint=&quot;@color/text_hint&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:layout_marginStart=&quot;12dp&quot;&#10;                    android:text=&quot;Tìm kiếm mẹo, bệnh, hay công thức...&quot;&#10;                    android:textColor=&quot;@color/text_hint&quot;&#10;                    android:textSize=&quot;14sp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- PHẦN CHÀO MỪNG - Thay đổi theo thời gian --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;TextView&#10;                android:id=&quot;@+id/textViewGreeting&quot;&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginStart=&quot;16dp&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:text=&quot;Chào buổi sáng, Bạn!&quot;&#10;                android:textColor=&quot;@color/text_primary&quot;&#10;                android:textSize=&quot;24sp&quot;&#10;                android:textStyle=&quot;bold&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/searchBarCard&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- FEATURED TIPS - Danh sách cuộn ngang liên tục --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewFeaturedTips&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;220dp&quot;&#10;                android:layout_marginTop=&quot;16dp&quot;&#10;                android:clipToPadding=&quot;false&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;8dp&quot;&#10;                android:paddingEnd=&quot;8dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/textViewGreeting&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;3&quot;&#10;                tools:listitem=&quot;@layout/item_featured_tip&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- DANH MỤC (CATEGORIES) - Horizontal Scroll --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutCategoriesHeader&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/recyclerViewFeaturedTips&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:text=&quot;@string/categories&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot;&#10;                    android:textSize=&quot;18sp&quot;&#10;                    android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/textViewSeeAllCategories&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;@string/see_all&quot;&#10;                    android:textColor=&quot;@color/primary_button_end&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:clickable=&quot;true&quot;&#10;                    android:focusable=&quot;true&quot;&#10;                    android:background=&quot;?attr/selectableItemBackground&quot;&#10;                    android:padding=&quot;4dp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewCategories&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;8dp&quot;&#10;                android:clipToPadding=&quot;false&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;8dp&quot;&#10;                android:paddingEnd=&quot;8dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/layoutCategoriesHeader&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;5&quot;&#10;                tools:listitem=&quot;@layout/item_category&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- MẸO MỚI NHẤT (LATEST TIPS) - Vertical List --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutLatestTipsHeader&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/recyclerViewCategories&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:text=&quot;@string/latest_tips&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot;&#10;                    android:textSize=&quot;18sp&quot;&#10;                    android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/textViewSeeAllLatestTips&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;@string/see_all&quot;&#10;                    android:textColor=&quot;@color/primary_button_end&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:clickable=&quot;true&quot;&#10;                    android:focusable=&quot;true&quot;&#10;                    android:background=&quot;?attr/selectableItemBackground&quot;&#10;                    android:padding=&quot;4dp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewLatestTips&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;8dp&quot;&#10;                android:nestedScrollingEnabled=&quot;false&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/layoutLatestTipsHeader&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;3&quot;&#10;                tools:listitem=&quot;@layout/item_health_tip&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- XEM NHIỀU NHẤT (MOST VIEWED TIPS) --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutMostViewedHeader&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/recyclerViewLatestTips&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:text=&quot;@string/most_viewed&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot;&#10;                    android:textSize=&quot;18sp&quot;&#10;                    android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/textViewSeeAllMostViewed&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;@string/see_all&quot;&#10;                    android:textColor=&quot;@color/primary_button_end&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:clickable=&quot;true&quot;&#10;                    android:focusable=&quot;true&quot;&#10;                    android:background=&quot;?attr/selectableItemBackground&quot;&#10;                    android:padding=&quot;4dp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewMostViewedTips&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;8dp&quot;&#10;                android:clipToPadding=&quot;false&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;8dp&quot;&#10;                android:paddingEnd=&quot;8dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/layoutMostViewedHeader&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;5&quot;&#10;                tools:listitem=&quot;@layout/item_health_tip&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- YÊU THÍCH NHẤT (MOST LIKED TIPS) --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutMostLikedHeader&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;24dp&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;16dp&quot;&#10;                android:paddingEnd=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/recyclerViewMostViewedTips&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;0dp&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_weight=&quot;1&quot;&#10;                    android:text=&quot;@string/most_liked&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot;&#10;                    android:textSize=&quot;18sp&quot;&#10;                    android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/textViewSeeAllMostLiked&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;@string/see_all&quot;&#10;                    android:textColor=&quot;@color/primary_button_end&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:clickable=&quot;true&quot;&#10;                    android:focusable=&quot;true&quot;&#10;                    android:background=&quot;?attr/selectableItemBackground&quot;&#10;                    android:padding=&quot;4dp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;androidx.recyclerview.widget.RecyclerView&#10;                android:id=&quot;@+id/recyclerViewMostLikedTips&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;8dp&quot;&#10;                android:clipToPadding=&quot;false&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:paddingStart=&quot;8dp&quot;&#10;                android:paddingEnd=&quot;8dp&quot;&#10;                android:paddingBottom=&quot;16dp&quot;&#10;                app:layout_constraintTop_toBottomOf=&quot;@id/layoutMostLikedHeader&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                tools:itemCount=&quot;5&quot;&#10;                tools:listitem=&quot;@layout/item_health_tip&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- PROGRESS BAR --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;ProgressBar&#10;                android:id=&quot;@+id/progressBar&quot;&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:indeterminateTint=&quot;@color/primary_button_start&quot;&#10;                android:visibility=&quot;gone&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&#10;                app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;&#10;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;!-- OFFLINE MODE INDICATOR --&gt;&#10;            &lt;!-- =============================================== --&gt;&#10;            &lt;LinearLayout&#10;                android:id=&quot;@+id/layoutOfflineMode&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:background=&quot;#AA000000&quot;&#10;                android:gravity=&quot;center&quot;&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:padding=&quot;8dp&quot;&#10;                android:visibility=&quot;gone&quot;&#10;                app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;                app:layout_constraintEnd_toEndOf=&quot;parent&quot;&#10;                app:layout_constraintStart_toStartOf=&quot;parent&quot;&gt;&#10;&#10;                &lt;ImageView&#10;                    android:layout_width=&quot;24dp&quot;&#10;                    android:layout_height=&quot;24dp&quot;&#10;                    android:src=&quot;@android:drawable/ic_dialog_alert&quot;&#10;                    app:tint=&quot;@color/text_primary&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_marginStart=&quot;8dp&quot;&#10;                    android:text=&quot;@string/offline_mode&quot;&#10;                    android:textColor=&quot;@color/text_primary&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;        &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;&#10;&#10;    &lt;/androidx.core.widget.NestedScrollView&gt;&#10;&#10;&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/fragment_video_short.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/fragment_video_short.xml" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/fragment_video_short_vertical.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/fragment_video_short_vertical.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;FrameLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;match_parent&quot;&#10;    android:background=&quot;@color/black&quot;&gt;&#10;&#10;    &lt;!-- ViewPager2 cho video vertical như TikTok --&gt;&#10;    &lt;androidx.viewpager2.widget.ViewPager2&#10;        android:id=&quot;@+id/vp_videos&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;match_parent&quot;&#10;        android:orientation=&quot;vertical&quot; /&gt;&#10;&#10;    &lt;!-- Loading indicator --&gt;&#10;    &lt;com.google.android.material.progressindicator.CircularProgressIndicator&#10;        android:id=&quot;@+id/progress_bar&quot;&#10;        android:layout_width=&quot;wrap_content&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:layout_gravity=&quot;center&quot;&#10;        android:visibility=&quot;gone&quot;&#10;        app:indicatorColor=&quot;@color/white&quot; /&gt;&#10;&#10;    &lt;!-- Error State --&gt;&#10;    &lt;LinearLayout&#10;        android:id=&quot;@+id/layout_error_state&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;match_parent&quot;&#10;        android:gravity=&quot;center&quot;&#10;        android:orientation=&quot;vertical&quot;&#10;        android:padding=&quot;32dp&quot;&#10;        android:visibility=&quot;gone&quot;&#10;        android:background=&quot;@color/black&quot;&gt;&#10;&#10;        &lt;ImageView&#10;            android:layout_width=&quot;120dp&quot;&#10;            android:layout_height=&quot;120dp&quot;&#10;            android:alpha=&quot;0.6&quot;&#10;            android:src=&quot;@drawable/ic_error_outline&quot;&#10;            android:tint=&quot;@color/white&quot; /&gt;&#10;&#10;        &lt;TextView&#10;            android:layout_width=&quot;wrap_content&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:layout_marginTop=&quot;16dp&quot;&#10;            android:gravity=&quot;center&quot;&#10;            android:text=&quot;@string/error_loading_videos&quot;&#10;            android:textColor=&quot;@color/white&quot;&#10;            android:textSize=&quot;16sp&quot;&#10;            android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;        &lt;TextView&#10;            android:layout_width=&quot;wrap_content&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:layout_marginTop=&quot;8dp&quot;&#10;            android:gravity=&quot;center&quot;&#10;            android:text=&quot;@string/error_loading_videos_description&quot;&#10;            android:textColor=&quot;@color/white_50&quot;&#10;            android:textSize=&quot;14sp&quot; /&gt;&#10;&#10;        &lt;com.google.android.material.button.MaterialButton&#10;            android:id=&quot;@+id/btn_retry&quot;&#10;            android:layout_width=&quot;wrap_content&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:layout_marginTop=&quot;16dp&quot;&#10;            android:text=&quot;@string/retry&quot;&#10;            android:textColor=&quot;@color/black&quot;&#10;            android:backgroundTint=&quot;@color/white&quot;&#10;            style=&quot;@style/Widget.Material3.Button&quot; /&gt;&#10;&#10;    &lt;/LinearLayout&gt;&#10;&#10;&lt;/FrameLayout&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/item_video_short.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/item_video_short.xml" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/item_video_short_vertical.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/item_video_short_vertical.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;FrameLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#10;    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;match_parent&quot;&#10;    android:background=&quot;@color/black&quot;&gt;&#10;&#10;    &lt;!-- Video Player - Full Screen như TikTok --&gt;&#10;    &lt;com.google.android.exoplayer2.ui.StyledPlayerView&#10;        android:id=&quot;@+id/player_view&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;match_parent&quot;&#10;        android:background=&quot;@color/black&quot;&#10;        app:use_controller=&quot;false&quot;&#10;        app:resize_mode=&quot;zoom&quot;&#10;        app:show_buffering=&quot;when_playing&quot; /&gt;&#10;&#10;    &lt;!-- Overlay Content như TikTok --&gt;&#10;    &lt;LinearLayout&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;match_parent&quot;&#10;        android:orientation=&quot;horizontal&quot;&gt;&#10;&#10;        &lt;!-- Left side - Video info và interaction area --&gt;&#10;        &lt;LinearLayout&#10;            android:layout_width=&quot;0dp&quot;&#10;            android:layout_height=&quot;match_parent&quot;&#10;            android:layout_weight=&quot;1&quot;&#10;            android:orientation=&quot;vertical&quot;&#10;            android:gravity=&quot;bottom&quot;&#10;            android:padding=&quot;16dp&quot;&gt;&#10;&#10;            &lt;!-- Video Information --&gt;&#10;            &lt;LinearLayout&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:orientation=&quot;vertical&quot;&#10;                android:layout_marginBottom=&quot;20dp&quot;&gt;&#10;&#10;                &lt;!-- Author info --&gt;&#10;                &lt;LinearLayout&#10;                    android:layout_width=&quot;match_parent&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:orientation=&quot;horizontal&quot;&#10;                    android:gravity=&quot;center_vertical&quot;&#10;                    android:layout_marginBottom=&quot;8dp&quot;&gt;&#10;&#10;                    &lt;ImageView&#10;                        android:id=&quot;@+id/iv_user_avatar&quot;&#10;                        android:layout_width=&quot;32dp&quot;&#10;                        android:layout_height=&quot;32dp&quot;&#10;                        android:background=&quot;@drawable/bg_circle_white&quot;&#10;                        android:padding=&quot;1dp&quot;&#10;                        tools:src=&quot;@drawable/ic_user_avatar_placeholder&quot; /&gt;&#10;&#10;                    &lt;TextView&#10;                        android:id=&quot;@+id/tv_author&quot;&#10;                        android:layout_width=&quot;wrap_content&quot;&#10;                        android:layout_height=&quot;wrap_content&quot;&#10;                        android:layout_marginStart=&quot;8dp&quot;&#10;                        android:layout_marginEnd=&quot;12dp&quot;&#10;                        android:textColor=&quot;@color/white&quot;&#10;                        android:textSize=&quot;14sp&quot;&#10;                        android:textStyle=&quot;bold&quot;&#10;                        tools:text=&quot;@healthtips&quot; /&gt;&#10;&#10;                    &lt;View&#10;                        android:id=&quot;@+id/btn_follow&quot;&#10;                        android:layout_width=&quot;wrap_content&quot;&#10;                        android:layout_height=&quot;wrap_content&quot;&#10;                        android:background=&quot;@drawable/bg_follow_button&quot;&#10;                        android:padding=&quot;6dp&quot;&#10;                        android:clickable=&quot;true&quot;&#10;                        android:focusable=&quot;true&quot; /&gt;&#10;&#10;                &lt;/LinearLayout&gt;&#10;&#10;                &lt;!-- Video title --&gt;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/tv_title&quot;&#10;                    android:layout_width=&quot;match_parent&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:textColor=&quot;@color/white&quot;&#10;                    android:textSize=&quot;16sp&quot;&#10;                    android:textStyle=&quot;bold&quot;&#10;                    android:maxLines=&quot;2&quot;&#10;                    android:ellipsize=&quot;end&quot;&#10;                    android:layout_marginBottom=&quot;4dp&quot;&#10;                    tools:text=&quot;5 cách uống nước đúng cách để tăng cường sức khỏe&quot; /&gt;&#10;&#10;                &lt;!-- Video description --&gt;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/tv_description&quot;&#10;                    android:layout_width=&quot;match_parent&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:textColor=&quot;@color/white_50&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:maxLines=&quot;3&quot;&#10;                    android:ellipsize=&quot;end&quot;&#10;                    android:layout_marginBottom=&quot;8dp&quot;&#10;                    tools:text=&quot;Trong video này, chúng ta sẽ học cách uống nước đúng cách để có sức khỏe tốt nhất...&quot; /&gt;&#10;&#10;                &lt;!-- Video stats --&gt;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/tv_view_count&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:textColor=&quot;@color/white_50&quot;&#10;                    android:textSize=&quot;12sp&quot;&#10;                    tools:text=&quot;1.2K lượt xem&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;        &lt;/LinearLayout&gt;&#10;&#10;        &lt;!-- Right side - Action buttons như TikTok --&gt;&#10;        &lt;LinearLayout&#10;            android:layout_width=&quot;80dp&quot;&#10;            android:layout_height=&quot;match_parent&quot;&#10;            android:orientation=&quot;vertical&quot;&#10;            android:gravity=&quot;bottom&quot;&#10;            android:padding=&quot;12dp&quot;&gt;&#10;&#10;            &lt;!-- User Avatar với Follow button --&gt;&#10;            &lt;FrameLayout&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_gravity=&quot;center_horizontal&quot;&#10;                android:layout_marginBottom=&quot;20dp&quot;&gt;&#10;&#10;                &lt;ImageView&#10;                    android:id=&quot;@+id/iv_user_avatar_large&quot;&#10;                    android:layout_width=&quot;48dp&quot;&#10;                    android:layout_height=&quot;48dp&quot;&#10;                    android:background=&quot;@drawable/bg_circle_white&quot;&#10;                    android:padding=&quot;2dp&quot;&#10;                    tools:src=&quot;@drawable/ic_user_avatar_placeholder&quot; /&gt;&#10;&#10;                &lt;!-- Plus button for follow --&gt;&#10;                &lt;ImageView&#10;                    android:layout_width=&quot;20dp&quot;&#10;                    android:layout_height=&quot;20dp&quot;&#10;                    android:layout_gravity=&quot;bottom|center_horizontal&quot;&#10;                    android:layout_marginBottom=&quot;-10dp&quot;&#10;                    android:background=&quot;@drawable/bg_circle_red&quot;&#10;                    android:src=&quot;@drawable/ic_add&quot;&#10;                    android:padding=&quot;4dp&quot;&#10;                    android:tint=&quot;@color/white&quot; /&gt;&#10;&#10;            &lt;/FrameLayout&gt;&#10;&#10;            &lt;!-- Like button --&gt;&#10;            &lt;LinearLayout&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:orientation=&quot;vertical&quot;&#10;                android:gravity=&quot;center_horizontal&quot;&#10;                android:layout_marginBottom=&quot;20dp&quot;&#10;                android:clickable=&quot;true&quot;&#10;                android:focusable=&quot;true&quot;&#10;                android:background=&quot;?attr/selectableItemBackgroundBorderless&quot;&#10;                android:padding=&quot;8dp&quot;&gt;&#10;&#10;                &lt;ImageView&#10;                    android:id=&quot;@+id/iv_like&quot;&#10;                    android:layout_width=&quot;32dp&quot;&#10;                    android:layout_height=&quot;32dp&quot;&#10;                    android:src=&quot;@drawable/ic_heart_outline&quot;&#10;                    android:tint=&quot;@color/white&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/tv_like_count&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_marginTop=&quot;4dp&quot;&#10;                    android:textColor=&quot;@color/white&quot;&#10;                    android:textSize=&quot;12sp&quot;&#10;                    android:gravity=&quot;center&quot;&#10;                    tools:text=&quot;350&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;!-- Comment button --&gt;&#10;            &lt;LinearLayout&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:orientation=&quot;vertical&quot;&#10;                android:gravity=&quot;center_horizontal&quot;&#10;                android:layout_marginBottom=&quot;20dp&quot;&#10;                android:clickable=&quot;true&quot;&#10;                android:focusable=&quot;true&quot;&#10;                android:background=&quot;?attr/selectableItemBackgroundBorderless&quot;&#10;                android:padding=&quot;8dp&quot;&gt;&#10;&#10;                &lt;ImageView&#10;                    android:id=&quot;@+id/iv_comment&quot;&#10;                    android:layout_width=&quot;32dp&quot;&#10;                    android:layout_height=&quot;32dp&quot;&#10;                    android:src=&quot;@drawable/ic_comment&quot;&#10;                    android:tint=&quot;@color/white&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/tv_comment_count&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_marginTop=&quot;4dp&quot;&#10;                    android:textColor=&quot;@color/white&quot;&#10;                    android:textSize=&quot;12sp&quot;&#10;                    android:gravity=&quot;center&quot;&#10;                    tools:text=&quot;42&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;!-- Share button --&gt;&#10;            &lt;LinearLayout&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:orientation=&quot;vertical&quot;&#10;                android:gravity=&quot;center_horizontal&quot;&#10;                android:layout_marginBottom=&quot;20dp&quot;&#10;                android:clickable=&quot;true&quot;&#10;                android:focusable=&quot;true&quot;&#10;                android:background=&quot;?attr/selectableItemBackgroundBorderless&quot;&#10;                android:padding=&quot;8dp&quot;&gt;&#10;&#10;                &lt;ImageView&#10;                    android:id=&quot;@+id/iv_share&quot;&#10;                    android:layout_width=&quot;32dp&quot;&#10;                    android:layout_height=&quot;32dp&quot;&#10;                    android:src=&quot;@drawable/ic_share&quot;&#10;                    android:tint=&quot;@color/white&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:layout_marginTop=&quot;4dp&quot;&#10;                    android:textColor=&quot;@color/white&quot;&#10;                    android:textSize=&quot;12sp&quot;&#10;                    android:gravity=&quot;center&quot;&#10;                    android:text=&quot;Chia sẻ&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;            &lt;!-- More options button --&gt;&#10;            &lt;LinearLayout&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:orientation=&quot;vertical&quot;&#10;                android:gravity=&quot;center_horizontal&quot;&#10;                android:layout_marginBottom=&quot;80dp&quot;&#10;                android:clickable=&quot;true&quot;&#10;                android:focusable=&quot;true&quot;&#10;                android:background=&quot;?attr/selectableItemBackgroundBorderless&quot;&#10;                android:padding=&quot;8dp&quot;&gt;&#10;&#10;                &lt;ImageView&#10;                    android:id=&quot;@+id/iv_more&quot;&#10;                    android:layout_width=&quot;32dp&quot;&#10;                    android:layout_height=&quot;32dp&quot;&#10;                    android:src=&quot;@drawable/ic_more_vert&quot;&#10;                    android:tint=&quot;@color/white&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;        &lt;/LinearLayout&gt;&#10;&#10;    &lt;/LinearLayout&gt;&#10;&#10;    &lt;!-- Video progress indicator (optional) --&gt;&#10;    &lt;ProgressBar&#10;        android:id=&quot;@+id/progress_video&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;2dp&quot;&#10;        android:layout_gravity=&quot;bottom&quot;&#10;        android:layout_marginBottom=&quot;100dp&quot;&#10;        android:progressTint=&quot;@color/white&quot;&#10;        android:visibility=&quot;gone&quot;&#10;        style=&quot;?android:attr/progressBarStyleHorizontal&quot; /&gt;&#10;&#10;&lt;/FrameLayout&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/firebase-database-rules.json">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/firebase-database-rules.json" />
              <option name="updatedContent" value="{&#10;  &quot;rules&quot;: {&#10;    &quot;conversations&quot;: {&#10;      &quot;$userId&quot;: {&#10;        &quot;.read&quot;: &quot;auth != null &amp;&amp; auth.uid == $userId&quot;,&#10;        &quot;.write&quot;: &quot;auth != null &amp;&amp; auth.uid == $userId&quot;,&#10;        &quot;$conversationId&quot;: {&#10;          &quot;.validate&quot;: &quot;newData.hasChildren(['userId', 'title', 'createdTime', 'lastMessageTime']) &amp;&amp; newData.child('userId').val() == auth.uid&quot;&#10;        }&#10;      }&#10;    },&#10;    &quot;chat_messages&quot;: {&#10;      &quot;$conversationId&quot;: {&#10;        &quot;.read&quot;: &quot;auth != null &amp;&amp; root.child('conversations').child(auth.uid).child($conversationId).exists()&quot;,&#10;        &quot;.write&quot;: &quot;auth != null &amp;&amp; root.child('conversations').child(auth.uid).child($conversationId).exists()&quot;,&#10;        &quot;$messageId&quot;: {&#10;          &quot;.validate&quot;: &quot;newData.hasChildren(['conversationId', 'content', 'timestamp', 'isBot']) &amp;&amp; newData.child('conversationId').val() == $conversationId&quot;&#10;        }&#10;      }&#10;    },&#10;    &quot;user_topics&quot;: {&#10;      &quot;$userId&quot;: {&#10;        &quot;.read&quot;: &quot;auth != null &amp;&amp; auth.uid == $userId&quot;,&#10;        &quot;.write&quot;: &quot;auth != null &amp;&amp; auth.uid == $userId&quot;&#10;      }&#10;    },&#10;    &quot;health_tips&quot;: {&#10;      &quot;.read&quot;: &quot;auth != null&quot;,&#10;      &quot;.write&quot;: &quot;auth != null&quot;&#10;    },&#10;    &quot;categories&quot;: {&#10;      &quot;.read&quot;: &quot;auth != null&quot;,&#10;      &quot;.write&quot;: &quot;auth != null&quot;&#10;    },&#10;    &quot;users&quot;: {&#10;      &quot;$userId&quot;: {&#10;        &quot;.read&quot;: &quot;auth != null &amp;&amp; auth.uid == $userId&quot;,&#10;        &quot;.write&quot;: &quot;auth != null &amp;&amp; auth.uid == $userId&quot;,&#10;        &quot;.validate&quot;: &quot;newData.hasChildren(['email', 'fullName', 'createdAt']) &amp;&amp; newData.child('email').val() == auth.token.email&quot;&#10;      }&#10;    },&#10;    &quot;reminders&quot;: {&#10;      &quot;$userId&quot;: {&#10;        &quot;.read&quot;: &quot;auth != null &amp;&amp; auth.uid == $userId&quot;,&#10;        &quot;.write&quot;: &quot;auth != null &amp;&amp; auth.uid == $userId&quot;&#10;      }&#10;    }&#10;  }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/firebase_video_test_data.json">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/firebase_video_test_data.json" />
              <option name="updatedContent" value="{&#10;  &quot;videos&quot;: {&#10;    &quot;video_001&quot;: {&#10;      &quot;id&quot;: &quot;video_001&quot;,&#10;      &quot;title&quot;: &quot;5 cách uống nước đúng cách để tăng cường sức khỏe&quot;,&#10;      &quot;description&quot;: &quot;Trong video này, chúng ta sẽ học cách uống nước đúng cách để có sức khỏe tốt nhất. Việc uống nước đúng cách sẽ giúp bạn cải thiện sức khỏe một cách đáng kể.&quot;,&#10;      &quot;videoUrl&quot;: &quot;https://storage.googleapis.com/healthtips-videos/water_tips.mp4&quot;,&#10;      &quot;thumbnailUrl&quot;: &quot;https://storage.googleapis.com/healthtips-thumbnails/water_tips_thumb.jpg&quot;,&#10;      &quot;categoryId&quot;: &quot;nutrition&quot;,&#10;      &quot;tags&quot;: [&quot;uống nước&quot;, &quot;hydration&quot;, &quot;sức khỏe&quot;, &quot;dinh dưỡng&quot;],&#10;      &quot;viewCount&quot;: 1250,&#10;      &quot;likeCount&quot;: 89,&#10;      &quot;duration&quot;: 45,&#10;      &quot;publishDate&quot;: 1704067200000,&#10;      &quot;authorId&quot;: &quot;healthtips_official&quot;&#10;    },&#10;    &quot;video_002&quot;: {&#10;      &quot;id&quot;: &quot;video_002&quot;, &#10;      &quot;title&quot;: &quot;3 bài tập yoga buổi sáng cho năng lượng cả ngày&quot;,&#10;      &quot;description&quot;: &quot;Khởi đầu ngày mới với 3 bài tập yoga đơn giản nhưng hiệu quả. Chỉ cần 10 phút mỗi sáng để có năng lượng tươi mới cho cả ngày.&quot;,&#10;      &quot;videoUrl&quot;: &quot;https://storage.googleapis.com/healthtips-videos/morning_yoga.mp4&quot;,&#10;      &quot;thumbnailUrl&quot;: &quot;https://storage.googleapis.com/healthtips-thumbnails/morning_yoga_thumb.jpg&quot;,&#10;      &quot;categoryId&quot;: &quot;exercise&quot;,&#10;      &quot;tags&quot;: [&quot;yoga&quot;, &quot;tập luyện&quot;, &quot;buổi sáng&quot;, &quot;năng lượng&quot;],&#10;      &quot;viewCount&quot;: 2100,&#10;      &quot;likeCount&quot;: 156,&#10;      &quot;duration&quot;: 60,&#10;      &quot;publishDate&quot;: 1704153600000,&#10;      &quot;authorId&quot;: &quot;healthtips_official&quot;&#10;    },&#10;    &quot;video_003&quot;: {&#10;      &quot;id&quot;: &quot;video_003&quot;,&#10;      &quot;title&quot;: &quot;Cách giảm stress hiệu quả trong 2 phút&quot;,&#10;      &quot;description&quot;: &quot;Kỹ thuật thở sâu và thiền ngắn giúp bạn giảm stress ngay lập tức. Áp dụng mọi lúc mọi nơi, đặc biệt hữu ích khi làm việc.&quot;,&#10;      &quot;videoUrl&quot;: &quot;https://storage.googleapis.com/healthtips-videos/stress_relief.mp4&quot;,&#10;      &quot;thumbnailUrl&quot;: &quot;https://storage.googleapis.com/healthtips-thumbnails/stress_relief_thumb.jpg&quot;,&#10;      &quot;categoryId&quot;: &quot;mental_health&quot;,&#10;      &quot;tags&quot;: [&quot;stress&quot;, &quot;thiền&quot;, &quot;thở sâu&quot;, &quot;sức khỏe tinh thần&quot;],&#10;      &quot;viewCount&quot;: 890,&#10;      &quot;likeCount&quot;: 67,&#10;      &quot;duration&quot;: 120,&#10;      &quot;publishDate&quot;: 1704240000000,&#10;      &quot;authorId&quot;: &quot;healthtips_official&quot;&#10;    },&#10;    &quot;video_004&quot;: {&#10;      &quot;id&quot;: &quot;video_004&quot;,&#10;      &quot;title&quot;: &quot;Smoothie xanh tăng cường miễn dịch&quot;,&#10;      &quot;description&quot;: &quot;Công thức smoothie xanh với rau cải xoăn, táo và gừng. Bổ sung vitamin C và chất chống oxy hóa tự nhiên cho cơ thể.&quot;,&#10;      &quot;videoUrl&quot;: &quot;https://storage.googleapis.com/healthtips-videos/green_smoothie.mp4&quot;, &#10;      &quot;thumbnailUrl&quot;: &quot;https://storage.googleapis.com/healthtips-thumbnails/green_smoothie_thumb.jpg&quot;,&#10;      &quot;categoryId&quot;: &quot;nutrition&quot;,&#10;      &quot;tags&quot;: [&quot;smoothie&quot;, &quot;miễn dịch&quot;, &quot;vitamin&quot;, &quot;rau xanh&quot;],&#10;      &quot;viewCount&quot;: 1456,&#10;      &quot;likeCount&quot;: 112,&#10;      &quot;duration&quot;: 90,&#10;      &quot;publishDate&quot;: 1704326400000,&#10;      &quot;authorId&quot;: &quot;healthtips_official&quot;&#10;    },&#10;    &quot;video_005&quot;: {&#10;      &quot;id&quot;: &quot;video_005&quot;,&#10;      &quot;title&quot;: &quot;Bài tập giảm mỡ bụng tại nhà&quot;,&#10;      &quot;description&quot;: &quot;5 động tác đơn giản nhưng hiệu quả để giảm mỡ bụng. Không cần dụng cụ, có thể tập ngay tại nhà chỉ trong 15 phút.&quot;,&#10;      &quot;videoUrl&quot;: &quot;https://storage.googleapis.com/healthtips-videos/belly_fat_workout.mp4&quot;,&#10;      &quot;thumbnailUrl&quot;: &quot;https://storage.googleapis.com/healthtips-thumbnails/belly_fat_workout_thumb.jpg&quot;, &#10;      &quot;categoryId&quot;: &quot;weight_loss&quot;,&#10;      &quot;tags&quot;: [&quot;giảm cân&quot;, &quot;mỡ bụng&quot;, &quot;tập tại nhà&quot;, &quot;cardio&quot;],&#10;      &quot;viewCount&quot;: 3200,&#10;      &quot;likeCount&quot;: 245,&#10;      &quot;duration&quot;: 900,&#10;      &quot;publishDate&quot;: 1704412800000,&#10;      &quot;authorId&quot;: &quot;healthtips_official&quot;&#10;    },&#10;    &quot;video_006&quot;: {&#10;      &quot;id&quot;: &quot;video_006&quot;,&#10;      &quot;title&quot;: &quot;Massage điểm huyệt giảm đau đầu&quot;,&#10;      &quot;description&quot;: &quot;Kỹ thuật massage các điểm huyệt trên mặt và đầu để giảm đau đầu tự nhiên. Hiệu quả nhanh chóng không cần thuốc.&quot;,&#10;      &quot;videoUrl&quot;: &quot;https://storage.googleapis.com/healthtips-videos/headache_massage.mp4&quot;,&#10;      &quot;thumbnailUrl&quot;: &quot;https://storage.googleapis.com/healthtips-thumbnails/headache_massage_thumb.jpg&quot;,&#10;      &quot;categoryId&quot;: &quot;general_health&quot;, &#10;      &quot;tags&quot;: [&quot;đau đầu&quot;, &quot;massage&quot;, &quot;điểm huyệt&quot;, &quot;tự nhiên&quot;],&#10;      &quot;viewCount&quot;: 1890,&#10;      &quot;likeCount&quot;: 134,&#10;      &quot;duration&quot;: 180,&#10;      &quot;publishDate&quot;: 1704499200000,&#10;      &quot;authorId&quot;: &quot;healthtips_official&quot;&#10;    }&#10;  },&#10;  &quot;video_categories&quot;: {&#10;    &quot;nutrition&quot;: {&#10;      &quot;name&quot;: &quot;Dinh dưỡng&quot;,&#10;      &quot;videos&quot;: {&#10;        &quot;video_001&quot;: true,&#10;        &quot;video_004&quot;: true&#10;      }&#10;    },&#10;    &quot;exercise&quot;: {&#10;      &quot;name&quot;: &quot;Thể dục&quot;,&#10;      &quot;videos&quot;: {&#10;        &quot;video_002&quot;: true&#10;      }&#10;    },&#10;    &quot;mental_health&quot;: {&#10;      &quot;name&quot;: &quot;Sức khỏe tinh thần&quot;, &#10;      &quot;videos&quot;: {&#10;        &quot;video_003&quot;: true&#10;      }&#10;    },&#10;    &quot;weight_loss&quot;: {&#10;      &quot;name&quot;: &quot;Giảm cân&quot;,&#10;      &quot;videos&quot;: {&#10;        &quot;video_005&quot;: true&#10;      }&#10;    },&#10;    &quot;general_health&quot;: {&#10;      &quot;name&quot;: &quot;Sức khỏe tổng quát&quot;,&#10;      &quot;videos&quot;: {&#10;        &quot;video_006&quot;: true&#10;      }&#10;    }&#10;  },&#10;  &quot;video_tags&quot;: {&#10;    &quot;uống nước&quot;: {&#10;      &quot;video_001&quot;: true&#10;    },&#10;    &quot;hydration&quot;: {&#10;      &quot;video_001&quot;: true  &#10;    },&#10;    &quot;yoga&quot;: {&#10;      &quot;video_002&quot;: true&#10;    },&#10;    &quot;stress&quot;: {&#10;      &quot;video_003&quot;: true&#10;    },&#10;    &quot;smoothie&quot;: {&#10;      &quot;video_004&quot;: true&#10;    },&#10;    &quot;giảm cân&quot;: {&#10;      &quot;video_005&quot;: true&#10;    },&#10;    &quot;massage&quot;: {&#10;      &quot;video_006&quot;: true&#10;    }&#10;  },&#10;  &quot;user_likes&quot;: {&#10;    &quot;user_demo&quot;: {&#10;      &quot;video_001&quot;: true,&#10;      &quot;video_004&quot;: true&#10;    }&#10;  },&#10;  &quot;user_views&quot;: {&#10;    &quot;user_demo&quot;: {&#10;      &quot;video_001&quot;: 1704500000000,&#10;      &quot;video_002&quot;: 1704501000000,&#10;      &quot;video_004&quot;: 1704502000000&#10;    }&#10;  },&#10;  &quot;user_searches&quot;: {&#10;    &quot;user_demo&quot;: {&#10;      &quot;uống nước&quot;: 1704500000000,&#10;      &quot;yoga&quot;: 1704501000000,&#10;      &quot;giảm cân&quot;: 1704502000000&#10;    }&#10;  }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/test_fcm_notification.html">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/test_fcm_notification.html" />
              <option name="updatedContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;vi&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;title&gt;Test FCM Notification - HealthTips App&lt;/title&gt;&#10;    &lt;style&gt;&#10;        * {&#10;            margin: 0;&#10;            padding: 0;&#10;            box-sizing: border-box;&#10;        }&#10;        &#10;        body {&#10;            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;&#10;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;            min-height: 100vh;&#10;            padding: 20px;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        &#10;        .container {&#10;            background: white;&#10;            border-radius: 20px;&#10;            padding: 40px;&#10;            max-width: 800px;&#10;            width: 100%;&#10;            box-shadow: 0 20px 60px rgba(0,0,0,0.3);&#10;        }&#10;        &#10;        h1 {&#10;            color: #333;&#10;            margin-bottom: 10px;&#10;            font-size: 28px;&#10;        }&#10;        &#10;        .subtitle {&#10;            color: #666;&#10;            margin-bottom: 30px;&#10;            font-size: 14px;&#10;        }&#10;        &#10;        .section {&#10;            margin-bottom: 30px;&#10;        }&#10;        &#10;        .section-title {&#10;            color: #667eea;&#10;            font-size: 18px;&#10;            font-weight: bold;&#10;            margin-bottom: 15px;&#10;            display: flex;&#10;            align-items: center;&#10;            gap: 10px;&#10;        }&#10;        &#10;        .badge {&#10;            background: #667eea;&#10;            color: white;&#10;            padding: 4px 12px;&#10;            border-radius: 20px;&#10;            font-size: 12px;&#10;            font-weight: normal;&#10;        }&#10;        &#10;        label {&#10;            display: block;&#10;            color: #555;&#10;            font-weight: 600;&#10;            margin-bottom: 8px;&#10;            font-size: 14px;&#10;        }&#10;        &#10;        input, textarea, select {&#10;            width: 100%;&#10;            padding: 12px 15px;&#10;            border: 2px solid #e0e0e0;&#10;            border-radius: 10px;&#10;            font-size: 14px;&#10;            transition: all 0.3s;&#10;            font-family: inherit;&#10;        }&#10;        &#10;        input:focus, textarea:focus, select:focus {&#10;            outline: none;&#10;            border-color: #667eea;&#10;            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);&#10;        }&#10;        &#10;        textarea {&#10;            resize: vertical;&#10;            min-height: 80px;&#10;            font-family: 'Courier New', monospace;&#10;        }&#10;        &#10;        .input-group {&#10;            margin-bottom: 20px;&#10;        }&#10;        &#10;        .button-group {&#10;            display: grid;&#10;            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));&#10;            gap: 15px;&#10;            margin-top: 25px;&#10;        }&#10;        &#10;        button {&#10;            padding: 15px 25px;&#10;            border: none;&#10;            border-radius: 10px;&#10;            font-size: 15px;&#10;            font-weight: 600;&#10;            cursor: pointer;&#10;            transition: all 0.3s;&#10;            display: flex;&#10;            align-items: center;&#10;            justify-content: center;&#10;            gap: 8px;&#10;        }&#10;        &#10;        button:hover {&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 5px 15px rgba(0,0,0,0.2);&#10;        }&#10;        &#10;        .btn-primary {&#10;            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);&#10;            color: white;&#10;        }&#10;        &#10;        .btn-secondary {&#10;            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);&#10;            color: white;&#10;        }&#10;        &#10;        .btn-warning {&#10;            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);&#10;            color: white;&#10;        }&#10;        &#10;        .response {&#10;            margin-top: 20px;&#10;            padding: 20px;&#10;            border-radius: 10px;&#10;            display: none;&#10;            animation: slideIn 0.3s ease-out;&#10;        }&#10;        &#10;        @keyframes slideIn {&#10;            from {&#10;                opacity: 0;&#10;                transform: translateY(-10px);&#10;            }&#10;            to {&#10;                opacity: 1;&#10;                transform: translateY(0);&#10;            }&#10;        }&#10;        &#10;        .response.success {&#10;            background: #e8f5e9;&#10;            border-left: 4px solid #4CAF50;&#10;            color: #2e7d32;&#10;            display: block;&#10;        }&#10;        &#10;        .response.error {&#10;            background: #ffebee;&#10;            border-left: 4px solid #f44336;&#10;            color: #c62828;&#10;            display: block;&#10;        }&#10;        &#10;        .response.loading {&#10;            background: #e3f2fd;&#10;            border-left: 4px solid #2196F3;&#10;            color: #1565c0;&#10;            display: block;&#10;        }&#10;        &#10;        .quick-fill {&#10;            display: flex;&#10;            gap: 10px;&#10;            margin-top: 10px;&#10;            flex-wrap: wrap;&#10;        }&#10;        &#10;        .quick-btn {&#10;            padding: 6px 12px;&#10;            background: #f5f5f5;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            font-size: 12px;&#10;            cursor: pointer;&#10;            transition: all 0.2s;&#10;        }&#10;        &#10;        .quick-btn:hover {&#10;            background: #667eea;&#10;            color: white;&#10;            border-color: #667eea;&#10;        }&#10;        &#10;        .info-box {&#10;            background: #fff3cd;&#10;            border-left: 4px solid #ffc107;&#10;            padding: 15px;&#10;            border-radius: 10px;&#10;            margin-bottom: 20px;&#10;            font-size: 14px;&#10;            color: #856404;&#10;        }&#10;        &#10;        .code {&#10;            background: #f5f5f5;&#10;            padding: 3px 8px;&#10;            border-radius: 4px;&#10;            font-family: 'Courier New', monospace;&#10;            font-size: 13px;&#10;            color: #d63384;&#10;        }&#10;        &#10;        .spinner {&#10;            display: inline-block;&#10;            width: 16px;&#10;            height: 16px;&#10;            border: 2px solid rgba(255,255,255,0.3);&#10;            border-top-color: white;&#10;            border-radius: 50%;&#10;            animation: spin 0.8s linear infinite;&#10;        }&#10;        &#10;        @keyframes spin {&#10;            to { transform: rotate(360deg); }&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;h1&gt; Test FCM Notification&lt;/h1&gt;&#10;        &lt;p class=&quot;subtitle&quot;&gt;Công cụ test thông báo cho HealthTips App&lt;/p&gt;&#10;        &#10;        &lt;div class=&quot;info-box&quot;&gt;&#10;            &lt;strong&gt; Hướng dẫn:&lt;/strong&gt; Dán FCM Token từ app vào ô bên dưới, chọn loại notification muốn test, sau đó nhấn nút gửi.&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- FCM Token Section --&gt;&#10;        &lt;div class=&quot;section&quot;&gt;&#10;            &lt;div class=&quot;section-title&quot;&gt;&#10;                &lt;span&gt;1️⃣ FCM Token&lt;/span&gt;&#10;                &lt;span class=&quot;badge&quot;&gt;Bắt buộc&lt;/span&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;input-group&quot;&gt;&#10;                &lt;label for=&quot;fcmToken&quot;&gt;Dán FCM Token từ app:&lt;/label&gt;&#10;                &lt;textarea id=&quot;fcmToken&quot; placeholder=&quot;eyJhbGciOiJSUzI1NiIsImtpZCI6Ijk2YjQ...&quot;&gt;&lt;/textarea&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Test Type Section --&gt;&#10;        &lt;div class=&quot;section&quot;&gt;&#10;            &lt;div class=&quot;section-title&quot;&gt;&#10;                &lt;span&gt;2️⃣ Chọn Loại Notification&lt;/span&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;input-group&quot;&gt;&#10;                &lt;label for=&quot;testType&quot;&gt;Loại test:&lt;/label&gt;&#10;                &lt;select id=&quot;testType&quot; onchange=&quot;updateInputs()&quot;&gt;&#10;                    &lt;option value=&quot;comment_reply&quot;&gt;Comment Reply Notification&lt;/option&gt;&#10;                    &lt;option value=&quot;new_health_tip&quot;&gt;New Health Tip Notification&lt;/option&gt;&#10;                    &lt;option value=&quot;recommendation&quot;&gt;Recommendation Notification&lt;/option&gt;&#10;                &lt;/select&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Dynamic Inputs Section --&gt;&#10;        &lt;div class=&quot;section&quot;&gt;&#10;            &lt;div class=&quot;section-title&quot;&gt;&#10;                &lt;span&gt;3️⃣ Thông Tin Test&lt;/span&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div id=&quot;commentReplyInputs&quot;&gt;&#10;                &lt;div class=&quot;input-group&quot;&gt;&#10;                    &lt;label for=&quot;videoId&quot;&gt;Video ID:&lt;/label&gt;&#10;                    &lt;input type=&quot;text&quot; id=&quot;videoId&quot; placeholder=&quot;Ví dụ: v8&quot;&gt;&#10;                    &lt;div class=&quot;quick-fill&quot;&gt;&#10;                        &lt;button class=&quot;quick-btn&quot; onclick=&quot;fillQuick('videoId', 'v8')&quot;&gt;v8 - Massage&lt;/button&gt;&#10;                        &lt;button class=&quot;quick-btn&quot; onclick=&quot;fillQuick('videoId', 'v7')&quot;&gt;v7 - Đau lưng&lt;/button&gt;&#10;                        &lt;button class=&quot;quick-btn&quot; onclick=&quot;fillQuick('videoId', 'v6')&quot;&gt;v6 - Yoga&lt;/button&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &lt;div class=&quot;input-group&quot;&gt;&#10;                    &lt;label for=&quot;commentId&quot;&gt;Parent Comment ID:&lt;/label&gt;&#10;                    &lt;input type=&quot;text&quot; id=&quot;commentId&quot; value=&quot;test_comment_001&quot; placeholder=&quot;test_comment_001&quot;&gt;&#10;                &lt;/div&gt;&#10;                &lt;div class=&quot;input-group&quot;&gt;&#10;                    &lt;label for=&quot;replyId&quot;&gt;Reply Comment ID:&lt;/label&gt;&#10;                    &lt;input type=&quot;text&quot; id=&quot;replyId&quot; value=&quot;test_reply_001&quot; placeholder=&quot;test_reply_001&quot;&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div id=&quot;healthTipInputs&quot; style=&quot;display: none;&quot;&gt;&#10;                &lt;div class=&quot;input-group&quot;&gt;&#10;                    &lt;label for=&quot;healthTipId&quot;&gt;Health Tip ID:&lt;/label&gt;&#10;                    &lt;input type=&quot;text&quot; id=&quot;healthTipId&quot; placeholder=&quot;Ví dụ: -O_HEALTHTIP_001&quot;&gt;&#10;                    &lt;div class=&quot;quick-fill&quot;&gt;&#10;                        &lt;button class=&quot;quick-btn&quot; onclick=&quot;fillQuick('healthTipId', '-O_HEALTHTIP_001')&quot;&gt;HEALTHTIP_001&lt;/button&gt;&#10;                        &lt;button class=&quot;quick-btn&quot; onclick=&quot;fillQuick('healthTipId', '-O_HEALTHTIP_002')&quot;&gt;HEALTHTIP_002&lt;/button&gt;&#10;                        &lt;button class=&quot;quick-btn&quot; onclick=&quot;fillQuick('healthTipId', '-O_HEALTHTIP_003')&quot;&gt;HEALTHTIP_003&lt;/button&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &lt;div class=&quot;input-group&quot;&gt;&#10;                    &lt;label for=&quot;tipTitle&quot;&gt;Title (tùy chọn):&lt;/label&gt;&#10;                    &lt;input type=&quot;text&quot; id=&quot;tipTitle&quot; placeholder=&quot;Mẹo sức khỏe mới&quot;&gt;&#10;                &lt;/div&gt;&#10;                &lt;div class=&quot;input-group&quot;&gt;&#10;                    &lt;label for=&quot;category&quot;&gt;Category (tùy chọn):&lt;/label&gt;&#10;                    &lt;input type=&quot;text&quot; id=&quot;category&quot; value=&quot;cat001&quot; placeholder=&quot;cat001&quot;&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div id=&quot;recommendationInputs&quot; style=&quot;display: none;&quot;&gt;&#10;                &lt;div class=&quot;input-group&quot;&gt;&#10;                    &lt;label for=&quot;recHealthTipId&quot;&gt;Health Tip ID:&lt;/label&gt;&#10;                    &lt;input type=&quot;text&quot; id=&quot;recHealthTipId&quot; placeholder=&quot;-O_HEALTHTIP_001&quot;&gt;&#10;                &lt;/div&gt;&#10;                &lt;div class=&quot;input-group&quot;&gt;&#10;                    &lt;label for=&quot;recCategory&quot;&gt;Category ID:&lt;/label&gt;&#10;                    &lt;input type=&quot;text&quot; id=&quot;recCategory&quot; value=&quot;cat001&quot; placeholder=&quot;cat001&quot;&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Action Buttons --&gt;&#10;        &lt;div class=&quot;button-group&quot;&gt;&#10;            &lt;button class=&quot;btn-primary&quot; onclick=&quot;sendNotification()&quot;&gt;&#10;                &lt;span&gt;&lt;/span&gt;&#10;                &lt;span id=&quot;btnText&quot;&gt;Gửi Test Notification&lt;/span&gt;&#10;            &lt;/button&gt;&#10;            &lt;button class=&quot;btn-secondary&quot; onclick=&quot;testViaFirebase()&quot;&gt;&#10;                &lt;span&gt;&lt;/span&gt;&#10;                &lt;span&gt;Test qua Firebase Console&lt;/span&gt;&#10;            &lt;/button&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;!-- Response Display --&gt;&#10;        &lt;div id=&quot;response&quot; class=&quot;response&quot;&gt;&lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;script&gt;&#10;        const API_BASE = 'https://healthtips-notify.vercel.app/api';&#10;&#10;        function updateInputs() {&#10;            const testType = document.getElementById('testType').value;&#10;            &#10;            document.getElementById('commentReplyInputs').style.display = &#10;                testType === 'comment_reply' ? 'block' : 'none';&#10;            document.getElementById('healthTipInputs').style.display = &#10;                testType === 'new_health_tip' ? 'block' : 'none';&#10;            document.getElementById('recommendationInputs').style.display = &#10;                testType === 'recommendation' ? 'block' : 'none';&#10;        }&#10;&#10;        function fillQuick(fieldId, value) {&#10;            document.getElementById(fieldId).value = value;&#10;        }&#10;&#10;        function showResponse(message, type = 'success') {&#10;            const responseDiv = document.getElementById('response');&#10;            responseDiv.className = `response ${type}`;&#10;            responseDiv.innerHTML = message;&#10;            responseDiv.style.display = 'block';&#10;        }&#10;&#10;        function hideResponse() {&#10;            document.getElementById('response').style.display = 'none';&#10;        }&#10;&#10;        async function sendNotification() {&#10;            const fcmToken = document.getElementById('fcmToken').value.trim();&#10;            const testType = document.getElementById('testType').value;&#10;&#10;            if (!fcmToken) {&#10;                showResponse('❌ Vui lòng nhập FCM Token!', 'error');&#10;                return;&#10;            }&#10;&#10;            // Show loading&#10;            const btnText = document.getElementById('btnText');&#10;            const originalText = btnText.textContent;&#10;            btnText.innerHTML = '&lt;span class=&quot;spinner&quot;&gt;&lt;/span&gt; Đang gửi...';&#10;            showResponse('⏳ Đang gửi notification...', 'loading');&#10;&#10;            try {&#10;                let endpoint, payload;&#10;&#10;                if (testType === 'comment_reply') {&#10;                    const videoId = document.getElementById('videoId').value.trim();&#10;                    const commentId = document.getElementById('commentId').value.trim();&#10;                    const replyId = document.getElementById('replyId').value.trim();&#10;&#10;                    if (!videoId || !commentId) {&#10;                        showResponse('❌ Vui lòng nhập Video ID và Comment ID!', 'error');&#10;                        btnText.textContent = originalText;&#10;                        return;&#10;                    }&#10;&#10;                    endpoint = `${API_BASE}/send-comment-reply`;&#10;                    payload = {&#10;                        videoId,&#10;                        parentCommentId: commentId,&#10;                        replyCommentId: replyId || 'reply_' + Date.now(),&#10;                        senderUserId: 'test_user_' + Date.now()&#10;                    };&#10;                } &#10;                else if (testType === 'new_health_tip') {&#10;                    const healthTipId = document.getElementById('healthTipId').value.trim();&#10;                    const title = document.getElementById('tipTitle').value.trim();&#10;                    const category = document.getElementById('category').value.trim();&#10;&#10;                    if (!healthTipId) {&#10;                        showResponse('❌ Vui lòng nhập Health Tip ID!', 'error');&#10;                        btnText.textContent = originalText;&#10;                        return;&#10;                    }&#10;&#10;                    endpoint = `${API_BASE}/send-new-health-tip`;&#10;                    payload = {&#10;                        healthTipId,&#10;                        title: title || 'Test: Mẹo sức khỏe mới',&#10;                        category: category || 'cat001',&#10;                        adminUserId: 'test_admin',&#10;                        sendNotification: true&#10;                    };&#10;                }&#10;                else if (testType === 'recommendation') {&#10;                    const healthTipId = document.getElementById('recHealthTipId').value.trim();&#10;                    const category = document.getElementById('recCategory').value.trim();&#10;&#10;                    if (!healthTipId) {&#10;                        showResponse('❌ Vui lòng nhập Health Tip ID!', 'error');&#10;                        btnText.textContent = originalText;&#10;                        return;&#10;                    }&#10;&#10;                    endpoint = `${API_BASE}/queue-recommendation`;&#10;                    payload = {&#10;                        healthTipId,&#10;                        categoryId: category || 'cat001',&#10;                        title: 'Bài viết đề xuất cho bạn'&#10;                    };&#10;                }&#10;&#10;                const response = await fetch(endpoint, {&#10;                    method: 'POST',&#10;                    headers: {&#10;                        'Content-Type': 'application/json',&#10;                    },&#10;                    body: JSON.stringify(payload)&#10;                });&#10;&#10;                const data = await response.json();&#10;&#10;                if (response.ok &amp;&amp; data.success) {&#10;                    showResponse(`&#10;                        &lt;strong&gt;✅ Thành công!&lt;/strong&gt;&lt;br&gt;&#10;                        ${data.message}&lt;br&gt;&#10;                        &lt;small&gt;Recipients: ${data.recipients || 'N/A'}&lt;/small&gt;&lt;br&gt;&lt;br&gt;&#10;                        &lt;strong&gt; Kiểm tra thiết bị của bạn để xem notification!&lt;/strong&gt;&#10;                    `, 'success');&#10;                } else {&#10;                    showResponse(`&#10;                        &lt;strong&gt;❌ Lỗi!&lt;/strong&gt;&lt;br&gt;&#10;                        ${data.message || data.error || 'Unknown error'}&lt;br&gt;&#10;                        &lt;small&gt;${JSON.stringify(data)}&lt;/small&gt;&#10;                    `, 'error');&#10;                }&#10;            } catch (error) {&#10;                showResponse(`&#10;                    &lt;strong&gt;❌ Lỗi kết nối!&lt;/strong&gt;&lt;br&gt;&#10;                    ${error.message}&lt;br&gt;&lt;br&gt;&#10;                    &lt;small&gt;Kiểm tra:&lt;/small&gt;&lt;br&gt;&#10;                    • Internet connection&lt;br&gt;&#10;                    • Vercel API endpoint có hoạt động không&lt;br&gt;&#10;                    • CORS settings&#10;                `, 'error');&#10;            } finally {&#10;                btnText.textContent = originalText;&#10;            }&#10;        }&#10;&#10;        function testViaFirebase() {&#10;            const fcmToken = document.getElementById('fcmToken').value.trim();&#10;            &#10;            if (!fcmToken) {&#10;                showResponse('❌ Vui lòng nhập FCM Token trước!', 'error');&#10;                return;&#10;            }&#10;&#10;            const testType = document.getElementById('testType').value;&#10;            let payload = {};&#10;&#10;            if (testType === 'comment_reply') {&#10;                const videoId = document.getElementById('videoId').value.trim() || 'v8';&#10;                const commentId = document.getElementById('commentId').value.trim() || 'test_comment_001';&#10;                &#10;                payload = {&#10;                    type: 'comment_reply',&#10;                    title: 'Bình luận mới',&#10;                    body: 'Người dùng đã trả lời bình luận của bạn',&#10;                    videoId: videoId,&#10;                    parentCommentId: commentId,&#10;                    replyCommentId: 'test_reply_001',&#10;                    senderName: 'Test User',&#10;                    replyText: 'Đây là reply test!'&#10;                };&#10;            } else if (testType === 'new_health_tip') {&#10;                const healthTipId = document.getElementById('healthTipId').value.trim() || '-O_HEALTHTIP_001';&#10;                &#10;                payload = {&#10;                    type: 'new_health_tip',&#10;                    title: 'Mẹo sức khỏe mới',&#10;                    body: '10 mẹo giữ sức khỏe mùa đông',&#10;                    healthTipId: healthTipId,&#10;                    categoryId: 'cat001'&#10;                };&#10;            }&#10;&#10;            const instructions = `&#10;                &lt;strong&gt; Hướng dẫn test qua Firebase Console:&lt;/strong&gt;&lt;br&gt;&lt;br&gt;&#10;                &#10;                &lt;strong&gt;Bước 1:&lt;/strong&gt; Copy FCM Token (đã có sẵn)&lt;br&gt;&#10;                &lt;code class=&quot;code&quot;&gt;${fcmToken.substring(0, 50)}...&lt;/code&gt;&lt;br&gt;&lt;br&gt;&#10;                &#10;                &lt;strong&gt;Bước 2:&lt;/strong&gt; Vào Firebase Console&lt;br&gt;&#10;                → Chọn project &lt;strong&gt;HealthTips&lt;/strong&gt;&lt;br&gt;&#10;                → Vào &lt;strong&gt;Cloud Messaging&lt;/strong&gt;&lt;br&gt;&#10;                → Click &lt;strong&gt;&quot;Send test message&quot;&lt;/strong&gt;&lt;br&gt;&lt;br&gt;&#10;                &#10;                &lt;strong&gt;Bước 3:&lt;/strong&gt; Dán FCM Token vào ô&lt;br&gt;&#10;                &lt;em&gt;&quot;Add an FCM registration token&quot;&lt;/em&gt;&lt;br&gt;&lt;br&gt;&#10;                &#10;                &lt;strong&gt;Bước 4:&lt;/strong&gt; Chọn tab &lt;strong&gt;&quot;Data&quot;&lt;/strong&gt; và thêm:&lt;br&gt;&#10;                &lt;pre style=&quot;background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px;&quot;&gt;${JSON.stringify(payload, null, 2)}&lt;/pre&gt;&lt;br&gt;&#10;                &#10;                &lt;strong&gt;Bước 5:&lt;/strong&gt; Click &lt;strong&gt;&quot;Test&quot;&lt;/strong&gt;&lt;br&gt;&lt;br&gt;&#10;                &#10;                &lt;button class=&quot;quick-btn&quot; onclick=&quot;copyToClipboard('${fcmToken}')&quot;&gt; Copy FCM Token&lt;/button&gt;&#10;                &lt;button class=&quot;quick-btn&quot; onclick=&quot;copyToClipboard('${JSON.stringify(payload)}')&quot;&gt; Copy Payload&lt;/button&gt;&#10;            `;&#10;&#10;            showResponse(instructions, 'success');&#10;        }&#10;&#10;        function copyToClipboard(text) {&#10;            navigator.clipboard.writeText(text).then(() =&gt; {&#10;                alert('✅ Đã copy vào clipboard!');&#10;            });&#10;        }&#10;&#10;        // Auto-fill from localStorage if available&#10;        window.onload = function() {&#10;            const savedToken = localStorage.getItem('fcmToken');&#10;            if (savedToken) {&#10;                document.getElementById('fcmToken').value = savedToken;&#10;            }&#10;            &#10;            // Save token on change&#10;            document.getElementById('fcmToken').addEventListener('change', function() {&#10;                localStorage.setItem('fcmToken', this.value);&#10;            });&#10;        };&#10;    &lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>